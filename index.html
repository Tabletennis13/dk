<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            -webkit-text-size-adjust: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 18px 12px;
            text-align: center;
        }
        
        header h1 {
            font-size: 1.6em;
            margin-bottom: 6px;
            word-break: break-word;
            line-height: 1.3;
        }
        
        .header-subtitle {
            font-size: 0.95em;
            opacity: 0.9;
            padding: 0 8px;
            line-height: 1.4;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä–æ–∫–∞ */
        .player-profile-container {
            padding: 20px 15px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .player-profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .player-profile-header {
                flex-direction: row;
                text-align: left;
                gap: 25px;
            }
        }
        
        .player-avatar-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #4CAF50;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        
        .player-info-large {
            flex: 1;
        }
        
        .player-name-large {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .player-rating-large {
            font-size: 1.8em;
            color: #4CAF50;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .achievement-emojis {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .achievement-emojis {
                justify-content: flex-start;
            }
        }
        
        .achievement-emoji {
            font-size: 1.2em;
            margin-right: 2px;
            opacity: 0.9;
        }
        
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .player-stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        @media (min-width: 768px) {
            .player-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .stat-period-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            transition: transform 0.3s ease;
        }
        
        .stat-period-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-period-box h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4CAF50;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-period-box p {
            margin: 8px 0;
            font-size: 1.1em;
        }
        
        .stat-value {
            font-weight: bold;
            color: #4CAF50;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin: 30px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .chart-container h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-canvas {
            width: 100%;
            height: 300px;
            margin-top: 20px;
        }
        
        .player-achievements-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .player-achievements-section h3 {
            font-size: 1.6em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .achievements-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .achievements-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .achievement-icon {
            font-size: 2.5em;
            flex-shrink: 0;
        }
        
        .achievement-details {
            flex: 1;
        }
        
        .achievement-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .achievement-description {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–º–æ–¥–∑–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ */
        .player-cell-with-emojis {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
        }
        
        .player-emojis {
            display: flex;
            gap: 2px;
            font-size: 0.9em;
            line-height: 1;
            margin-left: 5px;
            opacity: 0.9;
        }
        
        .player-emoji {
            font-size: 0.9em;
            line-height: 1;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
        .achievements-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .achievements-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .achievements-header h3 {
            font-size: 1.4em;
            margin: 0;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .achievements-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .achievement-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }
        
        .achievement-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .achievement-player {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .achievement-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .achievement-player-info {
            flex: 1;
        }
        
        .achievement-player-name {
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-color: rgba(255, 255, 255, 0.5);
        }
        
        .achievement-player-name:hover {
            text-decoration-color: white;
        }
        
        .achievement-player-rating {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .achievement-level {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }
        
        .level-icon {
            font-size: 1.8em;
        }
        
        .level-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .level-description {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 8px;
            padding: 8px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .achievement-congrats {
            background: rgba(76, 175, 80, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
            font-style: italic;
        }
        
        .levels-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .levels-info h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .levels-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .level-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤ */
        .tournament-container {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tournament-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .tournament-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tournament-card.winner {
            border-color: #FFD700;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
        }
        
        .tournament-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .tournament-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            flex: 1;
        }
        
        .tournament-type {
            background: #4CAF50;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .tournament-stats {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value-large {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .tournament-winner {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .winner-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #FFD700;
        }
        
        .winner-info {
            flex: 1;
        }
        
        .winner-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .winner-name {
            font-weight: bold;
            color: #333;
        }
        
        .tournament-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .view-tournament-btn, .delete-tournament-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .view-tournament-btn {
            background: #4CAF50;
            color: white;
        }
        
        .view-tournament-btn:hover {
            background: #45a049;
        }
        
        .delete-tournament-btn {
            background: #f44336;
            color: white;
        }
        
        .delete-tournament-btn:hover {
            background: #d32f2f;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤ */
        .tournament-generator {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid #4CAF50;
            max-height: 70px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .tournament-generator.expanded {
            max-height: 1000px;
            overflow: visible;
        }
        
        .generator-header {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            cursor: pointer;
        }
        
        .generator-header .toggle-icon {
            font-size: 16px;
            transition: transform 0.3s ease;
        }
        
        .tournament-generator.expanded .generator-header .toggle-icon {
            transform: rotate(180deg);
        }
        
        .generator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .generator-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .generator-section h4 {
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-checkbox-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .player-checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .player-checkbox-item:last-child {
            border-bottom: none;
        }
        
        .player-checkbox-item img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç—É—Ä–Ω–∏—Ä–∞ */
        .tournament-page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            margin-bottom: 25px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .tournament-page-header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .tournament-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            opacity: 0.9;
        }
        
        .tournament-photo-section {
            margin: 25px 0;
        }
        
        .tournament-photo-container {
            position: relative;
            margin-top: 15px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
            background: #f8f9fa;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tournament-photo {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
        }
        
        .upload-photo-btn {
            padding: 12px 25px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .upload-photo-btn:hover {
            background: #45a049;
        }
        
        .tournament-bracket {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .round-robin-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .round-robin-table th {
            background: #4CAF50;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
        }
        
        .round-robin-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        .round-robin-table tr:hover {
            background: #f9f9f9;
        }
        
        .match-cell {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .match-cell:hover {
            background: #e8f5e9;
            transform: scale(1.02);
        }
        
        .winner-cell {
            background: #e8f5e9 !important;
            font-weight: bold;
            color: #2E7D32;
        }
        
        .tournament-matches {
            margin: 30px 0;
        }
        
        .match-result {
            display: flex;
            flex-direction: column;
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .match-result {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .match-result:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-color: #4CAF50;
        }
        
        .match-result.final {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border-color: #FFD700;
        }
        
        .match-players {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .match-players {
                flex-direction: row;
                align-items: center;
                gap: 15px;
                margin-bottom: 0;
            }
        }
        
        .player-match-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .match-vs {
            font-weight: bold;
            color: #666;
            margin: 0 10px;
            text-align: center;
            padding: 5px 0;
        }
        
        @media (min-width: 768px) {
            .match-vs {
                margin: 0 10px;
            }
        }
        
        .match-score {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            margin-top: 10px;
            align-self: center;
        }
        
        @media (min-width: 768px) {
            .match-score {
                margin-top: 0;
                align-self: auto;
            }
        }
        
        .match-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .match-details {
                text-align: left;
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ —Ç—É—Ä–Ω–∏—Ä–∞ */
        .bracket-container {
            display: flex;
            justify-content: space-between;
            overflow-x: auto;
            padding: 20px 0;
        }
        
        .bracket-round {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            min-width: 200px;
            margin: 0 20px;
        }
        
        .bracket-match {
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            position: relative;
            min-width: 180px;
        }
        
        .bracket-match.winner {
            border-color: #FFD700;
            background: #fff9c4;
        }
        
        .bracket-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        
        .bracket-player.winner {
            background: #e8f5e9;
            font-weight: bold;
        }
        
        .player-score {
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.9em;
        }
        
        .bracket-connector {
            position: absolute;
            right: -20px;
            top: 50%;
            width: 20px;
            height: 2px;
            background: #4CAF50;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .bottom-panels {
            padding: 15px;
            background: #f8f9fa;
            border-top: 2px solid #e0e0e0;
            margin-top: 20px;
        }
        
        .supabase-panel {
            background: #e8f5e9;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .supabase-status {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.9em;
        }
        
        .supabase-panel .action-btn {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            height: 44px;
        }
        
        .status-connected { color: #2E7D32; font-weight: bold; }
        .status-error { color: #d32f2f; font-weight: bold; }
        .status-loading { color: #ff9800; font-weight: bold; }
        
        .admin-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            display: none;
        }
        
        .admin-active .admin-panel {
            display: block;
        }
        
        .login-panel {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .password-input {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 10px;
            font-size: 16px;
            -webkit-appearance: none;
            height: 48px;
        }
        
        .login-btn, .logout-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            height: 48px;
        }
        
        .login-btn {
            background: #4CAF50;
            color: white;
        }
        
        .login-btn:active, .logout-btn:active {
            transform: translateY(1px);
        }
        
        .logout-btn {
            background: #f44336;
            color: white;
            margin-top: 10px;
        }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            padding: 14px 16px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
            min-width: fit-content;
        }
        
        .tab-btn.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }
        
        .tab-content {
            display: none;
            padding: 15px 12px;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 12px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
            background: white;
        }
        
        th {
            background: #4CAF50;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            white-space: nowrap;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            vertical-align: middle;
            white-space: nowrap;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ */
        #ratingBody td {
            padding: 8px 6px;
        }
        
        #ratingBody .player-cell {
            min-width: 0;
            cursor: pointer;
        }
        
        #ratingBody .player-cell span {
            font-size: 13px;
            white-space: normal;
            word-break: break-word;
            line-height: 1.3;
            max-width: 120px;
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #4CAF50;
            flex-shrink: 0;
        }
        
        .player-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
        }
        
        .player-cell span {
            font-size: 14px;
            white-space: normal;
            word-break: break-word;
            line-height: 1.3;
            flex: 1;
            min-width: 0;
        }
        
        .rating-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 12px;
            display: inline-block;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            min-height: 32px;
            white-space: nowrap;
        }
        
        .delete-btn {
            background: #f44336;
            color: white;
        }
        
        .penalty-btn {
            background: #ff9800;
            color: white;
        }
        
        .add-btn {
            background: #4CAF50;
            color: white;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
        .admin-controls-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .admin-controls-panel h4 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ */
        .admin-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .admin-controls h4 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            -webkit-appearance: none;
            height: 44px;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .period-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .period-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .period-box h3 {
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #4CAF50;
            font-size: 15px;
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .player-comparison {
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .player-comparison img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin-bottom: 12px;
            border: 3px solid #4CAF50;
        }
        
        .vs-badge {
            background: #333;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            margin: 0 auto;
        }
        
        .year-progress {
            height: 160px;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            display: flex;
            align-items: flex-end;
            gap: 6px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .progress-bar {
            flex: 1;
            min-width: 35px;
            background: linear-gradient(to top, #4CAF50, #8BC34A);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: height 0.5s ease;
        }
        
        .progress-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .progress-count {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ */
        .rating-input {
            width: 70px !important;
            padding: 6px !important;
            font-size: 14px !important;
            height: 36px;
            text-align: center;
        }
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –†–ê–ó–î–ï–õ–ï–ù–ò–Ø –ú–ê–¢–ß–ï–ô –ü–û –î–ù–Ø–ú –° –í–û–ó–ú–û–ñ–ù–û–°–¢–¨–Æ –°–í–û–†–ê–ß–ò–í–ê–ù–ò–Ø */
        .match-day-header {
            background-color: #1976d2;
            color: white;
            font-weight: bold;
            font-size: 14px;
            padding: 10px 12px;
            margin: 10px 0 0 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .match-day-header.collapsed {
            background-color: #e0f2f1;
            color: #00796b;
            margin-bottom: 8px;
        }
        
        .match-day-header.collapsed:hover {
            background-color: #b2dfdb;
        }
        
        .match-day-header .day-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .match-day-header .day-date {
            font-weight: 600;
            font-size: 14px;
        }
        
        .match-day-header .match-count {
            background: rgba(255, 255, 255, 0.9);
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .match-day-header.collapsed .match-count {
            background: #00796b;
            color: white;
        }
        
        .match-day-header .toggle-icon {
            font-size: 16px;
            transition: transform 0.3s ease;
        }
        
        .match-day-header.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        
        .match-day-group {
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            max-height: 1000px;
            opacity: 1;
        }
        
        .match-day-group.collapsed {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0;
            border: none;
            overflow: hidden;
        }
        
        .match-day-group table {
            margin: 0;
            border-radius: 0;
            min-width: 600px;
        }
        
        .match-day-group table tr:first-child td {
            border-top: none;
        }
        
        .match-day-group table tr:last-child td {
            border-bottom: none;
        }
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–ê–†–ù–û–ì–û –¢–£–†–ù–ò–†–ê */
        .doubles-team {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .doubles-team-players {
            flex: 1;
            font-weight: bold;
            color: #333;
        }
        
        .doubles-team-rating {
            background: #4CAF50;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .doubles-match-result {
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .doubles-match-result.final {
            border-color: #FFD700;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
        }
        
        .doubles-match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .doubles-match-vs {
            font-weight: bold;
            color: #666;
            margin: 0 15px;
            font-size: 1.2em;
        }
        
        .doubles-final-note {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ */
        @media (min-width: 481px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 15px;
            }
            
            header {
                padding: 20px 15px;
            }
            
            header h1 {
                font-size: 1.8em;
            }
            
            .supabase-panel {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .supabase-panel .action-btn {
                width: auto;
                min-width: 160px;
            }
            
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .period-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .tabs {
                justify-content: center;
            }
            
            #ratingBody .player-cell span {
                max-width: 150px;
            }
        }
        
        @media (min-width: 769px) {
            .tab-content {
                padding: 20px 15px;
            }
            
            table {
                min-width: 800px;
            }
            
            th, td {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            #ratingBody .player-cell span {
                max-width: 200px;
            }
            
            .player-cell span {
                font-size: 15px;
            }
            
            .avatar {
                width: 40px;
                height: 40px;
            }
            
            .bottom-panels {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                border-radius: 8px;
            }
            
            header {
                padding: 15px 10px;
            }
            
            header h1 {
                font-size: 1.4em;
            }
            
            .header-subtitle {
                font-size: 0.85em;
            }
            
            .tab-content {
                padding: 12px 10px;
            }
            
            .tab-btn {
                padding: 12px 14px;
                font-size: 13px;
            }
            
            th {
                padding: 10px 6px;
                font-size: 12px;
            }
            
            td {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .avatar {
                width: 32px;
                height: 32px;
            }
            
            #ratingBody .player-cell span {
                font-size: 12px;
                max-width: 100px;
            }
            
            .rating-input {
                width: 65px !important;
                padding: 5px !important;
                font-size: 13px !important;
                height: 34px;
            }
            
            .action-btn {
                padding: 5px 8px;
                font-size: 11px;
                min-height: 30px;
            }
            
            .password-input,
            .login-btn,
            .logout-btn {
                padding: 10px 15px;
                font-size: 15px;
                height: 44px;
            }
            
            .year-progress {
                height: 140px;
                padding: 10px;
            }
            
            .progress-bar {
                min-width: 30px;
            }
            
            .bottom-panels {
                padding: 12px;
            }
            
            .achievements-grid {
                grid-template-columns: 1fr;
            }
            
            .match-day-header {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .match-day-header .day-date {
                font-size: 13px;
            }
            
            .match-day-header .match-count {
                font-size: 11px;
                padding: 1px 6px;
            }
        }
        
        .mobile-optimized-table table {
            font-size: 12px;
        }
        
        .mobile-optimized-table th,
        .mobile-optimized-table td {
            padding: 6px 4px;
        }
        
        @supports (-webkit-touch-callout: none) {
            input, select, textarea, button {
                font-size: 16px !important;
            }
            
            .tabs {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        @media (hover: hover) and (pointer: fine) {
            .login-btn:hover {
                background: #45a049;
            }
            
            .action-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }
            
            tr:hover {
                background: #f9f9f9;
            }
        }
        
        #playersBody .player-cell span {
            font-size: 13px;
            white-space: normal;
            word-break: break-word;
            line-height: 1.3;
            max-width: 150px;
        }
        
        .compact-table td:nth-child(1) { width: 60px; }
        .compact-table td:nth-child(2) { min-width: 140px; }
        .compact-table td:nth-child(3) { width: 80px; }
        .compact-table td:nth-child(4) { width: 70px; }
        .compact-table td:nth-child(5) { width: 90px; }
        .compact-table td:nth-child(6) { width: 100px; }
        .compact-table td:nth-child(7) { width: 90px; }
        .compact-table td:nth-child(8) { width: 70px; }
        
        .long-name {
            font-size: 11px !important;
            line-height: 1.2 !important;
        }
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä–æ–∫–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="playerProfileContainer" style="display: none;">
        <div class="player-profile-container">
            <div class="player-profile-header">
                <img id="playerProfileAvatar" src="" class="player-avatar-large" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                <div class="player-info-large">
                    <h1 id="playerProfileName" class="player-name-large"></h1>
                    <div id="playerProfileRating" class="player-rating-large"></div>
                    <div id="playerProfileEmojis" class="achievement-emojis"></div>
                    <div id="playerProfileStats" class="player-profile-stats"></div>
                </div>
            </div>
            
            <div class="player-stats-grid">
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é</h3>
                    <div id="playerWeekStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –º–µ—Å—è—Ü</h3>
                    <div id="playerMonthStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –≥–æ–¥</h3>
                    <div id="playerYearStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</h3>
                    <div id="playerAllTimeStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üìà –ì—Ä–∞—Ñ–∏–∫ —Ñ–æ—Ä–º—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∞—Ç—á–µ–π)</h3>
                <canvas id="playerFormChart" class="chart-canvas"></canvas>
            </div>
            
            <div class="player-achievements-section">
                <h3>üèÜ –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞</h3>
                <div id="playerAllAchievements" class="achievements-list">
                    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <a href="#" class="back-button" onclick="returnToMain()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–π—Ç–∏–Ω–≥—É</a>
        </div>
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="tournamentPageContainer" style="display: none;">
        <div class="player-profile-container">
            <div class="tournament-page-header">
                <h1 id="tournamentPageName"></h1>
                <div id="tournamentPageMeta" class="tournament-meta"></div>
            </div>
            
            <div class="tournament-winner" id="tournamentWinnerSection">
                <!-- –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å -->
            </div>
            
            <div class="tournament-photo-section" id="tournamentPhotoSection">
                <h3>üì∏ –§–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div class="tournament-photo-container" id="tournamentPhotoContainer">
                    <div id="tournamentPhotoPlaceholder">
                        <p style="color: #666; text-align: center; padding: 40px;">
                            üèì –§–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                        </p>
                    </div>
                    <img id="tournamentPhoto" class="tournament-photo" style="display: none;">
                </div>
                <button class="upload-photo-btn" id="uploadPhotoBtn" onclick="uploadTournamentPhoto()" style="display: none;">
                    üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
            </div>
            
            <div class="tournament-bracket" id="tournamentBracket">
                <!-- –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
            
            <div class="tournament-matches" id="tournamentMatches">
                <h3>üéÆ –í—Å–µ –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div id="tournamentMatchesList"></div>
            </div>
            
            <a href="#" class="back-button" onclick="returnToTournaments()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç—É—Ä–Ω–∏—Ä–∞–º</a>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–≤–∏–¥–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="appContainer">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢</h1>
            <div class="header-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞</div>
        </header>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üèÖ –¢—É—Ä–Ω–∏—Ä—ã</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content active" id="rating">
            <h2>üèÜ –¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div class="table-container">
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–û—á–∫–∏</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–ü–æ–±–µ–¥</th>
                            <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∏–≥—Ä–∞</th>
                            <th>–ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="ratingBody"></tbody>
                </table>
            </div>
            
            <!-- –ë–õ–û–ö –î–û–°–¢–ò–ñ–ï–ù–ò–ô –ò –ü–û–û–©–†–ï–ù–ò–ô -->
            <div class="achievements-container" id="achievementsContainer">
                <div class="achievements-header">
                    <div class="level-icon">üèÜ</div>
                    <h3>–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h3>
                </div>
                
                <div id="achievementsContent">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç -->
                    <p>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤...</p>
                </div>
                
                <div class="levels-info">
                    <h4>üéØ –£—Ä–æ–≤–Ω–∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</h4>
                    <p>–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π:</p>
                    <div class="levels-list">
                        <div class="level-badge">ü•â 1100 - –ù–∞—á–∏–Ω–∞—é—â–∏–π —á–µ–º–ø–∏–æ–Ω</div>
                        <div class="level-badge">ü•à 1300 - –û–ø—ã—Ç–Ω—ã–π –±–æ–µ—Ü</div>
                        <div class="level-badge">ü•á 1500 - –ú–∞—Å—Ç–µ—Ä —Å—Ç–æ–ª–∞</div>
                        <div class="level-badge">üëë 2000 - –õ–µ–≥–µ–Ω–¥–∞ –ª–∏–≥–∏</div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                        <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É –∏–≥—Ä–æ–∫–æ–≤. 
                        –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞.
                        <br>üéÅ <strong>–ë–æ–Ω—É—Å—ã:</strong> –ó–∞ –∫–∞–∂–¥—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—á–∫–∏:
                        ü•â +16 –æ—á–∫–æ–≤, ü•à +20 –æ—á–∫–æ–≤, ü•á +30 –æ—á–∫–æ–≤, üëë +50 –æ—á–∫–æ–≤
                    </p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="matches">
            <h2>üéÆ –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π</h2>
            <div id="matchesContainer">
                <!-- –ú–∞—Ç—á–∏ –±—É–¥—É—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–Ω—è–º –∑–¥–µ—Å—å -->
            </div>
            
            <!-- –ë–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞ -->
            <div class="admin-controls" id="matchesAdminControls">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –º–∞—Ç—á–∞:</label>
                            <input type="date" id="matchDate">
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 1:</label>
                            <select id="player1"></select>
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 2:</label>
                            <select id="player2"></select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</label>
                            <select id="winner">
                                <option value="player1">–ò–≥—Ä–æ–∫ 1</option>
                                <option value="player2">–ò–≥—Ä–æ–∫ 2</option>
                                <option value="draw">–ù–∏—á—å—è</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–°—á–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="score" placeholder="3:2">
                        </div>
                        <button class="add-btn action-btn" onclick="addMatch()" style="margin-top: 20px; width: 100%;">
                            ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="players">
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h2>
            <div class="admin-controls" id="playersAdminControls">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–ò–º—è –∏–≥—Ä–æ–∫–∞:</label>
                            <input type="text" id="newPlayerName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
                        </div>
                        <div class="form-group">
                            <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="newPlayerAvatar" placeholder="https://example.com/avatar.jpg">
                        </div>
                        <div class="form-group">
                            <label>–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥:</label>
                            <input type="number" id="newPlayerRating" value="1000">
                        </div>
                        <button class="add-btn action-btn" onclick="addPlayer()" style="width: 100%;">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
                        </button>
                    </div>
                    <div>
                        <p><strong>–°–æ–≤–µ—Ç—ã:</strong></p>
                        <ul style="list-style: none; padding: 0;">
                            <li>‚Ä¢ –î–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <a href="https://pravatar.cc" target="_blank">pravatar.cc</a></li>
                            <li>‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: 1000</li>
                            <li>‚Ä¢ –ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–≤–∞—Ç–∞—Ä</th>
                            <th>–ò–º—è</th>
                            <th>–†–µ–π—Ç–∏–Ω–≥</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–ü–æ–±–µ–¥</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="playersBody"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="tournaments">
            <h2>üèÖ –¢—É—Ä–Ω–∏—Ä—ã</h2>
            
            <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
            <div class="tournament-generator" id="tournamentGenerator">
                <div class="generator-header" onclick="toggleTournamentGenerator()">
                    <span>üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–æ–≤</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                
                <div class="generator-grid">
                    <div class="generator-section">
                        <h4>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–Ω–∏—Ä–µ</h4>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                            <input type="text" id="tournamentName" placeholder="–í–µ—Å–µ–Ω–Ω–∏–π –∫—É–±–æ–∫ 2024">
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏:</label>
                            <select id="tournamentType">
                                <option value="round_robin_3">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="round_robin_4">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="round_robin_5">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –∏–≥—Ä–æ–∫–æ–≤)</option>
                                <option value="round_robin_6">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (6 –∏–≥—Ä–æ–∫–æ–≤)</option>
                                <option value="single_elimination_4">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="single_elimination_8">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8 –∏–≥—Ä–æ–∫–æ–≤)</option>
                                <option value="double_elimination_4">–î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <!-- –ù–û–í–´–ï –û–ü–¶–ò–ò –î–õ–Ø –ü–ê–†–ù–´–• –¢–£–†–ù–ò–†–û–í -->
                                <option value="doubles_round_robin_3">–ü–∞—Ä–Ω—ã–π –∫—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –ø–∞—Ä—ã)</option>
                                <option value="doubles_round_robin_5">–ü–∞—Ä–Ω—ã–π –∫—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –ø–∞—Ä)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="generator-section">
                        <h4>üë• –í—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h4>
                        <div id="singlesPlayersList">
                            <div class="player-checkbox-list" id="tournamentPlayersList">
                                <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                –í—ã–±—Ä–∞–Ω–æ: <span id="selectedPlayersCount">0</span> –∏–≥—Ä–æ–∫–æ–≤
                            </div>
                        </div>
                        
                        <div id="doublesPlayersList" style="display: none;">
                            <div id="doublesTeamsContainer">
                                <div id="doublesTeamsList">
                                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã -->
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <h4 style="font-size: 14px; margin-bottom: 8px;">üìù –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—É:</h4>
                                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                    <select id="player1Select" style="flex: 1; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                        <option value="">–ò–≥—Ä–æ–∫ 1</option>
                                    </select>
                                    <select id="player2Select" style="flex: 1; padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                        <option value="">–ò–≥—Ä–æ–∫ 2</option>
                                    </select>
                                    <button onclick="addDoublesTeam()" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É
                                    </button>
                                </div>
                                <div id="availablePlayersList" style="max-height: 150px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 6px; border: 1px solid #ddd;">
                                    <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                                </div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                –°–æ–∑–¥–∞–Ω–æ –ø–∞—Ä: <span id="doublesTeamsCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="generate-btn" onclick="generateTournament()">
                    üèÜ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                </button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
            <h3>üìã –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤</h3>
            <div class="tournament-grid" id="tournamentsList">
                <!-- –¢—É—Ä–Ω–∏—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <div class="tab-content" id="stats">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            <div class="form-group" style="max-width: 400px;">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</label>
                <select id="statsPlayerSelect" onchange="updatePeriodStats()"></select>
            </div>
            
            <div class="period-stats">
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é</h3>
                    <div id="weekStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –º–µ—Å—è—Ü</h3>
                    <div id="monthStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –≥–æ–¥</h3>
                    <div id="yearStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</h3>
                    <div id="allTimeStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
            </div>
            
            <h3>üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
            <div class="year-progress" id="yearProgress"></div>
            
            <h3>üî• –¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤ –≥–æ–¥–∞</h3>
            <div id="topYearPlayers"></div>
            
            <h3>‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</h3>
            <div class="comparison-container">
                <div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 1:</label>
                        <select id="comparePlayer1"></select>
                    </div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 2:</label>
                        <select id="comparePlayer2"></select>
                    </div>
                    <button class="add-btn action-btn" onclick="comparePlayers()" style="width: 100%;">
                        üîç –°—Ä–∞–≤–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤
                    </button>
                </div>
                <div id="comparisonResult" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°—Ä–∞–≤–Ω–∏—Ç—å"</p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="penalties">
            <h2>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
            <div class="admin-controls" id="penaltiesAdminControls">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–æ–≤ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="penalty-btn action-btn" onclick="checkAndApplyPenalties()">
                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ-—à—Ç—Ä–∞—Ñ—ã
                </button>
                <p><small>–®—Ç—Ä–∞—Ñ: -60 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–µ 14+ –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</small></p>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–®—Ç—Ä–∞—Ñ</th>
                            <th>–î–Ω–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</th>
                            <th>–¢–∏–ø</th>
                        </tr>
                    </thead>
                    <tbody id="penaltiesHistoryBody"></tbody>
                </table>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª–∏ –≤–Ω–∏–∑—É —Å–∞–π—Ç–∞ -->
        <div class="bottom-panels">
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–º (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) -->
            <div class="admin-controls-panel" id="ratingAdminControls">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–º (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="penalty-btn action-btn" onclick="checkAndApplyPenalties()">
                    ‚ö†Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ-—à—Ç—Ä–∞—Ñ—ã (14+ –¥–Ω–µ–π = -60)
                </button>
                <button class="add-btn action-btn" onclick="saveManualRatings()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤
                </button>
                <p><small>–ò–∑–º–µ–Ω–∏—Ç–µ –æ—á–∫–∏ –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤"</small></p>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å Supabase -->
            <div class="supabase-panel">
                <div class="supabase-status">
                    <strong>‚òÅÔ∏è Supabase Cloud Sync</strong>
                    <div>–°—Ç–∞—Ç—É—Å: <span id="supabaseStatus" class="status-loading">‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span></div>
                    <div>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="supabaseTime">--:--:--</span></div>
                </div>
                <button class="action-btn add-btn" onclick="loadAllData()" id="refreshBtn">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="admin-panel" id="adminPanel">
                <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä. –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
                <button class="logout-btn" onclick="logoutAdmin()">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º–∞</button>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å –≤—Ö–æ–¥–∞ -->
            <div class="login-panel" id="loginPanel">
                <h3>üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h3>
                <p>–î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –º–∞—Ç—á–µ–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</p>
                <input type="password" id="adminPassword" class="password-input" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                <button class="login-btn" onclick="loginAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE
    // ============================================
    const SUPABASE_URL = 'https://bqycjfcjtdawyrysgrbw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWNqZmNqdGRhd3lyeXNncmJ3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjYwMTk3MCwiZXhwIjoyMDgyMTc3OTcwfQ.lHA_79fw8PSj9ZHMExBpSEIpkonkCYOni7HniGGqadY';
    
    let supabaseClient = null;
    let isSupabaseInitialized = false;
    
    // ============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // ============================================
    let players = {};
    let matches = [];
    let penaltyLog = [];
    let tournaments = [];
    let tournamentMatches = [];
    let tournamentPhotos = [];
    let isAdmin = false;
    const ADMIN_PASSWORD = "admin123";
    
    // –ù–û–í–ê–Ø –ü–ï–†–ï–ú–ï–ù–ù–ê–Ø: –°–ø–∏—Å–æ–∫ –ø–∞—Ä –¥–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    let doublesTeams = [];
    
    // ============================================
    // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–ê–†–ù–´–• –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
    function updateTournamentTypeUI() {
        const tournamentType = document.getElementById('tournamentType').value;
        const singlesList = document.getElementById('singlesPlayersList');
        const doublesList = document.getElementById('doublesPlayersList');
        const playerSelects = [document.getElementById('player1Select'), document.getElementById('player2Select')];
        
        // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–∫–∏ –ø–∞—Ä –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
        if (tournamentType.includes('doubles')) {
            singlesList.style.display = 'none';
            doublesList.style.display = 'block';
            doublesTeams = []; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞—Ä
            updateDoublesTeamsDisplay();
            updateAvailablePlayersList();
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä
            const playerNames = Object.keys(players).sort();
            playerSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>';
                    playerNames.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name;
                        select.appendChild(option);
                    });
                }
            });
        } else {
            singlesList.style.display = 'block';
            doublesList.style.display = 'none';
            updateTournamentPlayersList(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—ã –∏–≥—Ä–æ–∫–æ–≤
    function addDoublesTeam() {
        const player1Select = document.getElementById('player1Select');
        const player2Select = document.getElementById('player2Select');
        
        const player1 = player1Select.value;
        const player2 = player2Select.value;
        
        if (!player1 || !player2) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—ã!', 'error');
            return;
        }
        
        if (player1 === player2) {
            showNotification('–ò–≥—Ä–æ–∫–∏ –≤ –ø–∞—Ä–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏!', 'error');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏ —É–∂–µ —ç—Ç–∏ –∏–≥—Ä–æ–∫–∏ –≤ –¥—Ä—É–≥–∏–µ –ø–∞—Ä—ã
        const isPlayer1AlreadyInTeam = doublesTeams.some(team => 
            team.players.includes(player1)
        );
        
        const isPlayer2AlreadyInTeam = doublesTeams.some(team => 
            team.players.includes(player2)
        );
        
        if (isPlayer1AlreadyInTeam) {
            showNotification(`–ò–≥—Ä–æ–∫ ${player1} —É–∂–µ –≤—Ö–æ–¥–∏—Ç –≤ –¥—Ä—É–≥—É—é –ø–∞—Ä—É!`, 'error');
            return;
        }
        
        if (isPlayer2AlreadyInTeam) {
            showNotification(`–ò–≥—Ä–æ–∫ ${player2} —É–∂–µ –≤—Ö–æ–¥–∏—Ç –≤ –¥—Ä—É–≥—É—é –ø–∞—Ä—É!`, 'error');
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—É
        const team = {
            id: `team_${Date.now()}`,
            players: [player1, player2],
            name: `${player1} / ${player2}`,
            rating: (players[player1].rating + players[player2].rating) / 2, // –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥
            wins: 0,
            matches: 0
        };
        
        doublesTeams.push(team);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
        player1Select.value = '';
        player2Select.value = '';
        
        updateDoublesTeamsDisplay();
        updateAvailablePlayersList();
        
        showNotification(`‚úÖ –ü–∞—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞: ${player1} / ${player2}`, 'success');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä
    function updateDoublesTeamsDisplay() {
        const container = document.getElementById('doublesTeamsList');
        const countElement = document.getElementById('doublesTeamsCount');
        
        if (!container) return;
        
        container.innerHTML = '';
        countElement.textContent = doublesTeams.length;
        
        if (doublesTeams.length === 0) {
            container.innerHTML = `
                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center; color: #666;">
                    üèì –ü–∞—Ä—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä—ã —Å –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º—ã –≤—ã—à–µ.
                </div>
            `;
            return;
        }
        
        doublesTeams.forEach((team, index) => {
            const teamDiv = document.createElement('div');
            teamDiv.className = 'doubles-team';
            teamDiv.innerHTML = `
                <div style="font-weight: bold; color: #4CAF50; min-width: 30px;">${index + 1}.</div>
                <div class="doubles-team-players">${team.name}</div>
                <div class="doubles-team-rating">${Math.round(team.rating)}</div>
                <button onclick="removeDoublesTeam('${team.id}')" style="background: #f44336; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; margin-left: 5px;">
                    ‚úï
                </button>
            `;
            container.appendChild(teamDiv);
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    function updateAvailablePlayersList() {
        const container = document.getElementById('availablePlayersList');
        if (!container) return;
        
        const allPlayers = Object.keys(players).sort();
        const usedPlayers = new Set();
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –≤ –ø–∞—Ä–∞—Ö
        doublesTeams.forEach(team => {
            team.players.forEach(player => usedPlayers.add(player));
        });
        
        const availablePlayers = allPlayers.filter(player => !usedPlayers.has(player));
        
        if (availablePlayers.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: #666; padding: 5px;">
                    ‚úÖ –í—Å–µ –∏–≥—Ä–æ–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ –ø–∞—Ä–∞–º
                </div>
            `;
            return;
        }
        
        let html = '<div style="font-weight: bold; margin-bottom: 5px; font-size: 12px;">üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä–æ–∫–∏:</div>';
        availablePlayers.forEach(player => {
            const rating = players[player].rating;
            html += `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 0; border-bottom: 1px solid #eee;">
                    <span>${player}</span>
                    <span style="color: #4CAF50; font-weight: bold; font-size: 12px;">${rating}</span>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä—ã
    function removeDoublesTeam(teamId) {
        doublesTeams = doublesTeams.filter(team => team.id !== teamId);
        updateDoublesTeamsDisplay();
        updateAvailablePlayersList();
    }
    
    // ============================================
    // –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function toggleTournamentGenerator() {
        const generator = document.getElementById('tournamentGenerator');
        generator.classList.toggle('expanded');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤ –∏–∑ Supabase
    async function loadTournaments() {
        if (!supabaseClient) return;
        
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
            const { data: tournamentsData, error: tournamentsError } = await supabaseClient
                .from('tournaments')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (tournamentsError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', tournamentsError);
                return;
            }
            
            tournaments = tournamentsData || [];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            const { data: tournamentMatchesData, error: tournamentMatchesError } = await supabaseClient
                .from('tournament_matches')
                .select('*');
            
            if (tournamentMatchesError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π —Ç—É—Ä–Ω–∏—Ä–æ–≤:', tournamentMatchesError);
            } else {
                tournamentMatches = tournamentMatchesData || [];
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            const { data: tournamentPhotosData, error: tournamentPhotosError } = await supabaseClient
                .from('tournament_photos')
                .select('*');
            
            if (tournamentPhotosError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', tournamentPhotosError);
            } else {
                tournamentPhotos = tournamentPhotosData || [];
            }
            
            console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${tournaments.length} —Ç—É—Ä–Ω–∏—Ä–æ–≤`);
            updateTournamentsDisplay();
            updateTournamentPlayersList();
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function updateTournamentPlayersList() {
        const container = document.getElementById('tournamentPlayersList');
        if (!container) return;
        
        const playerNames = Object.keys(players).sort();
        
        let html = '';
        playerNames.forEach(playerName => {
            const player = players[playerName];
            html += `
                <div class="player-checkbox-item">
                    <input type="checkbox" id="player_${playerName}" value="${playerName}" 
                           onchange="updateSelectedPlayersCount()">
                    <img src="${player.avatar}" 
                         onerror="this.src='https://i.pravatar.cc/150?img=3'}" 
                         style="width: 30px; height: 30px; border-radius: 50%;">
                    <label for="player_${playerName}" style="flex: 1; cursor: pointer;">
                        ${playerName}
                    </label>
                    <span style="color: #4CAF50; font-weight: bold;">${player.rating}</span>
                </div>
            `;
        });
        
        container.innerHTML = html;
        updateSelectedPlayersCount();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    function updateSelectedPlayersCount() {
        const selectedCount = document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked').length;
        document.getElementById('selectedPlayersCount').textContent = selectedCount;
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    async function generateTournament() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        const tournamentName = document.getElementById('tournamentName').value.trim();
        const tournamentType = document.getElementById('tournamentType').value;
        
        if (!tournamentName) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
            return;
        }
        
        let selectedPlayers = [];
        let selectedTeams = [];
        let requiredPlayers = 0;
        let tournamentTypeName = '';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞ –∏ –ø–æ–ª—É—á–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        switch(tournamentType) {
            case 'round_robin_3':
                requiredPlayers = 3;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –∏–≥—Ä–æ–∫–∞)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 3) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 3 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'round_robin_4':
                requiredPlayers = 4;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (4 –∏–≥—Ä–æ–∫–∞)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 4) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 4 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'round_robin_5':
                requiredPlayers = 5;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –∏–≥—Ä–æ–∫–æ–≤)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 5) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 5 –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
                    return;
                }
                break;
            case 'round_robin_6':
                requiredPlayers = 6;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (6 –∏–≥—Ä–æ–∫–æ–≤)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 6) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 6 –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
                    return;
                }
                break;
            case 'single_elimination_4':
                requiredPlayers = 4;
                tournamentTypeName = '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4 –∏–≥—Ä–æ–∫–∞)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 4) {
                    showNotification(`–î–ª—è –æ–ª–∏–º–ø–∏–π—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 4 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'single_elimination_8':
                requiredPlayers = 8;
                tournamentTypeName = '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8 –∏–≥—Ä–æ–∫–æ–≤)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 8) {
                    showNotification(`–î–ª—è –æ–ª–∏–º–ø–∏–π—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 8 –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
                    return;
                }
                break;
            case 'double_elimination_4':
                requiredPlayers = 4;
                tournamentTypeName = '–î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è (4 –∏–≥—Ä–æ–∫–∞)';
                selectedPlayers = Array.from(
                    document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                if (selectedPlayers.length !== 4) {
                    showNotification(`–î–ª—è –¥–≤–æ–π–Ω–æ–π —ç–ª–∏–º–∏–Ω–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 4 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'doubles_round_robin_3':
                requiredPlayers = 6; // 3 –ø–∞—Ä—ã * 2 –∏–≥—Ä–æ–∫–∞
                tournamentTypeName = '–ü–∞—Ä–Ω—ã–π –∫—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –ø–∞—Ä—ã)';
                if (doublesTeams.length !== 3) {
                    showNotification(`–î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ä–æ–≤–Ω–æ 3 –ø–∞—Ä—ã!`, 'error');
                    return;
                }
                selectedTeams = doublesTeams;
                break;
            case 'doubles_round_robin_5':
                requiredPlayers = 10; // 5 –ø–∞—Ä * 2 –∏–≥—Ä–æ–∫–∞
                tournamentTypeName = '–ü–∞—Ä–Ω—ã–π –∫—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –ø–∞—Ä)';
                if (doublesTeams.length !== 5) {
                    showNotification(`–î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ä–æ–≤–Ω–æ 5 –ø–∞—Ä!`, 'error');
                    return;
                }
                selectedTeams = doublesTeams;
                break;
            default:
                showNotification('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
                return;
        }
        
        // –°–æ–∑–¥–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
        const newTournament = {
            id: Date.now().toString(),
            name: tournamentName,
            type: tournamentType,
            type_name: tournamentTypeName,
            players: tournamentType.includes('doubles') ? selectedTeams.map(t => t.name) : selectedPlayers,
            teams: tournamentType.includes('doubles') ? selectedTeams : null,
            status: 'active',
            created_at: new Date().toISOString(),
            winner: null,
            final_match_id: null
        };
        
        try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            const { error } = await supabaseClient
                .from('tournaments')
                .insert({
                    id: newTournament.id,
                    name: newTournament.name,
                    type: newTournament.type,
                    type_name: newTournament.type_name,
                    players: newTournament.players,
                    teams: newTournament.teams,
                    status: newTournament.status,
                    created_at: newTournament.created_at,
                    winner: newTournament.winner,
                    final_match_id: newTournament.final_match_id
                });
            
            if (error) throw error;
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—á–∏ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞
            const tournamentMatches = generateTournamentMatches(newTournament);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Ç—á–∏ –≤ Supabase
            for (const match of tournamentMatches) {
                await supabaseClient
                    .from('tournament_matches')
                    .insert({
                        id: match.id,
                        tournament_id: newTournament.id,
                        round: match.round,
                        match_number: match.match_number,
                        player1: match.player1,
                        player2: match.player2,
                        player1_team: match.player1_team,
                        player2_team: match.player2_team,
                        winner: match.winner,
                        score: match.score,
                        player1_games: match.player1_games || 0,
                        player2_games: match.player2_games || 0,
                        player1_points: match.player1_points || 0,
                        player2_points: match.player2_points || 0,
                        is_final: match.is_final || false,
                        is_final_additional: match.is_final_additional || false,
                        status: match.status
                    });
            }
            
            tournaments.unshift(newTournament);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateTournamentsDisplay();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('tournamentName').value = '';
            if (tournamentType.includes('doubles')) {
                doublesTeams = [];
                updateDoublesTeamsDisplay();
                updateAvailablePlayersList();
            } else {
                document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]').forEach(cb => cb.checked = false);
                updateSelectedPlayersCount();
            }
            
            showNotification(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${tournamentName}" —Å–æ–∑–¥–∞–Ω!`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Ç—á–µ–π —Ç—É—Ä–Ω–∏—Ä–∞
    function generateTournamentMatches(tournament) {
        const matches = [];
        
        switch(tournament.type) {
            case 'round_robin_3':
            case 'round_robin_4':
            case 'round_robin_5':
            case 'round_robin_6':
                // –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä: –∫–∞–∂–¥—ã–π –∏–≥—Ä–∞–µ—Ç —Å –∫–∞–∂–¥—ã–º
                const players = tournament.players;
                for (let i = 0; i < players.length; i++) {
                    for (let j = i + 1; j < players.length; j++) {
                        matches.push({
                            id: `${tournament.id}_${i}_${j}`,
                            tournament_id: tournament.id,
                            round: 1,
                            match_number: matches.length + 1,
                            player1: players[i],
                            player2: players[j],
                            winner: null,
                            score: null,
                            player1_games: 0,
                            player2_games: 0,
                            player1_points: 0,
                            player2_points: 0,
                            is_final: false,
                            status: 'scheduled'
                        });
                    }
                }
                break;
                
            case 'single_elimination_4':
                // –û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤
                const players4 = tournament.players;
                matches.push(
                    {
                        id: `${tournament.id}_semifinal_1`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 1,
                        player1: players4[0],
                        player2: players4[1],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    },
                    {
                        id: `${tournament.id}_semifinal_2`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 2,
                        player1: players4[2],
                        player2: players4[3],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    },
                    {
                        id: `${tournament.id}_final`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 3,
                        player1: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                        player2: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                        winner: null,
                        score: null,
                        is_final: true,
                        status: 'scheduled'
                    }
                );
                break;
                
            case 'single_elimination_8':
                // –û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è 8 –∏–≥—Ä–æ–∫–æ–≤ (—á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª—ã, –ø–æ–ª—É—Ñ–∏–Ω–∞–ª—ã, —Ñ–∏–Ω–∞–ª)
                const players8 = tournament.players;
                for (let i = 0; i < 4; i++) {
                    matches.push({
                        id: `${tournament.id}_quarterfinal_${i + 1}`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: i + 1,
                        player1: players8[i * 2],
                        player2: players8[i * 2 + 1],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    });
                }
                
                for (let i = 0; i < 2; i++) {
                    matches.push({
                        id: `${tournament.id}_semifinal_${i + 1}`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 5 + i,
                        player1: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ —á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª–æ–≤
                        player2: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ —á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª–æ–≤
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    });
                }
                
                matches.push({
                    id: `${tournament.id}_final`,
                    tournament_id: tournament.id,
                    round: 3,
                    match_number: 7,
                    player1: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                    player2: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                    winner: null,
                    score: null,
                    is_final: true,
                    status: 'scheduled'
                });
                break;
                
            case 'double_elimination_4':
                // –î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤
                const playersDE4 = tournament.players;
                matches.push(
                    {
                        id: `${tournament.id}_upper_1`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 1,
                        player1: playersDE4[0],
                        player2: playersDE4[1],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'upper'
                    },
                    {
                        id: `${tournament.id}_upper_2`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 2,
                        player1: playersDE4[2],
                        player2: playersDE4[3],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'upper'
                    },
                    {
                        id: `${tournament.id}_lower_1`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 3,
                        player1: null, // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π –∏–∑ upper_1
                        player2: null, // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π –∏–∑ upper_2
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'lower'
                    },
                    {
                        id: `${tournament.id}_upper_final`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 4,
                        player1: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å upper_1
                        player2: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å upper_2
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'upper'
                    },
                    {
                        id: `${tournament.id}_lower_final`,
                        tournament_id: tournament.id,
                        round: 3,
                        match_number: 5,
                        player1: null, // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π upper_final
                        player2: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å lower_1
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'lower'
                    },
                    {
                        id: `${tournament.id}_grand_final`,
                        tournament_id: tournament.id,
                        round: 4,
                        match_number: 6,
                        player1: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å upper_final
                        player2: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å lower_final
                        winner: null,
                        score: null,
                        is_final: true,
                        status: 'scheduled',
                        bracket: 'grand'
                    }
                );
                break;
                
            case 'doubles_round_robin_3':
            case 'doubles_round_robin_5':
                // –ü–∞—Ä–Ω—ã–π –∫—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä
                const teams = tournament.teams;
                for (let i = 0; i < teams.length; i++) {
                    for (let j = i + 1; j < teams.length; j++) {
                        matches.push({
                            id: `${tournament.id}_team_${i}_${j}`,
                            tournament_id: tournament.id,
                            round: 1,
                            match_number: matches.length + 1,
                            player1: teams[i].name,
                            player2: teams[j].name,
                            player1_team: teams[i],
                            player2_team: teams[j],
                            winner: null,
                            score: null,
                            player1_games: 0,
                            player2_games: 0,
                            player1_points: 0,
                            player2_points: 0,
                            is_final: false,
                            is_final_additional: false,
                            status: 'scheduled'
                        });
                    }
                }
                
                // –î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 3 –ø–∞—Ä—ã –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –æ –≤–æ–∑–º–æ–∂–Ω–æ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –º–∞—Ç—á–µ
                if (teams.length === 3) {
                    matches.push({
                        id: `${tournament.id}_additional_final`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: matches.length + 1,
                        player1: null,
                        player2: null,
                        player1_team: null,
                        player2_team: null,
                        winner: null,
                        score: null,
                        is_final: true,
                        is_final_additional: true,
                        status: 'hidden' // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—ã–π –º–∞—Ç—á
                    });
                }
                break;
        }
        
        return matches;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function updateTournamentsDisplay() {
        const container = document.getElementById('tournamentsList');
        if (!container) return;
        
        if (tournaments.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: #f8f9fa; border-radius: 12px;">
                    <h3 style="color: #666; margin-bottom: 15px;">üèì –¢—É—Ä–Ω–∏—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p style="color: #888;">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç—É—Ä–Ω–∏—Ä —Å –ø–æ–º–æ—â—å—é –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –≤—ã—à–µ!</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        tournaments.forEach(tournament => {
            const tournamentMatchesCount = tournamentMatches.filter(m => m.tournament_id === tournament.id).length;
            const completedMatches = tournamentMatches.filter(m => m.tournament_id === tournament.id && m.winner).length;
            const winner = tournament.winner ? players[tournament.winner] : null;
            
            // –ù–∞—Ö–æ–¥–∏–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const tournamentPhoto = tournamentPhotos.find(p => p.tournament_id === tournament.id);
            
            html += `
                <div class="tournament-card ${winner ? 'winner' : ''}">
                    <div class="tournament-header">
                        <div class="tournament-name">${tournament.name}</div>
                        <div class="tournament-type">${tournament.type_name}</div>
                    </div>
                    
                    ${tournamentPhoto ? `
                        <div style="margin: 15px 0; border-radius: 8px; overflow: hidden;">
                            <img src="${tournamentPhoto.photo_url}" 
                                 style="width: 100%; height: 150px; object-fit: cover;"
                                 onerror="this.style.display='none'">
                        </div>
                    ` : ''}
                    
                    <div class="tournament-stats">
                        <div class="stat-item">
                            <div class="stat-value-large">${tournament.players.length}</div>
                            <div class="stat-label">${tournament.type.includes('doubles') ? '–ü–∞—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-large">${completedMatches}/${tournamentMatchesCount}</div>
                            <div class="stat-label">–ú–∞—Ç—á–µ–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-large">${tournament.status === 'completed' ? 'üèÅ' : 'üèÉ'}</div>
                            <div class="stat-label">–°—Ç–∞—Ç—É—Å</div>
                        </div>
                    </div>
                    
                    ${winner ? `
                        <div class="tournament-winner">
                            ${
                                tournament.type.includes('doubles') && tournament.teams ? 
                                `<div style="font-size: 2em; margin-right: 10px;">üèì</div>` : 
                                `<img src="${winner.avatar}" class="winner-avatar" 
                                     onerror="this.src='https://i.pravatar.cc/150?img=3'}">`
                            }
                            <div class="winner-info">
                                <div class="winner-label">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</div>
                                <div class="winner-name">${tournament.winner}</div>
                            </div>
                        </div>
                    ` : `
                        <div style="padding: 10px; background: #e8f5e9; border-radius: 8px; margin-top: 15px; text-align: center;">
                            ‚è≥ –¢—É—Ä–Ω–∏—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
                        </div>
                    `}
                    
                    <div class="tournament-actions">
                        <button class="view-tournament-btn" onclick="viewTournament('${tournament.id}')">
                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                        ${isAdmin ? `
                            <button class="delete-tournament-btn" onclick="deleteTournament('${tournament.id}')">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–∞
    function viewTournament(tournamentId) {
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('tournamentPageContainer').style.display = 'block';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—É—Ä–Ω–∏—Ä–µ
        document.getElementById('tournamentPageName').textContent = tournament.name;
        
        const metaContainer = document.getElementById('tournamentPageMeta');
        metaContainer.innerHTML = `
            <div>üé≤ –¢–∏–ø: ${tournament.type_name}</div>
            <div>üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${tournament.players.length}</div>
            <div>üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date(tournament.created_at).toLocaleDateString('ru-RU')}</div>
            <div>üèÅ –°—Ç–∞—Ç—É—Å: ${tournament.status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</div>
        `;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        const winnerSection = document.getElementById('tournamentWinnerSection');
        if (tournament.winner) {
            const winner = players[tournament.winner];
            winnerSection.innerHTML = `
                <div style="display: flex; align-items: center; gap: 20px; padding: 20px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 12px; color: #333;">
                    <div style="font-size: 3em;">üèÜ</div>
                    <div style="flex: 1;">
                        <div style="font-size: 1.5em; font-weight: bold;">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å —Ç—É—Ä–Ω–∏—Ä–∞</div>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            ${
                                tournament.type.includes('doubles') && tournament.teams ? 
                                `<div style="font-size: 3em;">üèì</div>` : 
                                `<img src="${winner.avatar}" style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid white;"
                                     onerror="this.src='https://i.pravatar.cc/150?img=3'}">`
                            }
                            <div>
                                <div style="font-size: 1.8em; font-weight: bold;">${tournament.winner}</div>
                                ${
                                    tournament.type.includes('doubles') && tournament.teams ?
                                    `<div style="font-size: 1.2em; color: #2E7D32;">–ü–∞—Ä–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä</div>` :
                                    `<div style="font-size: 1.2em; color: #2E7D32;">–†–µ–π—Ç–∏–Ω–≥: ${winner.rating}</div>`
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;
            winnerSection.style.display = 'block';
        } else {
            winnerSection.style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
        const tournamentPhoto = tournamentPhotos.find(p => p.tournament_id === tournament.id);
        const photoContainer = document.getElementById('tournamentPhotoContainer');
        const photoElement = document.getElementById('tournamentPhoto');
        const photoPlaceholder = document.getElementById('tournamentPhotoPlaceholder');
        
        if (tournamentPhoto) {
            photoElement.src = tournamentPhoto.photo_url;
            photoElement.style.display = 'block';
            photoPlaceholder.style.display = 'none';
        } else {
            photoElement.style.display = 'none';
            photoPlaceholder.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        document.getElementById('uploadPhotoBtn').style.display = isAdmin ? 'block' : 'none';
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä–Ω—É—é —Å–µ—Ç–∫—É
        displayTournamentBracket(tournament);
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞ (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
        displayTournamentMatches(tournament);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        photoElement.dataset.tournamentId = tournament.id;
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.scrollTo(0, 0);
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function displayRoundRobinTable(tournament, container, matches) {
        if (tournament.type.includes('doubles')) {
            // –î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const teams = tournament.teams || [];
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
            const stats = {};
            teams.forEach(team => {
                stats[team.name] = {
                    wins: 0,
                    losses: 0,
                    games_won: 0,
                    games_lost: 0,
                    points_won: 0,
                    points_lost: 0,
                    matches_played: 0
                };
            });
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –º–∞—Ç—á–µ–π
            matches.forEach(match => {
                if (match.winner) {
                    if (match.winner === match.player1) {
                        stats[match.player1].wins++;
                        stats[match.player2].losses++;
                    } else if (match.winner === match.player2) {
                        stats[match.player2].wins++;
                        stats[match.player1].losses++;
                    }
                    
                    stats[match.player1].games_won += (match.player1_games || 0);
                    stats[match.player1].games_lost += (match.player2_games || 0);
                    stats[match.player2].games_won += (match.player2_games || 0);
                    stats[match.player2].games_lost += (match.player1_games || 0);
                    
                    stats[match.player1].points_won += (match.player1_points || 0);
                    stats[match.player1].points_lost += (match.player2_points || 0);
                    stats[match.player2].points_won += (match.player2_points || 0);
                    stats[match.player2].points_lost += (match.player1_points || 0);
                    
                    stats[match.player1].matches_played++;
                    stats[match.player2].matches_played++;
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã
            const sortedTeams = [...teams].sort((a, b) => {
                const statA = stats[a.name];
                const statB = stats[b.name];
                
                // –ü–æ –ø–æ–±–µ–¥–∞–º
                if (statB.wins !== statA.wins) {
                    return statB.wins - statA.wins;
                }
                
                // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –ø–∞—Ä—Ç–∏–π
                const gamesDiffA = statA.games_won - statA.games_lost;
                const gamesDiffB = statB.games_won - statB.games_lost;
                if (gamesDiffB !== gamesDiffA) {
                    return gamesDiffB - gamesDiffA;
                }
                
                // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –æ—á–∫–æ–≤
                const pointsDiffA = statA.points_won - statA.points_lost;
                const pointsDiffB = statB.points_won - statB.points_lost;
                return pointsDiffB - pointsDiffA;
            });
            
            let html = `
                <h3>üèì –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–ü–∞—Ä–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä)</h3>
                <div class="table-container">
                    <table class="round-robin-table">
                        <thead>
                            <tr>
                                <th>–ú–µ—Å—Ç–æ</th>
                                <th>–ü–∞—Ä–∞</th>
                                <th>–ò–≥—Ä–æ–∫–∏</th>
                                <th>–ú–∞—Ç—á–∏</th>
                                <th>–í-–ü</th>
                                <th>–ü–∞—Ä—Ç–∏–∏ +/-</th>
                                <th>–û—á–∫–∏ +/-</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            sortedTeams.forEach((team, index) => {
                const stat = stats[team.name];
                const gamesDiff = stat.games_won - stat.games_lost;
                const pointsDiff = stat.points_won - stat.points_lost;
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>–ü–∞—Ä–∞ ${index + 1}</td>
                        <td>
                            <div style="font-weight: bold;">${team.players[0]} / ${team.players[1]}</div>
                            <div style="font-size: 0.9em; color: #666;">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: ${Math.round(team.rating)}</div>
                        </td>
                        <td>${stat.matches_played}</td>
                        <td>${stat.wins}-${stat.losses}</td>
                        <td>${gamesDiff > 0 ? '+' : ''}${gamesDiff}</td>
                        <td>${pointsDiff > 0 ? '+' : ''}${pointsDiff}</td>
                        <td>
                            <button class="action-btn add-btn" onclick="enterMatchResult('${tournament.id}', null, null, '${team.name}')" 
                                    ${!isAdmin ? 'disabled style="opacity: 0.5;"' : ''}>
                                ‚úèÔ∏è –í–Ω–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –º–∞—Ç—á–µ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 3 –ø–∞—Ä—ã
            if (teams.length === 3) {
                const topTeams = sortedTeams.slice(0, 2);
                const stat1 = stats[topTeams[0].name];
                const stat2 = stats[topTeams[1].name];
                
                if (stat1.wins === stat2.wins && stat1.wins > 0) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—ã–≥—Ä–∞–Ω–Ω—ã–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á
                    const additionalFinalMatch = matches.find(m => 
                        m.tournament_id === tournament.id && m.is_final_additional
                    );
                    
                    if (additionalFinalMatch && additionalFinalMatch.status === 'hidden') {
                        html += `
                            <div class="doubles-final-note">
                                <strong>‚ÑπÔ∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á!</strong><br>
                                –î–≤–µ –ª—É—á—à–∏–µ –ø–∞—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ (${stat1.wins}).
                                –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏:<br>
                                <strong>${topTeams[0].players[0]} / ${topTeams[0].players[1]}</strong> vs 
                                <strong>${topTeams[1].players[0]} / ${topTeams[1].players[1]}</strong>
                            </div>
                        `;
                    } else if (additionalFinalMatch && additionalFinalMatch.status === 'scheduled') {
                        html += `
                            <div class="doubles-final-note">
                                <strong>‚ÑπÔ∏è –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á!</strong><br>
                                –î–≤–µ –ª—É—á—à–∏–µ –ø–∞—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ (${stat1.wins}).
                                –û–∂–∏–¥–∞–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏:<br>
                                <strong>${topTeams[0].players[0]} / ${topTeams[0].players[1]}</strong> vs 
                                <strong>${topTeams[1].players[0]} / ${topTeams[1].players[1]}</strong>
                            </div>
                        `;
                    }
                }
            }
            
            container.innerHTML = html;
        } else {
            // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
            const playersList = tournament.players;
            
            const stats = {};
            playersList.forEach(player => {
                stats[player] = {
                    wins: 0,
                    losses: 0,
                    games_won: 0,
                    games_lost: 0,
                    points_won: 0,
                    points_lost: 0,
                    matches_played: 0
                };
            });
            
            matches.forEach(match => {
                if (match.winner) {
                    if (match.winner === match.player1) {
                        stats[match.player1].wins++;
                        stats[match.player2].losses++;
                    } else if (match.winner === match.player2) {
                        stats[match.player2].wins++;
                        stats[match.player1].losses++;
                    }
                    
                    stats[match.player1].games_won += (match.player1_games || 0);
                    stats[match.player1].games_lost += (match.player2_games || 0);
                    stats[match.player2].games_won += (match.player2_games || 0);
                    stats[match.player2].games_lost += (match.player1_games || 0);
                    
                    stats[match.player1].points_won += (match.player1_points || 0);
                    stats[match.player1].points_lost += (match.player2_points || 0);
                    stats[match.player2].points_won += (match.player2_points || 0);
                    stats[match.player2].points_lost += (match.player1_points || 0);
                    
                    stats[match.player1].matches_played++;
                    stats[match.player2].matches_played++;
                }
            });
            
            const sortedPlayers = [...playersList].sort((a, b) => {
                const statA = stats[a];
                const statB = stats[b];
                
                if (statB.wins !== statA.wins) {
                    return statB.wins - statA.wins;
                }
                
                const gamesDiffA = statA.games_won - statA.games_lost;
                const gamesDiffB = statB.games_won - statB.games_lost;
                if (gamesDiffB !== gamesDiffA) {
                    return gamesDiffB - gamesDiffA;
                }
                
                const pointsDiffA = statA.points_won - statA.points_lost;
                const pointsDiffB = statB.points_won - statB.points_lost;
                return pointsDiffB - pointsDiffA;
            });
            
            let html = `
                <h3>üèì –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h3>
                <div class="table-container">
                    <table class="round-robin-table">
                        <thead>
                            <tr>
                                <th>–ú–µ—Å—Ç–æ</th>
                                <th>–ò–≥—Ä–æ–∫</th>
                                <th>–ú–∞—Ç—á–∏</th>
                                <th>–í-–ü</th>
                                <th>–ü–∞—Ä—Ç–∏–∏ +/-</th>
                                <th>–û—á–∫–∏ +/-</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            sortedPlayers.forEach((player, index) => {
                const stat = stats[player];
                const gamesDiff = stat.games_won - stat.games_lost;
                const pointsDiff = stat.points_won - stat.points_lost;
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <div class="player-cell" onclick="showPlayerProfile('${player}')" style="cursor: pointer;">
                                <img src="${players[player]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                     class="avatar" style="width: 32px; height: 32px;">
                                <span>${player}</span>
                            </div>
                        </td>
                        <td>${stat.matches_played}</td>
                        <td>${stat.wins}-${stat.losses}</td>
                        <td>${gamesDiff > 0 ? '+' : ''}${gamesDiff}</td>
                        <td>${pointsDiff > 0 ? '+' : ''}${pointsDiff}</td>
                        <td>
                            <button class="action-btn add-btn" onclick="enterMatchResult('${tournament.id}', '${player}')" 
                                    ${!isAdmin ? 'disabled style="opacity: 0.5;"' : ''}>
                                ‚úèÔ∏è –í–Ω–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
    function displayTournamentBracket(tournament) {
        const container = document.getElementById('tournamentBracket');
        if (!container) return;
        
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id);
        
        if (tournament.type.includes('round_robin')) {
            // –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            displayRoundRobinTable(tournament, container, matches);
        } else {
            // –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ–±–∫–∏
            displayBracket(tournament, container, matches);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
    function displayBracket(tournament, container, matches) {
        let html = '<h3>üèÜ –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞</h3>';
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ —Ä–∞—É–Ω–¥–∞–º
        const rounds = {};
        matches.forEach(match => {
            if (!rounds[match.round]) {
                rounds[match.round] = [];
            }
            rounds[match.round].push(match);
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞—É–Ω–¥—ã
        const sortedRounds = Object.keys(rounds).sort((a, b) => a - b);
        
        html += '<div class="bracket-container">';
        
        sortedRounds.forEach(roundNum => {
            const roundMatches = rounds[roundNum];
            
            html += `
                <div class="bracket-round">
                    <div style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #4CAF50;">
                        ${getRoundName(parseInt(roundNum), tournament.type)}
                    </div>
            `;
            
            roundMatches.forEach(match => {
                const player1 = match.player1 ? players[match.player1] : null;
                const player2 = match.player2 ? players[match.player2] : null;
                
                html += `
                    <div class="bracket-match ${match.is_final ? 'final' : ''}">
                        <div class="bracket-player ${match.winner === match.player1 ? 'winner' : ''}">
                            <span>${player1 ? player1.name || match.player1 : 'TBD'}</span>
                            ${match.score ? `<span class="player-score">${getPlayerScore(match, 1)}</span>` : ''}
                        </div>
                        <div style="text-align: center; margin: 5px 0; font-weight: bold; color: #666;">vs</div>
                        <div class="bracket-player ${match.winner === match.player2 ? 'winner' : ''}">
                            <span>${player2 ? player2.name || match.player2 : 'TBD'}</span>
                            ${match.score ? `<span class="player-score">${getPlayerScore(match, 2)}</span>` : ''}
                        </div>
                        ${match.winner ? `
                            <div style="text-align: center; margin-top: 10px; padding: 5px; background: #4CAF50; color: white; border-radius: 4px; font-size: 0.9em;">
                                –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${match.winner}
                            </div>
                        ` : ''}
                        ${isAdmin ? `
                            <div style="text-align: center; margin-top: 10px;">
                                <button class="action-btn add-btn" onclick="enterMatchResult('${tournament.id}', null, '${match.id}')" style="width: 100%; padding: 5px;">
                                    ‚úèÔ∏è –í–Ω–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
        });
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞—É–Ω–¥–∞
    function getRoundName(round, tournamentType) {
        if (tournamentType.includes('single_elimination')) {
            switch(round) {
                case 1: return '1/4 —Ñ–∏–Ω–∞–ª–∞';
                case 2: return '1/2 —Ñ–∏–Ω–∞–ª–∞';
                case 3: return '–§–∏–Ω–∞–ª';
                default: return `–†–∞—É–Ω–¥ ${round}`;
            }
        } else if (tournamentType.includes('double_elimination')) {
            switch(round) {
                case 1: return '–í–µ—Ä—Ö–Ω—è—è —Å–µ—Ç–∫–∞';
                case 2: return '–ù–∏–∂–Ω—è—è —Å–µ—Ç–∫–∞';
                case 3: return '–§–∏–Ω–∞–ª –Ω–∏–∂–Ω–µ–π';
                case 4: return '–ì—Ä–∞–Ω–¥-—Ñ–∏–Ω–∞–ª';
                default: return `–†–∞—É–Ω–¥ ${round}`;
            }
        }
        return `–†–∞—É–Ω–¥ ${round}`;
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
    function getPlayerScore(match, playerNumber) {
        if (!match.score) return '0';
        
        if (playerNumber === 1) {
            return match.player1_games || '0';
        } else {
            return match.player2_games || '0';
        }
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –º–∞—Ç—á–µ–π —Ç—É—Ä–Ω–∏—Ä–∞
    function displayTournamentMatches(tournament) {
        const container = document.getElementById('tournamentMatchesList');
        if (!container) return;
        
        const matches = tournamentMatches
            .filter(m => m.tournament_id === tournament.id && m.status !== 'hidden')
            .sort((a, b) => {
                if (a.round !== b.round) return a.round - b.round;
                return a.match_number - b.match_number;
            });
        
        if (matches.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
            return;
        }
        
        let html = '';
        
        matches.forEach(match => {
            const isDoubles = tournament.type.includes('doubles');
            const team1 = match.player1_team || null;
            const team2 = match.player2_team || null;
            
            if (isDoubles && (team1 || team2)) {
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä–Ω–æ–≥–æ –º–∞—Ç—á–∞
                const player1Names = team1 ? `${team1.players[0]} / ${team1.players[1]}` : match.player1 || 'TBD';
                const player2Names = team2 ? `${team2.players[0]} / ${team2.players[1]}` : match.player2 || 'TBD';
                
                html += `
                    <div class="doubles-match-result ${match.is_final ? 'final' : ''}">
                        <div class="doubles-match-teams">
                            <div style="flex: 1; text-align: center;">
                                <div style="font-weight: bold; font-size: 14px;">${player1Names}</div>
                                ${match.player1_games !== undefined ? `
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                        –ü–∞—Ä—Ç–∏–∏: ${match.player1_games}, –û—á–∫–∏: ${match.player1_points || 0}
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="doubles-match-vs">vs</div>
                            
                            <div style="flex: 1; text-align: center;">
                                <div style="font-weight: bold; font-size: 14px;">${player2Names}</div>
                                ${match.player2_games !== undefined ? `
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                        –ü–∞—Ä—Ç–∏–∏: ${match.player2_games}, –û—á–∫–∏: ${match.player2_points || 0}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 5px; margin-top: 10px;">
                            ${match.score ? `
                                <div style="background: #4CAF50; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; min-width: 60px; text-align: center;">
                                    ${match.score}
                                </div>
                                <div style="text-align: center; font-size: 12px; color: #666;">
                                    ${match.is_final_additional ? 'üèÜ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô –§–ò–ù–ê–õ' : (match.is_final ? '–§–ò–ù–ê–õ' : `–†–∞—É–Ω–¥ ${match.round}`)}
                                    ${match.winner ? ` ¬∑ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${match.winner}` : ''}
                                </div>
                            ` : `
                                <div style="padding: 5px 15px; background: #ff9800; color: white; border-radius: 20px; font-weight: bold; font-size: 13px;">
                                    ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è
                                </div>
                            `}
                        </div>
                        
                        ${match.is_final_additional ? `
                            <div class="doubles-final-note">
                                <strong>‚ÑπÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á</strong><br>
                                –≠—Ç–æ—Ç –º–∞—Ç—á –∏–≥—Ä–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –¥–≤–µ –ª—É—á—à–∏–µ –ø–∞—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –ø–æ—Å–ª–µ –∫—Ä—É–≥–æ–≤–æ–≥–æ —ç—Ç–∞–ø–∞.
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –º–∞—Ç—á–∞ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
                const player1 = players[match.player1];
                const player2 = players[match.player2];
                
                html += `
                    <div class="match-result ${match.is_final ? 'final' : ''}">
                        <div class="match-players">
                            <div class="player-match-info">
                                <img src="${player1?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                     style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer;"
                                     onclick="showPlayerProfile('${match.player1}')">
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; font-size: 14px;">${match.player1 || 'TBD'}</div>
                                    ${match.player1_games !== undefined ? `
                                        <div class="match-details" style="font-size: 12px;">
                                            –ü–∞—Ä—Ç–∏–∏: ${match.player1_games}, –û—á–∫–∏: ${match.player1_points || 0}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="match-vs">vs</div>
                            
                            <div class="player-match-info">
                                <div style="flex: 1; text-align: right;">
                                    <div style="font-weight: bold; font-size: 14px;">${match.player2 || 'TBD'}</div>
                                    ${match.player2_games !== undefined ? `
                                        <div class="match-details" style="font-size: 12px; text-align: right;">
                                            –ü–∞—Ä—Ç–∏–∏: ${match.player2_games}, –û—á–∫–∏: ${match.player2_points || 0}
                                        </div>
                                    ` : ''}
                                </div>
                                <img src="${player2?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                     style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer; margin-left: 10px;"
                                     onclick="showPlayerProfile('${match.player2}')">
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 5px; margin-top: 10px;">
                            ${match.score ? `
                                <div class="match-score">${match.score}</div>
                                <div class="match-details" style="text-align: center;">
                                    ${match.is_final ? '–§–ò–ù–ê–õ' : `–†–∞—É–Ω–¥ ${match.round}`}
                                    ${match.winner ? ` ¬∑ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${match.winner}` : ''}
                                </div>
                            ` : `
                                <div style="padding: 5px 15px; background: #ff9800; color: white; border-radius: 20px; font-weight: bold; font-size: 13px;">
                                    ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }
        });
        
        container.innerHTML = html;
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–∞—Ç—á–∞
    async function enterMatchResult(tournamentId, playerName, matchId = null, teamName = null) {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–Ω–æ—Å–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!', 'error');
            return;
        }
        
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        let match;
        
        if (matchId) {
            // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–∞—Ç—á
            match = tournamentMatches.find(m => m.id === matchId && m.tournament_id === tournamentId);
        } else if (tournament.type.includes('doubles') && teamName) {
            // –î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞—Ö–æ–¥–∏–º –º–∞—Ç—á —Å —É—á–∞—Å—Ç–∏–µ–º –∫–æ–º–∞–Ω–¥—ã
            const dialogDiv = document.createElement('div');
            dialogDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const dialogContent = document.createElement('div');
            dialogContent.style.cssText = `
                background: white;
                padding: 25px;
                border-radius: 12px;
                max-width: 500px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ (–∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ç—É—Ä–Ω–∏—Ä–∞, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π)
            const possibleOpponents = tournament.teams.filter(t => t.name !== teamName);
            
            let selectHtml = `<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</option>`;
            possibleOpponents.forEach(opponent => {
                selectHtml += `<option value="${opponent.name}">${opponent.players[0]} / ${opponent.players[1]}</option>`;
            });
            
            dialogContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –¥–ª—è –ø–∞—Ä—ã ${teamName}</h3>
                <div class="form-group">
                    <label>–°–æ–ø–µ—Ä–Ω–∏–∫:</label>
                    <select id="opponentSelect" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                        ${selectHtml}
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button id="cancelBtn" style="flex: 1; padding: 12px; background: #f5f5f5; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button id="confirmBtn" style="flex: 1; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            `;
            
            dialogDiv.appendChild(dialogContent);
            document.body.appendChild(dialogDiv);
            
            return new Promise((resolve) => {
                document.getElementById('cancelBtn').onclick = () => {
                    document.body.removeChild(dialogDiv);
                    resolve();
                };
                
                document.getElementById('confirmBtn').onclick = () => {
                    const opponentSelect = document.getElementById('opponentSelect');
                    const opponent = opponentSelect.value;
                    
                    if (!opponent) {
                        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞!', 'error');
                        return;
                    }
                    
                    document.body.removeChild(dialogDiv);
                    
                    // –ù–∞—Ö–æ–¥–∏–º –º–∞—Ç—á
                    match = tournamentMatches.find(m => 
                        m.tournament_id === tournamentId &&
                        ((m.player1 === teamName && m.player2 === opponent) ||
                         (m.player1 === opponent && m.player2 === teamName))
                    );
                    
                    if (!match) {
                        showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                        resolve();
                        return;
                    }
                    
                    continueMatchResultEntry(match, tournamentId);
                    resolve();
                };
            });
            
        } else if (playerName && tournament.type.includes('round_robin') && !tournament.type.includes('doubles')) {
            // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const dialogDiv = document.createElement('div');
            dialogDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const dialogContent = document.createElement('div');
            dialogContent.style.cssText = `
                background: white;
                padding: 25px;
                border-radius: 12px;
                max-width: 500px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            const possibleOpponents = tournament.players.filter(p => p !== playerName);
            
            let selectHtml = `<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</option>`;
            possibleOpponents.forEach(opponent => {
                selectHtml += `<option value="${opponent}">${opponent}</option>`;
            });
            
            dialogContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –¥–ª—è ${playerName}</h3>
                <div class="form-group">
                    <label>–°–æ–ø–µ—Ä–Ω–∏–∫:</label>
                    <select id="opponentSelect" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                        ${selectHtml}
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button id="cancelBtn" style="flex: 1; padding: 12px; background: #f5f5f5; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button id="confirmBtn" style="flex: 1; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            `;
            
            dialogDiv.appendChild(dialogContent);
            document.body.appendChild(dialogDiv);
            
            return new Promise((resolve) => {
                document.getElementById('cancelBtn').onclick = () => {
                    document.body.removeChild(dialogDiv);
                    resolve();
                };
                
                document.getElementById('confirmBtn').onclick = () => {
                    const opponentSelect = document.getElementById('opponentSelect');
                    const opponent = opponentSelect.value;
                    
                    if (!opponent) {
                        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞!', 'error');
                        return;
                    }
                    
                    document.body.removeChild(dialogDiv);
                    
                    match = tournamentMatches.find(m => 
                        m.tournament_id === tournamentId &&
                        ((m.player1 === playerName && m.player2 === opponent) ||
                         (m.player1 === opponent && m.player2 === playerName))
                    );
                    
                    if (!match) {
                        showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                        resolve();
                        return;
                    }
                    
                    continueMatchResultEntry(match, tournamentId);
                    resolve();
                };
            });
        } else {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞—Ç—á!', 'error');
            return;
        }
        
        if (match) {
            continueMatchResultEntry(match, tournamentId);
        }
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–∞—Ç—á–∞
    async function continueMatchResultEntry(match, tournamentId) {
        if (!match) {
            showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }

        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }

        if (match.winner) {
            if (!confirm('–†–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≤–Ω–µ—Å–µ–Ω. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å?')) {
                return;
            }
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        let scorePrompt = `–í–≤–µ–¥–∏—Ç–µ —Å—á–µ—Ç –º–∞—Ç—á–∞ ${match.player1} vs ${match.player2}`;
        if (tournament.type.includes('doubles')) {
            const team1 = match.player1_team ? `${match.player1_team.players[0]}/${match.player1_team.players[1]}` : match.player1;
            const team2 = match.player2_team ? `${match.player2_team.players[0]}/${match.player2_team.players[1]}` : match.player2;
            scorePrompt = `–í–≤–µ–¥–∏—Ç–µ —Å—á–µ—Ç –º–∞—Ç—á–∞ ${team1} vs ${team2}`;
        }
        
        scorePrompt += ' (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3:2):';
        
        const score = prompt(scorePrompt);
        if (!score) return;

        const [player1GamesStr, player2GamesStr] = score.split(':');
        const player1Games = parseInt(player1GamesStr);
        const player2Games = parseInt(player2GamesStr);

        if (isNaN(player1Games) || isNaN(player2Games)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—á–µ—Ç–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç "3:2"', 'error');
            return;
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        let winner;
        if (player1Games > player2Games) {
            winner = match.player1;
        } else if (player2Games > player1Games) {
            winner = match.player2;
        } else {
            winner = 'draw';
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ—á–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–Ω–∏—Ü—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        const pointsInput = prompt('–í–≤–µ–¥–∏—Ç–µ –æ—á–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–Ω–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 11:9,11:8,9:11,11:6,11:7 —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):\n(–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ)');
        
        let player1Points = 0;
        let player2Points = 0;
        
        if (pointsInput) {
            const games = pointsInput.split(',');
            games.forEach(game => {
                const [p1PointsStr, p2PointsStr] = game.split(':');
                const p1Points = parseInt(p1PointsStr) || 0;
                const p2Points = parseInt(p2PointsStr) || 0;
                
                player1Points += p1Points;
                player2Points += p2Points;
            });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á
        match.winner = winner;
        match.score = score;
        match.player1_games = player1Games;
        match.player2_games = player2Games;
        match.player1_points = player1Points;
        match.player2_points = player2Points;
        match.status = 'completed';

        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á –≤ Supabase
            await supabaseClient
                .from('tournament_matches')
                .update({
                    winner: match.winner,
                    score: match.score,
                    player1_games: match.player1_games,
                    player2_games: match.player2_games,
                    player1_points: match.player1_points,
                    player2_points: match.player2_points,
                    status: match.status
                })
                .eq('id', match.id);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–µ–Ω –ª–∏ —Ç—É—Ä–Ω–∏—Ä
            checkTournamentCompletion(tournament);

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (document.getElementById('tournamentPageContainer').style.display === 'block') {
                viewTournament(tournamentId);
            } else {
                updateTournamentsDisplay();
            }

            showNotification('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');

        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', 'error');
        }
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function determineRoundRobinWinner(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id && m.winner);
        
        if (tournament.type.includes('doubles')) {
            // –î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const stats = {};
            tournament.teams.forEach(team => {
                stats[team.name] = {
                    wins: 0,
                    losses: 0,
                    games_won: 0,
                    games_lost: 0,
                    points_won: 0,
                    points_lost: 0,
                    matches_played: 0
                };
            });
            
            matches.forEach(match => {
                if (match.winner === match.player1) {
                    stats[match.player1].wins++;
                    stats[match.player2].losses++;
                } else if (match.winner === match.player2) {
                    stats[match.player2].wins++;
                    stats[match.player1].losses++;
                }
                
                stats[match.player1].games_won += (match.player1_games || 0);
                stats[match.player1].games_lost += (match.player2_games || 0);
                stats[match.player2].games_won += (match.player2_games || 0);
                stats[match.player2].games_lost += (match.player1_games || 0);
                
                stats[match.player1].points_won += (match.player1_points || 0);
                stats[match.player1].points_lost += (match.player2_points || 0);
                stats[match.player2].points_won += (match.player2_points || 0);
                stats[match.player2].points_lost += (match.player1_points || 0);
                
                stats[match.player1].matches_played++;
                stats[match.player2].matches_played++;
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã
            const sortedTeams = [...tournament.teams].sort((a, b) => {
                const statA = stats[a.name];
                const statB = stats[b.name];
                
                // –ü–æ –ø–æ–±–µ–¥–∞–º
                if (statB.wins !== statA.wins) {
                    return statB.wins - statA.wins;
                }
                
                // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –ø–∞—Ä—Ç–∏–π
                const gamesDiffA = statA.games_won - statA.games_lost;
                const gamesDiffB = statB.games_won - statB.games_lost;
                if (gamesDiffB !== gamesDiffA) {
                    return gamesDiffB - gamesDiffA;
                }
                
                // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –æ—á–∫–æ–≤
                const pointsDiffA = statA.points_won - statA.points_lost;
                const pointsDiffB = statB.points_won - statB.points_lost;
                return pointsDiffB - pointsDiffA;
            });
            
            // –î–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 3 –ø–∞—Ä—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–∞—Ç—á–∞
            if (sortedTeams.length === 3) {
                const topTeams = sortedTeams.slice(0, 2);
                const stat1 = stats[topTeams[0].name];
                const stat2 = stats[topTeams[1].name];
                
                // –ï—Å–ª–∏ —É –¥–≤—É—Ö –ª—É—á—à–∏—Ö –∫–æ–º–∞–Ω–¥ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥, –Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á
                if (stat1.wins === stat2.wins && stat1.wins > 0) {
                    console.log('üèì –£ –¥–≤—É—Ö –ª—É—á—à–∏—Ö –ø–∞—Ä –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á');
                    
                    // –ù–∞—Ö–æ–¥–∏–º –º–∞—Ç—á –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –¥–≤—É–º—è –∫–æ–º–∞–Ω–¥–∞–º–∏
                    const matchBetweenTopTeams = matches.find(m => 
                        (m.player1 === topTeams[0].name && m.player2 === topTeams[1].name) ||
                        (m.player1 === topTeams[1].name && m.player2 === topTeams[0].name)
                    );
                    
                    if (matchBetweenTopTeams && matchBetweenTopTeams.winner) {
                        // –ï—Å–ª–∏ –º–∞—Ç—á —É–∂–µ –±—ã–ª —Å—ã–≥—Ä–∞–Ω, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                        tournament.winner = matchBetweenTopTeams.winner;
                        tournament.final_match_id = matchBetweenTopTeams.id;
                    } else {
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á
                        const additionalFinalMatch = tournamentMatches.find(m => 
                            m.tournament_id === tournament.id && m.is_final_additional
                        );
                        
                        if (additionalFinalMatch) {
                            additionalFinalMatch.player1 = topTeams[0].name;
                            additionalFinalMatch.player2 = topTeams[1].name;
                            additionalFinalMatch.player1_team = topTeams[0];
                            additionalFinalMatch.player2_team = topTeams[1];
                            additionalFinalMatch.status = 'scheduled';
                            additionalFinalMatch.is_final = true;
                            
                            // –ü–æ–∫–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è - –Ω—É–∂–Ω–æ —Å—ã–≥—Ä–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç—á
                            console.log('‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                        }
                    }
                } else {
                    // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å - –ø–µ—Ä–≤–∞—è –≤ —Å–ø–∏—Å–∫–µ
                    if (sortedTeams.length > 0) {
                        tournament.winner = sortedTeams[0].name;
                    }
                }
            } else {
                // –î–ª—è 5 –ø–∞—Ä –ø—Ä–æ—Å—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                if (sortedTeams.length > 0) {
                    tournament.winner = sortedTeams[0].name;
                    
                    // –ù–∞—Ö–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á (–µ—Å–ª–∏ –±—ã–ª –º–µ–∂–¥—É –¥–≤—É–º—è –ª—É—á—à–∏–º–∏)
                    const finalMatch = matches.find(m => 
                        (m.player1 === sortedTeams[0].name && m.player2 === sortedTeams[1].name) ||
                        (m.player1 === sortedTeams[1].name && m.player2 === sortedTeams[0].name)
                    );
                    
                    if (finalMatch) {
                        tournament.final_match_id = finalMatch.id;
                    }
                }
            }
        } else {
            // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
            const stats = {};
            tournament.players.forEach(player => {
                stats[player] = {
                    wins: 0,
                    losses: 0,
                    games_won: 0,
                    games_lost: 0,
                    points_won: 0,
                    points_lost: 0
                };
            });
            
            matches.forEach(match => {
                if (match.winner === match.player1) {
                    stats[match.player1].wins++;
                    stats[match.player2].losses++;
                } else if (match.winner === match.player2) {
                    stats[match.player2].wins++;
                    stats[match.player1].losses++;
                }
                
                stats[match.player1].games_won += (match.player1_games || 0);
                stats[match.player1].games_lost += (match.player2_games || 0);
                stats[match.player2].games_won += (match.player2_games || 0);
                stats[match.player2].games_lost += (match.player1_games || 0);
                
                stats[match.player1].points_won += (match.player1_points || 0);
                stats[match.player1].points_lost += (match.player2_points || 0);
                stats[match.player2].points_won += (match.player2_points || 0);
                stats[match.player2].points_lost += (match.player1_points || 0);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤
            const sortedPlayers = [...tournament.players].sort((a, b) => {
                const statA = stats[a];
                const statB = stats[b];
                
                // –ü–æ –ø–æ–±–µ–¥–∞–º
                if (statB.wins !== statA.wins) {
                    return statB.wins - statA.wins;
                }
                
                // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –ø–∞—Ä—Ç–∏–π
                const gamesDiffA = statA.games_won - statA.games_lost;
                const gamesDiffB = statB.games_won - statB.games_lost;
                if (gamesDiffB !== gamesDiffA) {
                    return gamesDiffB - gamesDiffA;
                }
                
                // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –æ—á–∫–æ–≤
                const pointsDiffA = statA.points_won - statA.points_lost;
                const pointsDiffB = statB.points_won - statB.points_lost;
                return pointsDiffB - pointsDiffA;
            });
            
            // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å - –ø–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ
            if (sortedPlayers.length > 0) {
                tournament.winner = sortedPlayers[0];
                
                // –ù–∞—Ö–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á (–µ—Å–ª–∏ –±—ã–ª –º–µ–∂–¥—É –¥–≤—É–º—è –ª—É—á—à–∏–º–∏)
                const finalMatch = matches.find(m => 
                    (m.player1 === sortedPlayers[0] && m.player2 === sortedPlayers[1]) ||
                    (m.player1 === sortedPlayers[1] && m.player2 === sortedPlayers[0])
                );
                
                if (finalMatch) {
                    tournament.final_match_id = finalMatch.id;
                }
            }
        }
    }
    
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    async function checkTournamentCompletion(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id);
        const completedMatches = matches.filter(m => m.winner);
        
        console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ "${tournament.name}"`);
        console.log(`üìä –ú–∞—Ç—á–µ–π: ${completedMatches.length}/${matches.length}`);
        
        // –ï—Å–ª–∏ –≤—Å–µ –º–∞—Ç—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
        if (completedMatches.length === matches.length) {
            console.log(`‚úÖ –í—Å–µ –º–∞—Ç—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!`);
            tournament.status = 'completed';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
            if (tournament.type.includes('round_robin')) {
                determineRoundRobinWinner(tournament);
            } else {
                determineBracketWinner(tournament);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            await updateTournamentInDatabase(tournament);
            
        } else {
            // –ü–†–û–í–ï–†–Ø–ï–ú –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –î–û–°–†–û–ß–ù–û–ì–û –ó–ê–í–ï–†–®–ï–ù–ò–Ø –î–õ–Ø –ö–†–£–ì–û–í–´–• –¢–£–†–ù–ò–†–û–í
            if (tournament.type.includes('round_robin')) {
                console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞`);
                const canFinishEarly = checkEarlyTournamentFinish(tournament);
                if (canFinishEarly) {
                    console.log(`‚úÖ –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    tournament.status = 'completed';
                    determineRoundRobinWinner(tournament);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
                    await updateTournamentInDatabase(tournament);
                    
                    console.log(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${tournament.name}" –∑–∞–≤–µ—Ä—à–µ–Ω –¥–æ—Å—Ä–æ—á–Ω–æ! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${tournament.winner}`);
                } else {
                    console.log(`‚è≥ –¢—É—Ä–Ω–∏—Ä –µ—â–µ –Ω–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å`);
                }
            }
        }
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    async function updateTournamentInDatabase(tournament) {
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            await supabaseClient
                .from('tournaments')
                .update({
                    status: tournament.status,
                    winner: tournament.winner,
                    final_match_id: tournament.final_match_id
                })
                .eq('id', tournament.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥ –∏–≥—Ä–æ–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤)
            if (tournament.winner && players[tournament.winner] && !tournament.type.includes('doubles')) {
                if (!players[tournament.winner].tournament_wins) {
                    players[tournament.winner].tournament_wins = 0;
                }
                players[tournament.winner].tournament_wins++;
                await savePlayerToSupabase(tournament.winner, players[tournament.winner]);
            }
            
            console.log(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${tournament.name}" –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${tournament.winner}`);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
    function determineBracketWinner(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id);
        
        // –ù–∞—Ö–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á
        const finalMatch = matches.find(m => m.is_final);
        
        if (finalMatch && finalMatch.winner) {
            tournament.winner = finalMatch.winner;
            tournament.final_match_id = finalMatch.id;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function checkEarlyTournamentFinish(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id && m.winner);
        
        console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ "${tournament.name}"`);
        console.log(`üìä –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π: ${matches.length}`);
        
        // –î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 3 –ø–∞—Ä—ã
        if (tournament.type === 'doubles_round_robin_3' && tournament.teams && tournament.teams.length === 3) {
            // –í —Ç—É—Ä–Ω–∏—Ä–µ –Ω–∞ 3 –ø–∞—Ä—ã –≤—Å–µ–≥–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—ã–≥—Ä–∞–Ω–æ 3 –º–∞—Ç—á–∞
            // –ï—Å–ª–∏ –≤—Å–µ 3 –º–∞—Ç—á–∞ —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
            if (matches.length === 3) {
                console.log(`‚úÖ –í—Å–µ 3 –º–∞—Ç—á–∞ —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            // –ï—Å–ª–∏ —Å—ã–≥—Ä–∞–Ω–æ 2 –º–∞—Ç—á–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            if (matches.length === 2) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥
                const winStats = {};
                tournament.teams.forEach(team => {
                    winStats[team.name] = 0;
                });
                
                // –°—á–∏—Ç–∞–µ–º –ø–æ–±–µ–¥—ã
                matches.forEach(match => {
                    if (match.winner && match.winner !== 'draw') {
                        winStats[match.winner]++;
                    }
                });
                
                console.log(`üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–±–µ–¥:`, winStats);
                
                // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥
                const maxWins = Math.max(...Object.values(winStats));
                const teamsWithMaxWins = Object.keys(winStats).filter(p => winStats[p] === maxWins);
                
                // –ï—Å–ª–∏ —É –æ–¥–Ω–æ–π –ø–∞—Ä—ã 2 –ø–æ–±–µ–¥—ã, –æ–Ω–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º –º–æ–≥—É—Ç –∏–º–µ—Ç—å 1 –ø–æ–±–µ–¥—É)
                if (maxWins === 2) {
                    console.log(`üéØ –ü–∞—Ä–∞ ${teamsWithMaxWins[0]} –≤—ã–∏–≥—Ä–∞–ª–∞ 2 –º–∞—Ç—á–∞ –∏–∑ 2. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
        }
        
        // –î–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 5 –ø–∞—Ä
        if (tournament.type === 'doubles_round_robin_5' && tournament.teams && tournament.teams.length === 5) {
            // –ö–∞–∂–¥–∞—è –ø–∞—Ä–∞ –¥–æ–ª–∂–Ω–∞ —Å—ã–≥—Ä–∞—Ç—å 4 –º–∞—Ç—á–∞ (–≤—Å–µ–≥–æ 10 –º–∞—Ç—á–µ–π)
            // –ï—Å–ª–∏ –≤—Å–µ 10 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
            if (matches.length === 10) {
                console.log(`‚úÖ –í—Å–µ 10 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥
            const winStats = {};
            tournament.teams.forEach(team => {
                winStats[team.name] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞ —Å 4 –ø–æ–±–µ–¥–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–µ 5 –ø–∞—Ä)
            for (const team in winStats) {
                if (winStats[team] === 4) {
                    console.log(`üéØ –ü–∞—Ä–∞ ${team} –≤—ã–∏–≥—Ä–∞–ª–∞ –≤—Å–µ 4 –º–∞—Ç—á–∞. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–≥–Ω–∞—Ç—å –ª–∏–¥–µ—Ä–∞
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedTeams = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedTeams.length >= 2) {
                    const [leader, leaderWins] = sortedTeams[0];
                    const [second, secondWins] = sortedTeams[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    // –ï—Å–ª–∏ –ª–∏–¥–µ—Ä–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–≥–Ω–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –≤—ã–∏–≥—Ä–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∞—Ç—á–∏
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 3 –∏–≥—Ä–æ–∫–∞ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
        if (tournament.type === 'round_robin_3' && tournament.players.length === 3) {
            if (matches.length === 3) {
                console.log(`‚úÖ –í—Å–µ 3 –º–∞—Ç—á–∞ —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            if (matches.length === 2) {
                const winStats = {};
                tournament.players.forEach(player => {
                    winStats[player] = 0;
                });
                
                matches.forEach(match => {
                    if (match.winner && match.winner !== 'draw') {
                        winStats[match.winner]++;
                    }
                });
                
                console.log(`üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–±–µ–¥:`, winStats);
                
                const maxWins = Math.max(...Object.values(winStats));
                const playersWithMaxWins = Object.keys(winStats).filter(p => winStats[p] === maxWins);
                
                if (maxWins === 2) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${playersWithMaxWins[0]} –≤—ã–∏–≥—Ä–∞–ª 2 –º–∞—Ç—á–∞ –∏–∑ 2. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
        }
        
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 4 –∏–≥—Ä–æ–∫–∞ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
        if (tournament.type === 'round_robin_4' && tournament.players.length === 4) {
            if (matches.length === 6) {
                console.log(`‚úÖ –í—Å–µ 6 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            const winStats = {};
            tournament.players.forEach(player => {
                winStats[player] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            for (const player in winStats) {
                if (winStats[player] === 3) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${player} –≤—ã–∏–≥—Ä–∞–ª –≤—Å–µ 3 –º–∞—Ç—á–∞. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedPlayers = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedPlayers.length >= 2) {
                    const [leader, leaderWins] = sortedPlayers[0];
                    const [second, secondWins] = sortedPlayers[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 5 –∏–≥—Ä–æ–∫–æ–≤ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
        if (tournament.type === 'round_robin_5' && tournament.players.length === 5) {
            if (matches.length === 10) {
                console.log(`‚úÖ –í—Å–µ 10 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            const winStats = {};
            tournament.players.forEach(player => {
                winStats[player] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            for (const player in winStats) {
                if (winStats[player] === 4) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${player} –≤—ã–∏–≥—Ä–∞–ª –≤—Å–µ 4 –º–∞—Ç—á–∞. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedPlayers = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedPlayers.length >= 2) {
                    const [leader, leaderWins] = sortedPlayers[0];
                    const [second, secondWins] = sortedPlayers[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 6 –∏–≥—Ä–æ–∫–æ–≤ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
        if (tournament.type === 'round_robin_6' && tournament.players.length === 6) {
            if (matches.length === 15) {
                console.log(`‚úÖ –í—Å–µ 15 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            const winStats = {};
            tournament.players.forEach(player => {
                winStats[player] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            for (const player in winStats) {
                if (winStats[player] === 5) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${player} –≤—ã–∏–≥—Ä–∞–ª –≤—Å–µ 5 –º–∞—Ç—á–µ–π. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedPlayers = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedPlayers.length >= 2) {
                    const [leader, leaderWins] = sortedPlayers[0];
                    const [second, secondWins] = sortedPlayers[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        console.log(`‚è≥ –¢—É—Ä–Ω–∏—Ä –Ω–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ`);
        return false;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
    async function uploadTournamentPhoto() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ!', 'error');
            return;
        }
        
        const tournamentId = document.getElementById('tournamentPhoto').dataset.tournamentId;
        if (!tournamentId) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)', 'error');
                return;
            }
            
            try {
                showNotification('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...', 'info');
                
                const fileName = `${tournamentId}_${Date.now()}_${file.name}`;
                const filePath = `tournament-photos/${fileName}`;
                
                const { data, error } = await supabaseClient.storage
                    .from('tournament-photos')
                    .upload(filePath, file);
                
                if (error) throw error;
                
                const { data: urlData } = supabaseClient.storage
                    .from('tournament-photos')
                    .getPublicUrl(filePath);
                
                const { error: dbError } = await supabaseClient
                    .from('tournament_photos')
                    .upsert({
                        tournament_id: tournamentId,
                        photo_url: urlData.publicUrl,
                        uploaded_at: new Date().toISOString()
                    }, {
                        onConflict: 'tournament_id'
                    });
                
                if (dbError) throw dbError;
                
                const existingPhotoIndex = tournamentPhotos.findIndex(p => p.tournament_id === tournamentId);
                if (existingPhotoIndex !== -1) {
                    tournamentPhotos[existingPhotoIndex] = {
                        tournament_id: tournamentId,
                        photo_url: urlData.publicUrl,
                        uploaded_at: new Date().toISOString()
                    };
                } else {
                    tournamentPhotos.push({
                        tournament_id: tournamentId,
                        photo_url: urlData.publicUrl,
                        uploaded_at: new Date().toISOString()
                    });
                }
                
                const photoElement = document.getElementById('tournamentPhoto');
                const photoPlaceholder = document.getElementById('tournamentPhotoPlaceholder');
                
                photoElement.src = urlData.publicUrl;
                photoElement.style.display = 'block';
                photoPlaceholder.style.display = 'none';
                
                showNotification('‚úÖ –§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ', 'error');
            }
        };
        
        input.click();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    async function deleteTournament(tournamentId) {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç—É—Ä–Ω–∏—Ä? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
            return;
        }
        
        try {
            await supabaseClient
                .from('tournament_matches')
                .delete()
                .eq('tournament_id', tournamentId);
            
            await supabaseClient
                .from('tournament_photos')
                .delete()
                .eq('tournament_id', tournamentId);
            
            await supabaseClient
                .from('tournaments')
                .delete()
                .eq('id', tournamentId);
            
            tournaments = tournaments.filter(t => t.id !== tournamentId);
            tournamentMatches = tournamentMatches.filter(m => m.tournament_id !== tournamentId);
            tournamentPhotos = tournamentPhotos.filter(p => p.tournament_id !== tournamentId);
            
            updateTournamentsDisplay();
            showNotification('‚úÖ –¢—É—Ä–Ω–∏—Ä —É–¥–∞–ª–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function returnToTournaments() {
        document.getElementById('appContainer').style.display = 'block';
        document.getElementById('tournamentPageContainer').style.display = 'none';
        window.scrollTo(0, 0);
        return false;
    }
    
    // ============================================
    // –ù–ï–ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ó –ò–°–•–û–î–ù–û–ì–û –ö–û–î–ê
    // ============================================
    
    // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    // [–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞]
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    // ============================================
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        checkAutoLogin();
        
        setMatchDateToToday();
        
        await initSupabase();
        
        updatePlayerSelects();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
        const tournamentTypeSelect = document.getElementById('tournamentType');
        if (tournamentTypeSelect) {
            tournamentTypeSelect.onchange = updateTournamentTypeUI;
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateTournamentTypeUI();
        }
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Supabase
    async function loadSupabaseLibrary() {
        return new Promise((resolve, reject) => {
            if (window.supabase) {
                console.log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Supabase —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                resolve();
                return;
            }
            
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js';
            script.async = true;
            
            script.onload = () => {
                console.log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Supabase –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                resolve();
            };
            
            script.onerror = (error) => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Supabase:', error);
                updateSupabaseStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏');
                reject(error);
            };
            
            document.head.appendChild(script);
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ Supabase
    function updateSupabaseStatus(status) {
        const statusElement = document.getElementById('supabaseStatus');
        if (statusElement) {
            statusElement.textContent = status;
            statusElement.className = status.includes('‚úÖ') ? 'status-connected' : 
                                      status.includes('‚ùå') ? 'status-error' : 
                                      'status-loading';
        }
    }
    
    function updateSupabaseTime() {
        const timeElement = document.getElementById('supabaseTime');
        if (timeElement) {
            const now = new Date();
            timeElement.textContent = now.toLocaleTimeString();
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
    function checkAutoLogin() {
        const saved = localStorage.getItem('tennisAdmin');
        if (saved === 'true') {
            isAdmin = true;
            document.getElementById('appContainer').classList.add('admin-active');
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('ratingAdminControls').style.display = 'block';
            document.getElementById('matchesAdminControls').style.display = 'block';
            document.getElementById('penaltiesAdminControls').style.display = 'block';
            document.getElementById('playersAdminControls').style.display = 'block';
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã
    function setMatchDateToToday() {
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById('matchDate');
        if (dateInput) {
            dateInput.value = today;
            dateInput.min = '2020-01-01';
            dateInput.max = today;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const tabElement = document.getElementById(tabName);
        if (tabElement) {
            tabElement.classList.add('active');
        }
        
        const activeButton = document.querySelector(`.tab-btn[onclick*="${tabName}"]`);
        if (activeButton) {
            activeButton.classList.add('active');
        }
        
        if (tabName === 'stats') {
            setTimeout(() => {
                updateYearProgressChart();
            }, 100);
        } else if (tabName === 'tournaments') {
            setTimeout(() => {
                updateTournamentsDisplay();
                updateTournamentPlayersList();
            }, 100);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: calc(100vw - 40px);
            font-size: 14px;
        `;
        
        if (type === 'success') {
            notification.style.background = '#4CAF50';
        } else if (type === 'error') {
            notification.style.background = '#f44336';
        } else if (type === 'warning') {
            notification.style.background = '#ff9800';
        } else {
            notification.style.background = '#2196F3';
        }
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 3000);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    `;
    document.head.appendChild(style);
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    </script>
</body>
</html>
