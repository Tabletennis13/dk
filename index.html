<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞</title>
    <style>
        /* –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.6;color:#333;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:8px;-webkit-text-size-adjust:100%;overflow-x:hidden}
        .container{max-width:1200px;margin:0 auto;background:white;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,0.1);overflow:hidden}
        header{background:linear-gradient(135deg,#4CAF50 0%,#2E7D32 100%);color:white;padding:18px 12px;text-align:center}
        header h1{font-size:1.6em;margin-bottom:6px;word-break:break-word;line-height:1.3}
        .header-subtitle{font-size:0.95em;opacity:0.9;padding:0 8px;line-height:1.4}
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ) */
        .player-profile-container{padding:20px 15px;max-width:1000px;margin:0 auto}
        .player-profile-header{display:flex;flex-direction:column;align-items:center;gap:15px;margin-bottom:30px;text-align:center}
        @media (min-width:768px){.player-profile-header{flex-direction:row;text-align:left;gap:25px}}
        .player-avatar-large{width:150px;height:150px;border-radius:50%;object-fit:cover;border:5px solid #4CAF50;box-shadow:0 8px 25px rgba(0,0,0,0.2);flex-shrink:0}
        .player-name-large{font-size:2.2em;font-weight:bold;margin-bottom:10px;color:#333}
        .player-rating-large{font-size:1.8em;color:#4CAF50;font-weight:bold;margin-bottom:10px}
        .achievement-emojis{display:flex;gap:5px;margin:10px 0;flex-wrap:wrap;justify-content:center}
        @media (min-width:768px){.achievement-emojis{justify-content:flex-start}}
        .achievement-emoji{font-size:1.2em;margin-right:2px;opacity:0.9}
        .back-button{display:inline-block;padding:10px 20px;background:#4CAF50;color:white;text-decoration:none;border-radius:8px;font-weight:bold;margin-top:20px;transition:all 0.3s}
        .back-button:hover{background:#45a049;transform:translateY(-2px)}
        
        /* –¢–∞–±–ª–∏—Ü—ã */
        .tabs{display:flex;background:#f5f5f5;border-bottom:2px solid #ddd;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;position:sticky;top:0;z-index:10}
        .tabs::-webkit-scrollbar{display:none}
        .tab-btn{padding:14px 16px;background:none;border:none;font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap;transition:all 0.3s;position:relative;flex-shrink:0;min-width:fit-content}
        .tab-btn.active{background:white;color:#4CAF50;border-bottom:3px solid #4CAF50}
        .tab-content{display:none;padding:15px 12px;animation:fadeIn 0.3s}
        .tab-content.active{display:block}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)}}
        
        .table-container{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;margin:12px 0;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
        table{width:100%;border-collapse:collapse;min-width:600px;background:white}
        th{background:#4CAF50;color:white;padding:12px 8px;text-align:left;font-weight:600;font-size:13px;white-space:nowrap}
        td{padding:10px 8px;border-bottom:1px solid #eee;font-size:13px;vertical-align:middle;white-space:nowrap}
        
        .avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid #4CAF50;flex-shrink:0}
        .player-cell{display:flex;align-items:center;gap:8px;min-width:0;cursor:pointer}
        .player-cell span{font-size:14px;white-space:normal;word-break:break-word;line-height:1.3;flex:1;min-width:0}
        .rating-badge{background:#4CAF50;color:white;padding:4px 8px;border-radius:12px;font-weight:bold;font-size:12px;display:inline-block}
        
        /* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-controls-panel{background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:15px;border-left:4px solid #4CAF50}
        .admin-controls-panel h4{color:#333;margin-bottom:10px;display:flex;align-items:center;gap:8px;font-size:15px}
        .action-btn{padding:6px 10px;border:none;border-radius:5px;cursor:pointer;font-size:12px;transition:all 0.2s;min-height:32px;white-space:nowrap}
        .delete-btn{background:#f44336;color:white}
        .penalty-btn{background:#ff9800;color:white}
        .add-btn{background:#4CAF50;color:white}
        
        /* Supabase –ø–∞–Ω–µ–ª—å */
        .bottom-panels{padding:15px;background:#f8f9fa;border-top:2px solid #e0e0e0;margin-top:20px}
        .supabase-panel{background:#e8f5e9;padding:12px 15px;margin-bottom:15px;border-radius:10px;border-left:5px solid #4CAF50;display:flex;flex-direction:column;gap:10px}
        @media (min-width:481px){.supabase-panel{flex-direction:row;justify-content:space-between;align-items:center}}
        .supabase-status{display:flex;flex-direction:column;gap:5px;font-size:0.9em}
        
        /* –¢—É—Ä–Ω–∏—Ä—ã */
        .tournament-generator{background:white;border-radius:12px;padding:20px;margin-bottom:30px;box-shadow:0 4px 12px rgba(0,0,0,0.1);border:2px solid #4CAF50;max-height:70px;overflow:hidden;transition:all 0.3s}
        .tournament-generator.expanded{max-height:1000px;overflow:visible}
        .tournament-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px}
        .tournament-card{background:white;border-radius:12px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,0.1);border:2px solid #e0e0e0;transition:all 0.3s;position:relative}
        .tournament-card.winner{border-color:#FFD700;background:linear-gradient(135deg,#fff9c4 0%,#fff59d 100%)}
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (min-width:481px){body{padding:10px}.container{border-radius:15px}header{padding:20px 15px}header h1{font-size:1.8em}}
        @media (min-width:769px){.tab-content{padding:20px 15px}table{min-width:800px}th,td{padding:12px 10px;font-size:14px}}
        @media (max-width:480px){body{padding:5px}.container{border-radius:8px}header{padding:15px 10px}header h1{font-size:1.4em}.tab-btn{padding:12px 14px;font-size:13px}}
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä–æ–∫–∞ -->
    <div class="container" id="playerProfileContainer" style="display:none">
        <div class="player-profile-container">
            <div class="player-profile-header">
                <img id="playerProfileAvatar" src="" class="player-avatar-large" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                <div class="player-info-large">
                    <h1 id="playerProfileName" class="player-name-large"></h1>
                    <div id="playerProfileRating" class="player-rating-large"></div>
                    <div id="playerProfileEmojis" class="achievement-emojis"></div>
                </div>
            </div>
            <div class="player-stats-grid" id="playerStatsGrid"></div>
            <a href="#" class="back-button" onclick="returnToMain()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–π—Ç–∏–Ω–≥—É</a>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞ -->
    <div class="container" id="tournamentPageContainer" style="display:none">
        <div class="player-profile-container">
            <div class="tournament-page-header" id="tournamentPageHeader"></div>
            <div id="tournamentContent"></div>
            <a href="#" class="back-button" onclick="returnToMain()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç—É—Ä–Ω–∏—Ä–∞–º</a>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container" id="appContainer">
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢</h1>
            <div class="header-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞</div>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üèÖ –¢—É—Ä–Ω–∏—Ä—ã</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
        <div class="tab-content active" id="rating">
            <h2>üèÜ –¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div class="table-container">
                <table class="compact-table">
                    <thead><tr><th>–ú–µ—Å—Ç–æ</th><th>–ò–≥—Ä–æ–∫</th><th>–û—á–∫–∏</th><th>–ú–∞—Ç—á–∏</th><th>–ü–æ–±–µ–¥</th><th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∏–≥—Ä–∞</th><th>–ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
                    <tbody id="ratingBody"></tbody>
                </table>
            </div>
            <div class="achievements-container" id="achievementsContainer">
                <div class="achievements-header"><div class="level-icon">üèÜ</div><h3>–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h3></div>
                <div id="achievementsContent"><p>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤...</p></div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –º–∞—Ç—á–µ–π -->
        <div class="tab-content" id="matches">
            <h2>üéÆ –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π</h2>
            <div id="matchesContainer"></div>
            <div class="admin-controls" id="matchesAdminControls" style="display:none">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div><div class="form-group"><label>–î–∞—Ç–∞ –º–∞—Ç—á–∞:</label><input type="date" id="matchDate"></div>
                    <div class="form-group"><label>–ò–≥—Ä–æ–∫ 1:</label><select id="player1"></select></div>
                    <div class="form-group"><label>–ò–≥—Ä–æ–∫ 2:</label><select id="player2"></select></div></div>
                    <div><div class="form-group"><label>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</label><select id="winner"><option value="player1">–ò–≥—Ä–æ–∫ 1</option><option value="player2">–ò–≥—Ä–æ–∫ 2</option><option value="draw">–ù–∏—á—å—è</option></select></div>
                    <div class="form-group"><label>–°—á–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label><input type="text" id="score" placeholder="3:2"></div>
                    <button class="add-btn action-btn" onclick="addMatch()" style="margin-top:20px;width:100%">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á</button></div>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="tab-content" id="players">
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h2>
            <div class="admin-controls" id="playersAdminControls" style="display:none">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div><div class="form-group"><label>–ò–º—è –∏–≥—Ä–æ–∫–∞:</label><input type="text" id="newPlayerName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω"></div>
                    <div class="form-group"><label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label><input type="text" id="newPlayerAvatar" placeholder="https://example.com/avatar.jpg"></div>
                    <div class="form-group"><label>–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥:</label><input type="number" id="newPlayerRating" value="1000"></div>
                    <button class="add-btn action-btn" onclick="addPlayer()" style="width:100%">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button></div>
                    <div><p><strong>–°–æ–≤–µ—Ç—ã:</strong></p><ul style="list-style:none;padding:0"><li>‚Ä¢ –î–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <a href="https://pravatar.cc" target="_blank">pravatar.cc</a></li><li>‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: 1000</li><li>‚Ä¢ –ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º</li></ul></div>
                </div>
            </div>
            <div class="table-container">
                <table><thead><tr><th>–ê–≤–∞—Ç–∞—Ä</th><th>–ò–º—è</th><th>–†–µ–π—Ç–∏–Ω–≥</th><th>–ú–∞—Ç—á–∏</th><th>–ü–æ–±–µ–¥</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody id="playersBody"></tbody></table>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
        <div class="tab-content" id="tournaments">
            <h2>üèÖ –¢—É—Ä–Ω–∏—Ä—ã</h2>
            <div class="tournament-generator" id="tournamentGenerator">
                <div class="generator-header" onclick="toggleTournamentGenerator()"><span>üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–æ–≤</span><span class="toggle-icon">‚ñº</span></div>
                <div class="generator-grid"><div class="generator-section"><h4>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–Ω–∏—Ä–µ</h4>
                <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:</label><input type="text" id="tournamentName" placeholder="–í–µ—Å–µ–Ω–Ω–∏–π –∫—É–±–æ–∫ 2024"></div>
                <div class="form-group"><label>–¢–∏–ø —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏:</label><select id="tournamentType">
                    <option value="round_robin_3">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –∏–≥—Ä–æ–∫–∞)</option><option value="round_robin_4">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (4 –∏–≥—Ä–æ–∫–∞)</option>
                    <option value="round_robin_5">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –∏–≥—Ä–æ–∫–æ–≤)</option><option value="round_robin_6">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (6 –∏–≥—Ä–æ–∫–æ–≤)</option>
                    <option value="single_elimination_4">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4 –∏–≥—Ä–æ–∫–∞)</option><option value="single_elimination_8">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8 –∏–≥—Ä–æ–∫–æ–≤)</option>
                    <option value="double_elimination_4">–î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è (4 –∏–≥—Ä–æ–∫–∞)</option><option value="pairs_round_robin_3">–ü–∞—Ä–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä (3 –ø–∞—Ä—ã)</option>
                    <option value="pairs_round_robin_4">–ü–∞—Ä–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä (4 –ø–∞—Ä—ã)</option></select></div></div>
                <div class="generator-section"><h4>üë• –í—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h4><div class="player-checkbox-list" id="tournamentPlayersList"></div>
                <div style="margin-top:10px;font-size:0.9em;color:#666">–í—ã–±—Ä–∞–Ω–æ: <span id="selectedPlayersCount">0</span> –∏–≥—Ä–æ–∫–æ–≤</div></div></div>
                <button class="generate-btn" onclick="generateTournament()">üèÜ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
            </div>
            <h3>üìã –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤</h3><div class="tournament-grid" id="tournamentsList"></div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="tab-content" id="stats">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            <div class="form-group" style="max-width:400px"><label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</label><select id="statsPlayerSelect" onchange="updatePeriodStats()"></select></div>
            <div class="period-stats"><div class="period-box"><h3>üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é</h3><div id="weekStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div></div>
            <div class="period-box"><h3>üìÖ –ó–∞ –º–µ—Å—è—Ü</h3><div id="monthStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div></div>
            <div class="period-box"><h3>üìÖ –ó–∞ –≥–æ–¥</h3><div id="yearStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div></div>
            <div class="period-box"><h3>üìÖ –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</h3><div id="allTimeStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div></div></div>
            <h3>üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º</h3><div class="year-progress" id="yearProgress"></div>
            <h3>üî• –¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤ –≥–æ–¥–∞</h3><div id="topYearPlayers"></div>
            <h3>‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</h3><div class="comparison-container"><div><div class="form-group"><label>–ò–≥—Ä–æ–∫ 1:</label><select id="comparePlayer1"></select></div>
            <div class="form-group"><label>–ò–≥—Ä–æ–∫ 2:</label><select id="comparePlayer2"></select></div>
            <button class="add-btn action-btn" onclick="comparePlayers()" style="width:100%">üîç –°—Ä–∞–≤–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤</button></div>
            <div id="comparisonResult" style="background:#f8f9fa;padding:20px;border-radius:10px"><p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°—Ä–∞–≤–Ω–∏—Ç—å"</p></div></div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —à—Ç—Ä–∞—Ñ–æ–≤ -->
        <div class="tab-content" id="penalties">
            <h2>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
            <div class="admin-controls" id="penaltiesAdminControls" style="display:none">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–æ–≤ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="penalty-btn action-btn" onclick="checkAndApplyPenalties()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ-—à—Ç—Ä–∞—Ñ—ã</button>
                <p><small>–®—Ç—Ä–∞—Ñ: -60 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–µ 14+ –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</small></p>
            </div>
            <div class="table-container">
                <table><thead><tr><th>–î–∞—Ç–∞</th><th>–ò–≥—Ä–æ–∫</th><th>–®—Ç—Ä–∞—Ñ</th><th>–î–Ω–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</th><th>–¢–∏–ø</th></tr></thead><tbody id="penaltiesHistoryBody"></tbody></table>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="bottom-panels">
            <div class="admin-controls-panel" id="ratingAdminControls" style="display:none">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–º (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="penalty-btn action-btn" onclick="checkAndApplyPenalties()">‚ö†Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ-—à—Ç—Ä–∞—Ñ—ã (14+ –¥–Ω–µ–π = -60)</button>
                <button class="add-btn action-btn" onclick="saveManualRatings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤</button>
                <p><small>–ò–∑–º–µ–Ω–∏—Ç–µ –æ—á–∫–∏ –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤"</small></p>
            </div>
            
            <div class="supabase-panel">
                <div class="supabase-status">
                    <strong>‚òÅÔ∏è Supabase Cloud Sync</strong>
                    <div>–°—Ç–∞—Ç—É—Å: <span id="supabaseStatus" class="status-loading">‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span></div>
                    <div>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="supabaseTime">--:--:--</span></div>
                </div>
                <button class="action-btn add-btn" onclick="loadAllData()" id="refreshBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            
            <div class="admin-panel" id="adminPanel" style="display:none">
                <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3><p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä. –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
                <button class="logout-btn" onclick="logoutAdmin()">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º–∞</button>
            </div>
            
            <div class="login-panel" id="loginPanel">
                <h3>üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h3><p>–î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –º–∞—Ç—á–µ–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</p>
                <input type="password" id="adminPassword" class="password-input" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                <button class="login-btn" onclick="loginAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // ============================================
    const CONFIG = {
        SUPABASE_URL: 'https://bqycjfcjtdawyrysgrbw.supabase.co',
        SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWNqZmNqdGRhd3lyeXNncmJ3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjYwMTk3MCwiZXhwIjoyMDgyMTc3OTcwfQ.lHA_79fw8PSj9ZHMExBpSEIpkonkCYOni7HniGGqadY',
        ADMIN_PASSWORD: "admin123",
        ACHIEVEMENT_LEVELS: [
            { threshold: 1100, name: "–ù–∞—á–∏–Ω–∞—é—â–∏–π —á–µ–º–ø–∏–æ–Ω", icon: "ü•â", color: "#CD7F32", bonus: 16 },
            { threshold: 1300, name: "–û–ø—ã—Ç–Ω—ã–π –±–æ–µ—Ü", icon: "ü•à", color: "#C0C0C0", bonus: 20 },
            { threshold: 1500, name: "–ú–∞—Å—Ç–µ—Ä —Å—Ç–æ–ª–∞", icon: "ü•á", color: "#FF9800", bonus: 30 },
            { threshold: 2000, name: "–õ–µ–≥–µ–Ω–¥–∞ –ª–∏–≥–∏", icon: "üëë", color: "#FFD700", bonus: 50 }
        ]
    };

    let players = {}, matches = [], penaltyLog = [], tournaments = [], tournamentMatches = [], tournamentPhotos = [];
    let supabaseClient = null, isAdmin = false, isSupabaseInitialized = false;

    // ============================================
    // –û–°–ù–û–í–ù–´–ï –£–¢–ò–õ–ò–¢–´
    // ============================================
    class AppUtils {
        static showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position:fixed;top:20px;right:20px;padding:12px 16px;border-radius:8px;color:white;
                font-weight:bold;z-index:1000;animation:slideIn 0.3s ease,fadeOut 0.3s ease 2.7s;
                box-shadow:0 4px 12px rgba(0,0,0,0.15);max-width:calc(100vw - 40px);font-size:14px;
                background:${type==='success'?'#4CAF50':type==='error'?'#f44336':type==='warning'?'#ff9800':'#2196F3'};
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.parentNode?.removeChild(notification), 3000);
        }

        static getPluralForm(number) {
            if (number % 10 === 1 && number % 100 !== 11) return '';
            if (number % 10 >= 2 && number % 10 <= 4 && (number % 100 < 10 || number % 100 >= 20)) return '–∞';
            return '–µ–π';
        }

        static getAchievementEmojis(rating) {
            return CONFIG.ACHIEVEMENT_LEVELS
                .filter(l => rating >= l.threshold)
                .map(l => `<span class="achievement-emoji">${l.icon}</span>`)
                .join('');
        }

        static formatDate(date) {
            return date ? date.toLocaleDateString('ru-RU') : '–ù–∏–∫–æ–≥–¥–∞';
        }
    }

    // ============================================
    // –°–£–ü–ê–ë–ï–ô–° –ú–ï–ù–ï–î–ñ–ï–†
    // ============================================
    class SupabaseManager {
        static async init() {
            try {
                if (!window.supabase) await this.loadLibrary();
                supabaseClient = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
                isSupabaseInitialized = true;
                AppUtils.showNotification('‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                await this.loadAllData();
                setInterval(() => this.loadAllData(), 30000);
                return supabaseClient;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Supabase:', error);
                AppUtils.showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase', 'error');
                return null;
            }
        }

        static async loadLibrary() {
            return new Promise((resolve, reject) => {
                if (window.supabase) return resolve();
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js';
                script.async = true;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        static async loadAllData() {
            if (!supabaseClient) return;
            
            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
                const { data: playersData } = await supabaseClient.from('players').select('*').order('rating', { ascending: false });
                if (playersData) {
                    players = {};
                    playersData.forEach(p => {
                        players[p.name] = {
                            rating: p.rating || 1000,
                            matches: p.matches || 0,
                            wins: p.wins || 0,
                            lastGame: p.last_game ? new Date(p.last_game) : null,
                            joinDate: p.join_date ? new Date(p.join_date) : new Date(),
                            penalties: p.penalties || 0,
                            avatar: p.avatar || `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`,
                            achievement_bonuses: p.achievement_bonuses || {}
                        };
                    });
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—á–µ–π
                const { data: matchesData } = await supabaseClient.from('matches').select('*').order('date', { ascending: false });
                if (matchesData) {
                    matches = matchesData.map(m => ({
                        id: m.id,
                        date: new Date(m.date),
                        player1: m.player1,
                        player2: m.player2,
                        winner: m.winner,
                        change1: m.change1 || 0,
                        change2: m.change2 || 0,
                        score: m.score || ''
                    }));
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ —à—Ç—Ä–∞—Ñ–æ–≤
                const { data: penaltiesData } = await supabaseClient.from('penalties').select('*').order('date', { ascending: false });
                if (penaltiesData) {
                    penaltyLog = penaltiesData.map(p => ({
                        id: p.id,
                        date: new Date(p.date),
                        player: p.player,
                        amount: p.amount || 0,
                        daysInactive: p.days_inactive || 0,
                        manual: p.manual || false
                    }));
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤
                await this.loadTournaments();
                updateAllDisplays();
                AppUtils.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            }
        }

        static async loadTournaments() {
            try {
                const { data: tData } = await supabaseClient.from('tournaments').select('*').order('created_at', { ascending: false });
                const { data: tmData } = await supabaseClient.from('tournament_matches').select('*');
                const { data: tpData } = await supabaseClient.from('tournament_photos').select('*');
                
                tournaments = tData || [];
                tournamentMatches = tmData || [];
                tournamentPhotos = tpData || [];
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
            }
        }

        static async savePlayer(name, data) {
            if (!supabaseClient) return;
            try {
                await supabaseClient.from('players').upsert({
                    name: name,
                    rating: data.rating,
                    matches: data.matches,
                    wins: data.wins,
                    last_game: data.lastGame,
                    join_date: data.joinDate,
                    penalties: data.penalties,
                    avatar: data.avatar,
                    achievement_bonuses: data.achievement_bonuses || {}
                }, { onConflict: 'name' });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞:', error);
            }
        }

        static async saveMatch(match) {
            if (!supabaseClient) return;
            try {
                await supabaseClient.from('matches').insert({
                    date: match.date.toISOString(),
                    player1: match.player1,
                    player2: match.player2,
                    winner: match.winner,
                    change1: match.change1,
                    change2: match.change2,
                    score: match.score
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç—á–∞:', error);
            }
        }

        static async deleteMatch(id) {
            if (!supabaseClient) return;
            try {
                await supabaseClient.from('matches').delete().eq('id', id);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç—á–∞:', error);
            }
        }
    }

    // ============================================
    // –ò–ì–†–û–ö–ò –ò –ú–ê–¢–ß–ò
    // ============================================
    class MatchManager {
        static async addMatch() {
            if (!isAdmin) {
                AppUtils.showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–Ω–æ—Å–∏—Ç—å –º–∞—Ç—á–∏!', 'error');
                return;
            }
            
            const date = document.getElementById('matchDate')?.value;
            const p1 = document.getElementById('player1')?.value;
            const p2 = document.getElementById('player2')?.value;
            const winner = document.getElementById('winner')?.value;
            const score = document.getElementById('score')?.value;
            
            if (!p1 || !p2 || !date) {
                AppUtils.showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'error');
                return;
            }
            
            if (p1 === p2) {
                AppUtils.showNotification('–ò–≥—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏!', 'error');
                return;
            }
            
            const matchDate = new Date(date);
            matchDate.setHours(new Date().getHours(), new Date().getMinutes(), new Date().getSeconds());
            const realWinner = winner === 'player1' ? p1 : winner === 'player2' ? p2 : 'draw';
            
            const rating1 = players[p1]?.rating || 1000;
            const rating2 = players[p2]?.rating || 1000;
            const ratingDiff = Math.abs(rating1 - rating2);
            const strongPlayer = rating1 > rating2 ? p1 : p2;
            const weakPlayer = rating1 > rating2 ? p2 : p1;
            const isUpset = realWinner === weakPlayer;
            
            let change1, change2;
            if (realWinner === p1) {
                if (!players[p1]) players[p1] = this.createNewPlayer(p1);
                players[p1].wins++;
                change1 = (isUpset && ratingDiff >= 200 && p1 === weakPlayer) ? 32 : 16;
                change2 = -change1;
            } else if (realWinner === p2) {
                if (!players[p2]) players[p2] = this.createNewPlayer(p2);
                players[p2].wins++;
                change2 = (isUpset && ratingDiff >= 200 && p2 === weakPlayer) ? 32 : 16;
                change1 = -change2;
            } else {
                change1 = change2 = 0;
            }

            if (!players[p1]) players[p1] = this.createNewPlayer(p1);
            if (!players[p2]) players[p2] = this.createNewPlayer(p2);
            
            players[p1].rating += change1;
            players[p2].rating += change2;
            players[p1].matches++;
            players[p2].matches++;
            players[p1].lastGame = matchDate;
            players[p2].lastGame = matchDate;

            const newMatch = {
                id: Date.now().toString(),
                date: matchDate,
                player1: p1,
                player2: p2,
                winner: realWinner,
                change1: change1,
                change2: change2,
                score: score || ''
            };
            
            matches.unshift(newMatch);
            
            try {
                await SupabaseManager.saveMatch(newMatch);
                await SupabaseManager.savePlayer(p1, players[p1]);
                await SupabaseManager.savePlayer(p2, players[p2]);
                
                updateAllDisplays();
                document.getElementById('score').value = '';
                
                let message = `‚úÖ –ú–∞—Ç—á –¥–æ–±–∞–≤–ª–µ–Ω! ${p1}: ${change1>0?'+':''}${change1}, ${p2}: ${change2>0?'+':''}${change2}`;
                if (isUpset && ratingDiff >= 200) {
                    message += ` (–ü—Ä–∞–≤–∏–ª–æ 32 –æ—á–∫–æ–≤ - —Å–ª–∞–±—ã–π –ø–æ–±–µ–¥–∏–ª —Å–∏–ª—å–Ω–æ–≥–æ)`;
                }
                
                AppUtils.showNotification(message, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç—á–∞:', error);
                AppUtils.showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç—á–∞', 'error');
            }
        }

        static createNewPlayer(name) {
            return {
                rating: 1000,
                matches: 0,
                wins: 0,
                lastGame: null,
                joinDate: new Date(),
                penalties: 0,
                avatar: `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`,
                achievement_bonuses: {}
            };
        }

        static async deleteMatch(id) {
            if (!isAdmin) {
                AppUtils.showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –º–∞—Ç—á–∏!', 'error');
                return;
            }
            
            if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á? –†–µ–π—Ç–∏–Ω–≥–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã.")) return;
            
            const matchIndex = matches.findIndex(m => m.id === id);
            if (matchIndex === -1) return;
            
            const match = matches[matchIndex];
            
            if (players[match.player1]) {
                players[match.player1].rating -= match.change1;
                players[match.player1].matches--;
                if (match.winner === match.player1) players[match.player1].wins--;
            }
            
            if (players[match.player2]) {
                players[match.player2].rating -= match.change2;
                players[match.player2].matches--;
                if (match.winner === match.player2) players[match.player2].wins--;
            }
            
            matches.splice(matchIndex, 1);
            
            try {
                if (players[match.player1]) await SupabaseManager.savePlayer(match.player1, players[match.player1]);
                if (players[match.player2]) await SupabaseManager.savePlayer(match.player2, players[match.player2]);
                await SupabaseManager.deleteMatch(id);
                
                updateAllDisplays();
                AppUtils.showNotification("‚úÖ –ú–∞—Ç—á —É–¥–∞–ª–µ–Ω!", 'success');
            } catch (error) {
                AppUtils.showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç—á–∞', 'error');
            }
        }
    }

    // ============================================
    // –°–ò–°–¢–ï–ú–ê –î–û–°–¢–ò–ñ–ï–ù–ò–ô
    // ============================================
    async function applyAchievementBonuses() {
        if (!isAdmin || !supabaseClient) return;
        
        let anyBonusesApplied = false;
        
        for (const [name, data] of Object.entries(players)) {
            if (!data.achievement_bonuses) data.achievement_bonuses = {};
            
            for (const level of CONFIG.ACHIEVEMENT_LEVELS) {
                if (data.rating >= level.threshold && !data.achievement_bonuses[level.threshold]) {
                    data.rating += level.bonus;
                    data.achievement_bonuses[level.threshold] = true;
                    anyBonusesApplied = true;
                    
                    await SupabaseManager.savePlayer(name, data);
                    AppUtils.showNotification(`üéÅ ${name} –ø–æ–ª—É—á–∏–ª +${level.bonus} –æ—á–∫–æ–≤ –∑–∞ —É—Ä–æ–≤–µ–Ω—å ${level.name}!`, 'success');
                }
            }
        }
        
        if (anyBonusesApplied) {
            updateAllDisplays();
        }
    }

    // ============================================
    // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
    // ============================================
    function updateAllDisplays() {
        updateRatingTable();
        updateMatchesTable();
        updatePlayersTable();
        updatePenaltiesHistory();
        updatePlayerSelects();
        updateAchievementsDisplay();
        updateTournamentsDisplay();
    }

    function updateRatingTable() {
        const tbody = document.getElementById('ratingBody');
        if (!tbody) return;
        
        const sortedPlayers = Object.entries(players).sort(([,a], [,b]) => b.rating - a.rating);
        
        if (sortedPlayers.length === 0) {
            tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:25px;"><h3 style="font-size:16px;margin-bottom:10px;">üòï –ò–≥—Ä–æ–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3><p style="font-size:14px;">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</p></td></tr>`;
            return;
        }
        
        tbody.innerHTML = sortedPlayers.map(([name, data], index) => {
            const daysInactive = data.lastGame ? 
                Math.floor((new Date() - data.lastGame) / (1000 * 60 * 60 * 24)) : 
                Math.floor((new Date() - data.joinDate) / (1000 * 60 * 60 * 24));
            
            const emojis = AppUtils.getAchievementEmojis(data.rating);
            const nameClass = name.length > 20 ? 'long-name' : '';
            
            if (isAdmin) {
                return `
                    <tr>
                        <td><strong>${index + 1}</strong></td>
                        <td>
                            <div class="player-cell" onclick="showPlayerProfile('${name}')" style="cursor:pointer;">
                                <img src="${data.avatar}" class="avatar" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                                <span class="${nameClass}">${name}</span>
                                <div class="player-emojis">${emojis}</div>
                            </div>
                        </td>
                        <td><input type="number" class="rating-input" value="${data.rating}" data-player="${name}" min="0" max="3000"></td>
                        <td>${data.matches}</td>
                        <td>${data.wins} (${data.matches ? Math.round(data.wins/data.matches*100) : 0}%)</td>
                        <td>${AppUtils.formatDate(data.lastGame)}</td>
                        <td>${daysInactive} –¥–Ω–µ–π</td>
                        <td>
                            <button class="penalty-btn action-btn" onclick="applyManualPenalty('${name}')" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å —à—Ç—Ä–∞—Ñ -60">
                                -60
                            </button>
                        </td>
                    </tr>`;
            } else {
                return `
                    <tr>
                        <td><strong>${index + 1}</strong></td>
                        <td>
                            <div class="player-cell" onclick="showPlayerProfile('${name}')" style="cursor:pointer;">
                                <img src="${data.avatar}" class="avatar" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                                <span class="${nameClass}">${name}</span>
                                <div class="player-emojis">${emojis}</div>
                            </div>
                        </td>
                        <td><span class="rating-badge">${data.rating}</span></td>
                        <td>${data.matches}</td>
                        <td>${data.wins} (${data.matches ? Math.round(data.wins/data.matches*100) : 0}%)</td>
                        <td>${AppUtils.formatDate(data.lastGame)}</td>
                        <td>${daysInactive} –¥–Ω–µ–π</td>
                        <td>${daysInactive >= 14 ? '‚ö†Ô∏è' : '‚úÖ'}</td>
                    </tr>`;
            }
        }).join('');
    }

    function updateMatchesTable() {
        const container = document.getElementById('matchesContainer');
        if (!container) return;
        
        if (matches.length === 0) {
            container.innerHTML = `<div style="text-align:center;padding:25px;background:#f8f9fa;border-radius:10px;margin:15px 0;">
                <h3 style="font-size:16px;margin-bottom:10px;">üéæ –ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p style="font-size:14px;">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –º–∞—Ç—á</p></div>`;
            return;
        }
        
        const matchesByDay = {};
        matches.forEach(m => {
            const dateKey = m.date.toDateString();
            if (!matchesByDay[dateKey]) matchesByDay[dateKey] = [];
            matchesByDay[dateKey].push(m);
        });
        
        const sortedDays = Object.keys(matchesByDay).sort((a, b) => new Date(b) - new Date(a));
        
        container.innerHTML = sortedDays.map((dayKey, dayIndex) => {
            const dayMatches = matchesByDay[dayKey];
            const dayDate = new Date(dayKey);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            let displayDate;
            if (dayDate.toDateString() === today.toDateString()) {
                displayDate = '–°–µ–≥–æ–¥–Ω—è';
            } else if (dayDate.toDateString() === yesterday.toDateString()) {
                displayDate = '–í—á–µ—Ä–∞';
            } else {
                displayDate = dayDate.toLocaleDateString('ru-RU', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                displayDate = displayDate.charAt(0).toUpperCase() + displayDate.slice(1);
            }
            
            const dayId = 'matchDay_' + dayKey.replace(/\s+/g, '_');
            const collapsed = dayIndex >= 2 ? 'collapsed' : '';
            
            return `
                <div class="match-day-header ${collapsed}" data-day-id="${dayId}" onclick="toggleDayGroup('${dayId}')">
                    <div class="day-info">
                        <div class="toggle-icon">‚ñº</div>
                        <div class="day-date">${displayDate}</div>
                    </div>
                    <div class="match-count">${dayMatches.length} –º–∞—Ç—á${AppUtils.getPluralForm(dayMatches.length)}</div>
                </div>
                <div class="match-day-group ${collapsed}" id="${dayId}">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ò–≥—Ä–æ–∫ 1</th>
                                    <th>–ò–≥—Ä–æ–∫ 2</th>
                                    <th>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å</th>
                                    <th>–°—á–µ—Ç</th>
                                    <th>–ò–∑–º–µ–Ω–µ–Ω–∏—è</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${dayMatches.map(m => `
                                    <tr>
                                        <td>${m.date.toLocaleTimeString('ru-RU', {hour:'2-digit',minute:'2-digit'})}</td>
                                        <td>
                                            <div class="player-cell" onclick="showPlayerProfile('${m.player1}')" style="cursor:pointer;">
                                                <img src="${players[m.player1]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                                     class="avatar" style="width:32px;height:32px;">
                                                <span>${m.player1}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="player-cell" onclick="showPlayerProfile('${m.player2}')" style="cursor:pointer;">
                                                <img src="${players[m.player2]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                                     class="avatar" style="width:32px;height:32px;">
                                                <span>${m.player2}</span>
                                            </div>
                                        </td>
                                        <td><strong>${m.winner === 'draw' ? '–ù–∏—á—å—è' : (m.winner || '-')}</strong></td>
                                        <td>${m.score || '-'}</td>
                                        <td>
                                            <span style="color:${m.change1 > 0 ? '#4CAF50' : '#f44336'}">
                                                ${m.change1 > 0 ? '+' : ''}${m.change1}
                                            </span> / 
                                            <span style="color:${m.change2 > 0 ? '#4CAF50' : '#f44336'}">
                                                ${m.change2 > 0 ? '+' : ''}${m.change2}
                                            </span>
                                        </td>
                                        <td>
                                            ${isAdmin ? 
                                                `<button class="delete-btn action-btn" onclick="MatchManager.deleteMatch('${m.id}')" title="–£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á">
                                                    üóëÔ∏è
                                                </button>` : 
                                                '-'
                                            }
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>`;
        }).join('');
    }

    function updatePlayersTable() {
        const tbody = document.getElementById('playersBody');
        if (!tbody) return;
        
        const playerList = Object.entries(players);
        if (playerList.length === 0) return;
        
        tbody.innerHTML = playerList.map(([name, data]) => {
            const nameClass = name.length > 20 ? 'long-name' : '';
            
            return `
                <tr>
                    <td>
                        <img src="${data.avatar}" class="avatar" 
                             onerror="this.src='https://i.pravatar.cc/150?img=3'}" 
                             onclick="showPlayerProfile('${name}')" style="cursor:pointer;">
                    </td>
                    <td>
                        <span class="${nameClass}" onclick="showPlayerProfile('${name}')" 
                              style="cursor:pointer;text-decoration:underline;color:#4CAF50;">
                            ${name}
                        </span>
                    </td>
                    <td><span class="rating-badge">${data.rating}</span></td>
                    <td>${data.matches}</td>
                    <td>${data.wins} (${data.matches ? Math.round(data.wins/data.matches*100) : 0}%)</td>
                    <td>
                        ${isAdmin ? `
                            <button class="action-btn" onclick="changeAvatar('${name}')" 
                                    title="–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä" style="background:#2196F3;margin-right:5px;">
                                üñºÔ∏è
                            </button>
                            <button class="delete-btn action-btn" onclick="removePlayer('${name}')" 
                                    title="–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞">
                                üóëÔ∏è
                            </button>
                        ` : '-'}
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ============================================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê
    // ============================================
    function toggleDayGroup(dayId) {
        const target = document.getElementById(dayId);
        const header = document.querySelector(`[data-day-id="${dayId}"]`);
        if (target && header) {
            target.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        }
    }

    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const tabElement = document.getElementById(tabName);
        if (tabElement) {
            tabElement.classList.add('active');
        }
        
        const activeButton = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
            btn.getAttribute('onclick')?.includes(tabName)
        );
        if (activeButton) {
            activeButton.classList.add('active');
        }
        
        if (tabName === 'stats') {
            setTimeout(() => {
                updateYearProgressChart();
            }, 100);
        } else if (tabName === 'tournaments') {
            setTimeout(() => {
                updateTournamentsDisplay();
                updateTournamentPlayersList();
            }, 100);
        }
    }

    function showPlayerProfile(playerName) {
        if (!players[playerName]) {
            AppUtils.showNotification('–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        const playerData = players[playerName];
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('playerProfileContainer').style.display = 'block';
        
        document.getElementById('playerProfileName').textContent = playerName;
        document.getElementById('playerProfileAvatar').src = playerData.avatar;
        document.getElementById('playerProfileRating').textContent = `–†–µ–π—Ç–∏–Ω–≥: ${playerData.rating} –æ—á–∫–æ–≤`;
        document.getElementById('playerProfileEmojis').innerHTML = AppUtils.getAchievementEmojis(playerData.rating);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updatePlayerStats(playerName);
        
        window.scrollTo(0, 0);
    }

    function updatePlayerStats(playerName) {
        const playerData = players[playerName];
        if (!playerData) return;
        
        const now = new Date();
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
        const yearStart = new Date(now.getFullYear(), 0, 1);
        
        const weekMatches = matches.filter(m => (m.player1 === playerName || m.player2 === playerName) && m.date >= weekAgo);
        const monthMatches = matches.filter(m => (m.player1 === playerName || m.player2 === playerName) && m.date >= monthAgo);
        const yearMatches = matches.filter(m => (m.player1 === playerName || m.player2 === playerName) && m.date >= yearStart);
        const allTimeMatches = matches.filter(m => m.player1 === playerName || m.player2 === playerName);
        
        const weekWins = weekMatches.filter(m => m.winner === playerName).length;
        const monthWins = monthMatches.filter(m => m.winner === playerName).length;
        const yearWins = yearMatches.filter(m => m.winner === playerName).length;
        const allTimeWins = allTimeMatches.filter(m => m.winner === playerName).length;
        
        const weekRatingChange = weekMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        const monthRatingChange = monthMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        const yearRatingChange = yearMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        const allTimeRatingChange = allTimeMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        const statsGrid = document.getElementById('playerStatsGrid');
        if (statsGrid) {
            statsGrid.innerHTML = `
                <div class="player-stats-grid">
                    <div class="stat-period-box">
                        <h3>üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é</h3>
                        <p>–ú–∞—Ç—á–µ–π: <span class="stat-value">${weekMatches.length}</span></p>
                        <p>–ü–æ–±–µ–¥: <span class="stat-value">${weekWins}</span> (${weekMatches.length ? Math.round(weekWins/weekMatches.length*100) : 0}%)</p>
                        <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${weekRatingChange > 0 ? '#4CAF50' : '#f44336'}">
                            ${weekRatingChange > 0 ? '+' : ''}${weekRatingChange}</span></p>
                    </div>
                    <div class="stat-period-box">
                        <h3>üìÖ –ó–∞ –º–µ—Å—è—Ü</h3>
                        <p>–ú–∞—Ç—á–µ–π: <span class="stat-value">${monthMatches.length}</span></p>
                        <p>–ü–æ–±–µ–¥: <span class="stat-value">${monthWins}</span> (${monthMatches.length ? Math.round(monthWins/monthMatches.length*100) : 0}%)</p>
                        <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${monthRatingChange > 0 ? '#4CAF50' : '#f44336'}">
                            ${monthRatingChange > 0 ? '+' : ''}${monthRatingChange}</span></p>
                    </div>
                    <div class="stat-period-box">
                        <h3>üìÖ –ó–∞ –≥–æ–¥</h3>
                        <p>–ú–∞—Ç—á–µ–π: <span class="stat-value">${yearMatches.length}</span></p>
                        <p>–ü–æ–±–µ–¥: <span class="stat-value">${yearWins}</span> (${yearMatches.length ? Math.round(yearWins/yearMatches.length*100) : 0}%)</p>
                        <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${yearRatingChange > 0 ? '#4CAF50' : '#f44336'}">
                            ${yearRatingChange > 0 ? '+' : ''}${yearRatingChange}</span></p>
                    </div>
                    <div class="stat-period-box">
                        <h3>üìÖ –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</h3>
                        <p>–í—Å–µ–≥–æ –º–∞—Ç—á–µ–π: <span class="stat-value">${allTimeMatches.length}</span></p>
                        <p>–í—Å–µ–≥–æ –ø–æ–±–µ–¥: <span class="stat-value">${allTimeWins}</span> (${allTimeMatches.length ? Math.round(allTimeWins/allTimeMatches.length*100) : 0}%)</p>
                        <p>–û–±—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${allTimeRatingChange > 0 ? '#4CAF50' : '#f44336'}">
                            ${allTimeRatingChange > 0 ? '+' : ''}${allTimeRatingChange}</span></p>
                        <p>–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è: <span class="stat-value">${AppUtils.formatDate(playerData.joinDate)}</span></p>
                    </div>
                </div>
            `;
        }
    }

    function returnToMain() {
        document.getElementById('appContainer').style.display = 'block';
        document.getElementById('playerProfileContainer').style.display = 'none';
        document.getElementById('tournamentPageContainer').style.display = 'none';
        window.scrollTo(0, 0);
        return false;
    }

    // ============================================
    // –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
    // ============================================
    function loginAdmin() {
        const passwordInput = document.getElementById('adminPassword');
        const password = passwordInput?.value;
        
        if (!password) {
            AppUtils.showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!', 'error');
            return;
        }
        
        if (password !== CONFIG.ADMIN_PASSWORD) {
            AppUtils.showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!', 'error');
            return;
        }
        
        isAdmin = true;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        const appContainer = document.getElementById('appContainer');
        const loginPanel = document.getElementById('loginPanel');
        const adminPanel = document.getElementById('adminPanel');
        
        if (appContainer) appContainer.classList.add('admin-active');
        if (loginPanel) loginPanel.style.display = 'none';
        if (adminPanel) adminPanel.style.display = 'block';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—ã
        const adminControls = [
            'ratingAdminControls',
            'matchesAdminControls', 
            'penaltiesAdminControls',
            'playersAdminControls'
        ];
        
        adminControls.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'block';
        });
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
        if (passwordInput) passwordInput.value = '';
        
        localStorage.setItem('tennisAdmin', 'true');
        updateAllDisplays();
        
        setTimeout(applyAchievementBonuses, 1000);
        AppUtils.showNotification('‚úÖ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!', 'success');
    }

    function logoutAdmin() {
        isAdmin = false;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        const appContainer = document.getElementById('appContainer');
        const loginPanel = document.getElementById('loginPanel');
        const adminPanel = document.getElementById('adminPanel');
        
        if (appContainer) appContainer.classList.remove('admin-active');
        if (loginPanel) loginPanel.style.display = 'block';
        if (adminPanel) adminPanel.style.display = 'none';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—ã
        const adminControls = [
            'ratingAdminControls',
            'matchesAdminControls', 
            'penaltiesAdminControls',
            'playersAdminControls'
        ];
        
        adminControls.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'none';
        });
        
        localStorage.removeItem('tennisAdmin');
        updateAllDisplays();
        AppUtils.showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'info');
    }

    function checkAutoLogin() {
        const saved = localStorage.getItem('tennisAdmin');
        if (saved === 'true') {
            isAdmin = true;
            
            const appContainer = document.getElementById('appContainer');
            const loginPanel = document.getElementById('loginPanel');
            const adminPanel = document.getElementById('adminPanel');
            
            if (appContainer) appContainer.classList.add('admin-active');
            if (loginPanel) loginPanel.style.display = 'none';
            if (adminPanel) adminPanel.style.display = 'block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—ã
            const adminControls = [
                'ratingAdminControls',
                'matchesAdminControls', 
                'penaltiesAdminControls',
                'playersAdminControls'
            ];
            
            adminControls.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'block';
            });
        }
    }

    // ============================================
    // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ============================================
    function updatePlayerSelects() {
        const selects = ['player1', 'player2', 'statsPlayerSelect', 'comparePlayer1', 'comparePlayer2'];
        const playerNames = Object.keys(players).sort();
        
        selects.forEach(selectId => {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>';
            
            playerNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
            
            if (players[currentValue]) {
                select.value = currentValue;
            }
        });
    }

    async function addPlayer() {
        if (!isAdmin) {
            AppUtils.showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏–≥—Ä–æ–∫–æ–≤!', 'error');
            return;
        }
        
        const nameInput = document.getElementById('newPlayerName');
        const avatarInput = document.getElementById('newPlayerAvatar');
        const ratingInput = document.getElementById('newPlayerRating');
        
        if (!nameInput || !avatarInput || !ratingInput) return;
        
        const name = nameInput.value.trim();
        const avatar = avatarInput.value.trim();
        const rating = parseInt(ratingInput.value) || 1000;
        
        if (!name) {
            AppUtils.showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞!', 'error');
            return;
        }
        
        if (players[name]) {
            AppUtils.showNotification('–ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
            return;
        }
        
        const newPlayer = {
            rating: rating,
            matches: 0,
            wins: 0,
            lastGame: null,
            joinDate: new Date(),
            penalties: 0,
            avatar: avatar || `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`,
            achievement_bonuses: {}
        };
        
        players[name] = newPlayer;
        
        try {
            await SupabaseManager.savePlayer(name, newPlayer);
            updatePlayerSelects();
            updateAllDisplays();
            
            nameInput.value = '';
            avatarInput.value = '';
            ratingInput.value = '1000';
            
            AppUtils.showNotification(`‚úÖ –ò–≥—Ä–æ–∫ ${name} –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
        } catch (error) {
            AppUtils.showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞', 'error');
        }
    }

    async function removePlayer(name) {
        if (!isAdmin) {
            AppUtils.showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∏–≥—Ä–æ–∫–æ–≤!', 'error');
            return;
        }
        
        if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ ${name}?`)) return;
        
        delete players[name];
        matches = matches.filter(m => m.player1 !== name && m.player2 !== name);
        penaltyLog = penaltyLog.filter(p => p.player !== name);
        
        updatePlayerSelects();
        updateAllDisplays();
        AppUtils.showNotification(`‚úÖ –ò–≥—Ä–æ–∫ ${name} —É–¥–∞–ª–µ–Ω!`, 'success');
    }

    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ============================================
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        checkAutoLogin();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –¥–ª—è –º–∞—Ç—á–∞
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById('matchDate');
        if (dateInput) {
            dateInput.value = today;
            dateInput.min = '2020-01-01';
            dateInput.max = today;
        }
        
        await SupabaseManager.init();
        updatePlayerSelects();
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
    document.head.insertAdjacentHTML('beforeend', `
        <style>
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        </style>
    `);
    </script>
</body>
</html>
