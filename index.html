<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞</title>
    <style>
        /* ... –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            -webkit-text-size-adjust: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* ... –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–æ .bottom-panels –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –¢–£–†–ù–ò–†–û–í */
        .tournament-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .tournament-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #4CAF50;
        }
        
        .tournament-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .tournament-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }
        
        .tournament-date {
            color: #666;
            font-size: 0.9em;
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .tournament-winner {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .tournament-winner-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid gold;
        }
        
        .tournament-participants {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .participant-badge {
            background: #e3f2fd;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            border: 1px solid #bbdefb;
        }
        
        .tournament-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .tournament-photo {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .tournament-photo:hover {
            transform: scale(1.05);
        }
        
        .tournament-matches {
            margin-top: 20px;
            border-top: 2px solid #eee;
            padding-top: 15px;
        }
        
        .tournament-match {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .match-players {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .match-result {
            font-weight: bold;
            color: #4CAF50;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç—É—Ä–Ω–∏—Ä–∞ */
        .tournament-page {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .tournament-page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .tournament-page-info {
            flex: 1;
        }
        
        .tournament-page-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .tournament-winner-large {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border-radius: 12px;
            border: 3px solid gold;
        }
        
        .winner-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid gold;
            object-fit: cover;
        }
        
        .winner-info {
            flex: 1;
        }
        
        .winner-name {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }
        
        .winner-trophy {
            font-size: 3em;
            margin-right: 20px;
        }
        
        .photo-upload-area {
            border: 3px dashed #4CAF50;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .photo-upload-area:hover {
            background: #f0f9f0;
            border-color: #45a049;
        }
        
        .photo-upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #4CAF50;
        }
        
        .tournament-round {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .round-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ */
        .create-tournament-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .create-tournament-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        
        .participants-select {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
        }
        
        .participant-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .participant-checkbox:hover {
            background: #f5f5f5;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ —Ç—É—Ä–Ω–∏—Ä–∞ */
        .tournament-bracket {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }
        
        .bracket-round {
            flex: 1;
            min-width: 250px;
        }
        
        .bracket-match {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .bracket-match:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .match-player {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .match-player.winner {
            background: #e8f5e9;
            font-weight: bold;
        }
        
        .match-score-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin: 0 5px;
        }
        
        .save-match-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        /* –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä */
        .round-robin-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .round-robin-table th {
            background: #4CAF50;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .round-robin-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .player-standing {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .standing-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ */
        .uploaded-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .uploaded-photo {
            position: relative;
        }
        
        .delete-photo-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: none;
        }
        
        .uploaded-photo:hover .delete-photo-btn {
            display: block;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .tournament-page-header {
                flex-direction: column;
            }
            
            .tournament-winner-large {
                flex-direction: column;
                text-align: center;
            }
            
            .winner-avatar-large {
                width: 100px;
                height: 100px;
            }
            
            .tournament-bracket {
                flex-direction: column;
            }
            
            .bracket-round {
                width: 100%;
            }
        }
        
        /* ... –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
        
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä–æ–∫–∞ -->
    <div class="container" id="playerProfileContainer" style="display: none;">
        <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä–æ–∫–∞ ... -->
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞ -->
    <div class="container" id="tournamentContainer" style="display: none;">
        <div class="tournament-page">
            <div class="tournament-page-header">
                <div class="tournament-page-info">
                    <h1 id="tournamentName" class="tournament-page-title"></h1>
                    <div id="tournamentDate" class="tournament-date"></div>
                    <div id="tournamentStatus" class="tournament-status"></div>
                </div>
                <button class="back-button" onclick="returnToMain()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</button>
            </div>
            
            <!-- –ü–æ–±–µ–¥–∏—Ç–µ–ª—å -->
            <div id="tournamentWinnerSection" class="tournament-winner-large" style="display: none;">
                <div class="winner-trophy">üèÜ</div>
                <img id="winnerAvatar" src="" class="winner-avatar-large" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                <div class="winner-info">
                    <div class="winner-name" id="winnerName"></div>
                    <div id="winnerStats"></div>
                    <div id="finalScore"></div>
                </div>
            </div>
            
            <!-- –°–µ—Ç–∫–∞ —Ç—É—Ä–Ω–∏—Ä–∞ -->
            <div id="tournamentBracket"></div>
            
            <!-- –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä -->
            <div id="roundRobinSection" style="display: none;">
                <h3 class="round-title">üîÅ –ö—Ä—É–≥–æ–≤–æ–π —ç—Ç–∞–ø</h3>
                <div id="roundRobinTable"></div>
            </div>
            
            <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
            <div class="tournament-round">
                <h3 class="round-title">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div id="tournamentParticipants" class="tournament-participants"></div>
            </div>
            
            <!-- –ú–∞—Ç—á–∏ -->
            <div class="tournament-matches">
                <h3 class="round-title">üéÆ –í—Å–µ –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div id="tournamentMatchesList"></div>
            </div>
            
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ -->
            <div class="tournament-round" id="photoUploadSection">
                <h3 class="round-title">üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div class="photo-upload-area" onclick="document.getElementById('photoUpload').click()" id="uploadArea">
                    <div class="photo-upload-icon">üì∑</div>
                    <div>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</div>
                    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG, PNG. –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 5MB
                    </div>
                </div>
                <input type="file" id="photoUpload" accept="image/*" multiple style="display: none;" onchange="uploadTournamentPhotos(this.files)">
                
                <div id="uploadedPhotos" class="uploaded-photos"></div>
            </div>
            
            <!-- –ê–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—ã -->
            <div id="tournamentAdminControls" class="admin-controls" style="display: none;">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–æ–º</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="action-btn add-btn" onclick="addTournamentMatch()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á</button>
                    <button class="action-btn penalty-btn" onclick="simulateTournament()">üéÆ –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
                    <button class="action-btn" style="background: #9C27B0; color: white;" onclick="editTournament()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="action-btn delete-btn" onclick="deleteTournament()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container" id="appContainer">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢</h1>
            <div class="header-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞</div>
        </header>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üèÖ –¢—É—Ä–Ω–∏—Ä—ã</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content active" id="rating">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–µ–π—Ç–∏–Ω–≥–∞ ... -->
        </div>
        
        <div class="tab-content" id="matches">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –º–∞—Ç—á–µ–π ... -->
        </div>
        
        <div class="tab-content" id="players">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∏–≥—Ä–æ–∫–æ–≤ ... -->
        </div>
        
        <div class="tab-content" id="stats">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ... -->
        </div>
        
        <div class="tab-content" id="penalties">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —à—Ç—Ä–∞—Ñ–æ–≤ ... -->
        </div>
        
        <!-- –ù–û–í–ê–Ø –í–ö–õ–ê–î–ö–ê –¢–£–†–ù–ò–†–û–í -->
        <div class="tab-content" id="tournaments">
            <h2>üèÖ –¢—É—Ä–Ω–∏—Ä—ã –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è</h2>
            
            <div id="tournamentsAdminControls" class="admin-controls" style="display: none;">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞–º–∏ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="create-tournament-btn" onclick="showCreateTournamentModal()">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä
                </button>
                <p><small>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç—É—Ä–Ω–∏—Ä—ã —Å –∫—Ä—É–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏–ª–∏ –ø–ª–µ–π-–æ—Ñ—Ñ</small></p>
            </div>
            
            <div id="tournamentsList">
                <p style="text-align: center; padding: 40px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤...</p>
            </div>
            
            <div id="noTournaments" style="display: none; text-align: center; padding: 40px;">
                <h3 style="font-size: 16px; margin-bottom: 10px;">üéæ –¢—É—Ä–Ω–∏—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p style="font-size: 14px;">–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç—É—Ä–Ω–∏—Ä</p>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª–∏ –≤–Ω–∏–∑—É —Å–∞–π—Ç–∞ -->
        <div class="bottom-panels">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞–Ω–µ–ª–∏ ... -->
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ -->
    <div class="modal-overlay" id="createTournamentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üèÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞</div>
                <button class="close-modal" onclick="closeCreateTournamentModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                <input type="text" id="tournamentNameInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É–±–æ–∫ –í–µ—Å–Ω—ã 2024">
            </div>
            
            <div class="form-group">
                <label>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</label>
                <input type="date" id="tournamentDateInput">
            </div>
            
            <div class="form-group">
                <label>–¢–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                <select id="tournamentType">
                    <option value="round-robin">–ö—Ä—É–≥–æ–≤–æ–π (–∫–∞–∂–¥—ã–π —Å –∫–∞–∂–¥—ã–º)</option>
                    <option value="knockout">–ü–ª–µ–π-–æ—Ñ—Ñ (–≤—ã–±—ã–≤–∞–Ω–∏–µ)</option>
                    <option value="mixed">–°–º–µ—à–∞–Ω–Ω—ã–π (–≥—Ä—É–ø–ø—ã + –ø–ª–µ–π-–æ—Ñ—Ñ)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ñ–∏–Ω–∞–ª–µ:</label>
                <select id="finalParticipants">
                    <option value="2">2 (—Ñ–∏–Ω–∞–ª)</option>
                    <option value="4">4 (–ø–æ–ª—É—Ñ–∏–Ω–∞–ª—ã)</option>
                    <option value="8">8 (—á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª—ã)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</label>
                <div class="participants-select" id="tournamentParticipantsSelect">
                    <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <div style="margin-top: 10px;">
                    <button class="action-btn" onclick="selectAllPlayers()" style="background: #2196F3; margin-right: 10px;">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö</button>
                    <button class="action-btn" onclick="deselectAllPlayers()" style="background: #9E9E9E;">–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>–§–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π:</label>
                <select id="matchFormat">
                    <option value="bo3">–î–æ 2 –ø–æ–±–µ–¥ (best of 3)</option>
                    <option value="bo5">–î–æ 3 –ø–æ–±–µ–¥ (best of 5)</option>
                    <option value="single">–û–¥–Ω–∞ –ø–∞—Ä—Ç–∏—è</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <textarea id="tournamentDescription" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–Ω–∏—Ä–µ..."></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="action-btn add-btn" style="flex: 1;" onclick="createTournament()">‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
                <button class="action-btn" style="flex: 1; background: #9E9E9E;" onclick="closeCreateTournamentModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE
    // ============================================
    const SUPABASE_URL = 'https://bqycjfcjtdawyrysgrbw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWNqZmNqdGRhd3lyeXNncmJ3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjYwMTk3MCwiZXhwIjoyMDgyMTc3OTcwfQ.lHA_79fw8PSj9ZHMExBpSEIpkonkCYOni7HniGGqadY';
    
    let supabaseClient = null;
    let isSupabaseInitialized = false;
    
    // ============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –¢–£–†–ù–ò–†–û–í
    // ============================================
    let tournaments = [];
    let currentTournament = null;
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ============================================
    
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ-–ª–æ–≥–∏–Ω
        checkAutoLogin();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
        setMatchDateToToday();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Supabase
        await initSupabase();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
        updatePlayerSelects();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
        await loadTournaments();
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }
    
    async function initSupabase() {
        console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞...');
        updateSupabaseStatus('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
        
        try {
            if (!window.supabase) {
                console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É Supabase...');
                await loadSupabaseLibrary();
            }
            
            if (!window.supabase || !window.supabase.createClient) {
                throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Supabase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            }
            
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            isSupabaseInitialized = true;
            
            console.log('‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω');
            updateSupabaseStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            await createTournamentTables();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            await loadAllData();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadAllData, 30000);
            
            return supabaseClient;
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Supabase:', error);
            updateSupabaseStatus('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
            return null;
        }
    }
    
    // ============================================
    // –°–û–ó–î–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶ –î–õ–Ø –¢–£–†–ù–ò–†–û–í –í SUPABASE
    // ============================================
    
    async function createTournamentTables() {
        if (!supabaseClient) return;
        
        try {
            console.log('üîÑ –ü—Ä–æ–≤–µ—Ä—è—é —Ç–∞–±–ª–∏—Ü—ã —Ç—É—Ä–Ω–∏—Ä–æ–≤ –≤ Supabase...');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É tournaments
            const { error: tournamentsError } = await supabaseClient
                .from('tournaments')
                .select('*')
                .limit(1);
            
            if (tournamentsError && tournamentsError.message.includes('does not exist')) {
                console.log('üìä –¢–∞–±–ª–∏—Ü–∞ tournaments –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞—é...');
                showNotification('–°–æ–∑–¥–∞—é —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤...', 'info');
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ SQL –≤ Supabase Dashboard
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
                const tablesInfo = `
                –î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—É—Ä–Ω–∏—Ä–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase:
                
                1. –¢–∞–±–ª–∏—Ü–∞ tournaments:
                   - id: uuid (primary key)
                   - name: text
                   - date: date
                   - type: text (round-robin, knockout, mixed)
                   - status: text (planned, ongoing, completed)
                   - participants: jsonb
                   - winner: text
                   - description: text
                   - created_at: timestamp
                   - updated_at: timestamp
                
                2. –¢–∞–±–ª–∏—Ü–∞ tournament_matches:
                   - id: uuid (primary key)
                   - tournament_id: uuid (foreign key)
                   - round: text
                   - player1: text
                   - player2: text
                   - winner: text
                   - score: text
                   - date: timestamp
                   - status: text (scheduled, completed)
                
                3. –¢–∞–±–ª–∏—Ü–∞ tournament_photos:
                   - id: uuid (primary key)
                   - tournament_id: uuid (foreign key)
                   - url: text
                   - uploaded_at: timestamp
                   - uploaded_by: text
                
                –°–æ–∑–¥–∞–π—Ç–µ —ç—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ SQL Editor –≤ Supabase Dashboard.
                `;
                
                console.log(tablesInfo);
            }
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü:', error);
        }
    }
    
    // ============================================
    // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç—É—Ä–Ω–∏—Ä—ã
    async function loadTournaments() {
        if (!supabaseClient) return;
        
        try {
            const { data, error } = await supabaseClient
                .from('tournaments')
                .select('*')
                .order('date', { ascending: false });
            
            if (error) {
                if (error.message.includes('does not exist')) {
                    console.log('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ tournaments –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    tournaments = [];
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
                }
            } else {
                tournaments = data;
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${tournaments.length} —Ç—É—Ä–Ω–∏—Ä–æ–≤`);
            }
            
            updateTournamentsDisplay();
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
        }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
    async function showTournament(tournamentId) {
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        currentTournament = tournament;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('tournamentContainer').style.display = 'block';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('tournamentName').textContent = tournament.name;
        document.getElementById('tournamentDate').textContent = 
            `–î–∞—Ç–∞: ${new Date(tournament.date).toLocaleDateString('ru-RU')}`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        const statusElement = document.getElementById('tournamentStatus');
        if (tournament.status === 'completed') {
            statusElement.innerHTML = '<span style="color: #4CAF50; font-weight: bold;">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</span>';
        } else if (tournament.status === 'ongoing') {
            statusElement.innerHTML = '<span style="color: #FF9800; font-weight: bold;">üéÆ –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>';
        } else {
            statusElement.innerHTML = '<span style="color: #2196F3; font-weight: bold;">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</span>';
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        await loadTournamentDetails(tournamentId);
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö
        window.scrollTo(0, 0);
    }
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç—É—Ä–Ω–∏—Ä–∞
    async function loadTournamentDetails(tournamentId) {
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            const { data: matchesData } = await supabaseClient
                .from('tournament_matches')
                .select('*')
                .eq('tournament_id', tournamentId)
                .order('round')
                .order('date');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
            const { data: photosData } = await supabaseClient
                .from('tournament_photos')
                .select('*')
                .eq('tournament_id', tournamentId)
                .order('uploaded_at', { ascending: false });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateTournamentPage(matchesData || [], photosData || []);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç—É—Ä–Ω–∏—Ä–∞:', error);
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
    function updateTournamentPage(matches, photos) {
        // –£—á–∞—Å—Ç–Ω–∏–∫–∏
        const participantsContainer = document.getElementById('tournamentParticipants');
        if (currentTournament.participants && Array.isArray(currentTournament.participants)) {
            participantsContainer.innerHTML = currentTournament.participants.map(player => `
                <div class="participant-badge">${player}</div>
            `).join('');
        }
        
        // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å
        if (currentTournament.winner) {
            document.getElementById('tournamentWinnerSection').style.display = 'flex';
            document.getElementById('winnerName').textContent = currentTournament.winner;
            
            // –ë–µ—Ä–µ–º –∞–≤–∞—Ç–∞—Ä –∏–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞
            const winnerAvatar = players[currentTournament.winner]?.avatar || 'https://i.pravatar.cc/150?img=3';
            document.getElementById('winnerAvatar').src = winnerAvatar;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            const winnerStats = players[currentTournament.winner];
            if (winnerStats) {
                document.getElementById('winnerStats').innerHTML = `
                    <div>–†–µ–π—Ç–∏–Ω–≥: ${winnerStats.rating} –æ—á–∫–æ–≤</div>
                    <div>–ü–æ–±–µ–¥: ${winnerStats.wins} –∏–∑ ${winnerStats.matches}</div>
                `;
            }
        }
        
        // –ú–∞—Ç—á–∏
        const matchesContainer = document.getElementById('tournamentMatchesList');
        if (matches.length > 0) {
            matchesContainer.innerHTML = matches.map(match => `
                <div class="tournament-match">
                    <div class="match-players">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${players[match.player1]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 style="width: 30px; height: 30px; border-radius: 50%;">
                            <span>${match.player1}</span>
                        </div>
                        <div class="match-result">${match.score || (match.winner === match.player1 ? '–ü–æ–±–µ–¥–∞' : match.winner === match.player2 ? '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ' : '–ù–∏—á—å—è')}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span>${match.player2}</span>
                            <img src="${players[match.player2]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 style="width: 30px; height: 30px; border-radius: 50%;">
                        </div>
                    </div>
                    <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                        ${match.round} ‚Ä¢ ${new Date(match.date).toLocaleDateString('ru-RU')}
                    </div>
                </div>
            `).join('');
        } else {
            matchesContainer.innerHTML = '<p style="text-align: center; padding: 20px;">–ú–∞—Ç—á–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        }
        
        // –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        const photosContainer = document.getElementById('uploadedPhotos');
        if (photos.length > 0) {
            photosContainer.innerHTML = photos.map(photo => `
                <div class="uploaded-photo">
                    <img src="${photo.url}" class="tournament-photo" onclick="openPhotoModal('${photo.url}')">
                    ${isAdmin ? `<button class="delete-photo-btn" onclick="deleteTournamentPhoto('${photo.id}')">√ó</button>` : ''}
                </div>
            `).join('');
        } else {
            photosContainer.innerHTML = '<p style="text-align: center; color: #666;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
        }
        
        // –°–µ—Ç–∫–∞ —Ç—É—Ä–Ω–∏—Ä–∞
        updateTournamentBracket(matches);
        
        // –ê–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—ã
        document.getElementById('tournamentAdminControls').style.display = isAdmin ? 'block' : 'none';
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É —Ç—É—Ä–Ω–∏—Ä–∞
    function updateTournamentBracket(matches) {
        const bracketContainer = document.getElementById('tournamentBracket');
        
        if (currentTournament.type === 'round-robin' && currentTournament.participants.length === 3) {
            // –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä –¥–ª—è 3 –∏–≥—Ä–æ–∫–æ–≤
            document.getElementById('roundRobinSection').style.display = 'block';
            
            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const participants = currentTournament.participants;
            let standings = [];
            
            participants.forEach(player => {
                // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const playerMatches = matches.filter(m => 
                    m.player1 === player || m.player2 === player
                );
                
                const wins = playerMatches.filter(m => m.winner === player).length;
                const losses = playerMatches.filter(m => 
                    m.winner && m.winner !== player && m.winner !== 'draw'
                ).length;
                const draws = playerMatches.filter(m => m.winner === 'draw').length;
                
                // –°—á–∏—Ç–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –æ—á–∫–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
                let pointsDiff = 0;
                playerMatches.forEach(match => {
                    if (match.score) {
                        const [score1, score2] = match.score.split(':').map(Number);
                        if (match.player1 === player) {
                            pointsDiff += (score1 - score2);
                        } else {
                            pointsDiff += (score2 - score1);
                        }
                    }
                });
                
                standings.push({
                    player,
                    matches: playerMatches.length,
                    wins,
                    losses,
                    draws,
                    points: wins * 2 + draws,
                    pointsDiff
                });
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º, –∑–∞—Ç–µ–º –ø–æ —Ä–∞–∑–Ω–∏—Ü–µ
            standings.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return b.pointsDiff - a.pointsDiff;
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            const tableHTML = `
                <table class="round-robin-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–ü–æ–±–µ–¥—ã</th>
                            <th>–ü–æ—Ä–∞–∂–µ–Ω–∏—è</th>
                            <th>–ù–∏—á—å–∏</th>
                            <th>–û—á–∫–∏</th>
                            <th>+/-</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${standings.map((standing, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td class="player-standing">
                                    <img src="${players[standing.player]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                         class="standing-avatar">
                                    ${standing.player}
                                </td>
                                <td>${standing.matches}</td>
                                <td>${standing.wins}</td>
                                <td>${standing.losses}</td>
                                <td>${standing.draws}</td>
                                <td><strong>${standing.points}</strong></td>
                                <td>${standing.pointsDiff > 0 ? '+' : ''}${standing.pointsDiff}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('roundRobinTable').innerHTML = tableHTML;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∏–Ω–∞–ª–∏—Å—Ç–æ–≤
            if (matches.length >= 3) { // –í—Å–µ –º–∞—Ç—á–∏ —Å—ã–≥—Ä–∞–Ω—ã
                const finalists = standings.slice(0, 2).map(s => s.player);
                bracketContainer.innerHTML = `
                    <h3 class="round-title">üèÜ –§–∏–Ω–∞–ª</h3>
                    <div class="bracket-match">
                        <div class="match-player ${currentTournament.winner === finalists[0] ? 'winner' : ''}">
                            <img src="${players[finalists[0]]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 style="width: 30px; height: 30px; border-radius: 50%;">
                            ${finalists[0]}
                        </div>
                        <div style="text-align: center; padding: 10px; font-weight: bold;">VS</div>
                        <div class="match-player ${currentTournament.winner === finalists[1] ? 'winner' : ''}">
                            <img src="${players[finalists[1]]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 style="width: 30px; height: 30px; border-radius: 50%;">
                            ${finalists[1]}
                        </div>
                        ${currentTournament.winner ? `
                            <div style="text-align: center; margin-top: 10px; color: #4CAF50; font-weight: bold;">
                                üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${currentTournament.winner}
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
        } else {
            // –û–±—ã—á–Ω–∞—è —Å–µ—Ç–∫–∞ —Ç—É—Ä–Ω–∏—Ä–∞
            document.getElementById('roundRobinSection').style.display = 'none';
            bracketContainer.innerHTML = createTournamentBracket(matches);
        }
    }
    
    // –°–æ–∑–¥–∞—Ç—å —Å–µ—Ç–∫—É —Ç—É—Ä–Ω–∏—Ä–∞
    function createTournamentBracket(matches) {
        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ —Ä–∞—É–Ω–¥–∞–º
        const rounds = {};
        matches.forEach(match => {
            if (!rounds[match.round]) rounds[match.round] = [];
            rounds[match.round].push(match);
        });
        
        // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞
        let bracketHTML = '<div class="tournament-bracket">';
        
        Object.keys(rounds).forEach(roundName => {
            bracketHTML += `
                <div class="bracket-round">
                    <h4 class="round-title">${getRoundName(roundName)}</h4>
                    ${rounds[roundName].map(match => `
                        <div class="bracket-match">
                            <div class="match-player ${match.winner === match.player1 ? 'winner' : ''}">
                                ${match.player1}
                                ${match.score ? `<span style="float: right;">${getPlayerScore(match.score, 1)}</span>` : ''}
                            </div>
                            <div class="match-player ${match.winner === match.player2 ? 'winner' : ''}">
                                ${match.player2}
                                ${match.score ? `<span style="float: right;">${getPlayerScore(match.score, 2)}</span>` : ''}
                            </div>
                            ${isAdmin && !match.winner ? `
                                <div style="margin-top: 10px;">
                                    <input type="text" class="match-score-input" placeholder="3:2" id="score_${match.id}">
                                    <button class="save-match-btn" onclick="saveMatchResult('${match.id}')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        });
        
        bracketHTML += '</div>';
        return bracketHTML;
    }
    
    function getRoundName(round) {
        const roundNames = {
            'final': 'üèÜ –§–∏–Ω–∞–ª',
            'semifinal': 'ü•à –ü–æ–ª—É—Ñ–∏–Ω–∞–ª',
            'quarterfinal': 'ü•â –ß–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª',
            'qualifying': 'üéØ –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è',
            'group': 'üîÅ –ì—Ä—É–ø–ø–æ–≤–æ–π —ç—Ç–∞–ø'
        };
        return roundNames[round] || round;
    }
    
    function getPlayerScore(score, playerNumber) {
        if (!score) return '';
        const scores = score.split(':');
        return scores[playerNumber - 1];
    }
    
    // ============================================
    // –°–û–ó–î–ê–ù–ò–ï –ò –£–î–ê–õ–ï–ù–ò–ï –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    function showCreateTournamentModal() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        const modal = document.getElementById('createTournamentModal');
        modal.style.display = 'flex';
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
        document.getElementById('tournamentDateInput').value = new Date().toISOString().split('T')[0];
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
        const participantsContainer = document.getElementById('tournamentParticipantsSelect');
        participantsContainer.innerHTML = '';
        
        Object.keys(players).forEach(playerName => {
            const div = document.createElement('div');
            div.className = 'participant-checkbox';
            div.innerHTML = `
                <input type="checkbox" id="player_${playerName}" value="${playerName}">
                <label for="player_${playerName}">${playerName}</label>
            `;
            participantsContainer.appendChild(div);
        });
    }
    
    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    function closeCreateTournamentModal() {
        document.getElementById('createTournamentModal').style.display = 'none';
    }
    
    // –í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
    function selectAllPlayers() {
        document.querySelectorAll('#tournamentParticipantsSelect input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = true;
        });
    }
    
    // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
    function deselectAllPlayers() {
        document.querySelectorAll('#tournamentParticipantsSelect input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
    }
    
    // –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
    async function createTournament() {
        if (!isAdmin) return;
        
        const name = document.getElementById('tournamentNameInput').value.trim();
        const date = document.getElementById('tournamentDateInput').value;
        const type = document.getElementById('tournamentType').value;
        const format = document.getElementById('matchFormat').value;
        const description = document.getElementById('tournamentDescription').value.trim();
        
        if (!name) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
            return;
        }
        
        if (!date) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const selectedPlayers = [];
        document.querySelectorAll('#tournamentParticipantsSelect input[type="checkbox"]:checked').forEach(checkbox => {
            selectedPlayers.push(checkbox.value);
        });
        
        if (selectedPlayers.length < 2) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞!', 'error');
            return;
        }
        
        // –î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –∏–∑ 3 –∏–≥—Ä–æ–∫–æ–≤ —Å–æ–∑–¥–∞–µ–º –º–∞—Ç—á–∏
        const participants = selectedPlayers;
        let matches = [];
        
        if (type === 'round-robin' && participants.length === 3) {
            // –°–æ–∑–¥–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–∞—Ä—ã –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
            for (let i = 0; i < participants.length; i++) {
                for (let j = i + 1; j < participants.length; j++) {
                    matches.push({
                        player1: participants[i],
                        player2: participants[j],
                        round: 'group',
                        status: 'scheduled'
                    });
                }
            }
        }
        
        try {
            // –°–æ–∑–¥–∞–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            const { data: tournament, error } = await supabaseClient
                .from('tournaments')
                .insert({
                    name,
                    date,
                    type,
                    status: 'planned',
                    participants,
                    description,
                    match_format: format,
                    created_at: new Date().toISOString()
                })
                .select()
                .single();
            
            if (error) throw error;
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—á–∏ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞
            if (matches.length > 0) {
                const matchesToInsert = matches.map(match => ({
                    tournament_id: tournament.id,
                    ...match,
                    date: new Date().toISOString()
                }));
                
                await supabaseClient
                    .from('tournament_matches')
                    .insert(matchesToInsert);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            await loadTournaments();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeCreateTournamentModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${name}" —Å–æ–∑–¥–∞–Ω!`, 'success');
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
            setTimeout(() => showTournament(tournament.id), 500);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä
    async function deleteTournament() {
        if (!isAdmin || !currentTournament) return;
        
        if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä "${currentTournament.name}"? –í—Å–µ –º–∞—Ç—á–∏ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
            return;
        }
        
        try {
            // –£–¥–∞–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            await supabaseClient
                .from('tournament_photos')
                .delete()
                .eq('tournament_id', currentTournament.id);
            
            // –£–¥–∞–ª—è–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            await supabaseClient
                .from('tournament_matches')
                .delete()
                .eq('tournament_id', currentTournament.id);
            
            // –£–¥–∞–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä
            await supabaseClient
                .from('tournaments')
                .delete()
                .eq('id', currentTournament.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            await loadTournaments();
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
            returnToMain();
            
            showNotification(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${currentTournament.name}" —É–¥–∞–ª–µ–Ω!`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // ============================================
    // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ê–¢–ß–ê–ú–ò –¢–£–†–ù–ò–†–ê
    // ============================================
    
    // –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á –≤ —Ç—É—Ä–Ω–∏—Ä
    async function addTournamentMatch() {
        if (!isAdmin || !currentTournament) return;
        
        const player1 = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞:');
        const player2 = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞:');
        const round = prompt('–í–≤–µ–¥–∏—Ç–µ —Ä–∞—É–Ω–¥ (final, semifinal, group –∏ —Ç.–¥.):', 'group');
        
        if (!player1 || !player2 || !round) return;
        
        if (!players[player1] || !players[player2]) {
            showNotification('–û–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        try {
            const { error } = await supabaseClient
                .from('tournament_matches')
                .insert({
                    tournament_id: currentTournament.id,
                    player1,
                    player2,
                    round,
                    status: 'scheduled',
                    date: new Date().toISOString()
                });
            
            if (error) throw error;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
            await loadTournamentDetails(currentTournament.id);
            
            showNotification('‚úÖ –ú–∞—Ç—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ç—É—Ä–Ω–∏—Ä!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞', 'error');
        }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞
    async function saveMatchResult(matchId) {
        if (!isAdmin) return;
        
        const scoreInput = document.getElementById(`score_${matchId}`);
        if (!scoreInput) return;
        
        const score = scoreInput.value.trim();
        if (!score || !score.includes(':')) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ —Å—á–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ 3:2', 'error');
            return;
        }
        
        const [score1, score2] = score.split(':').map(Number);
        if (isNaN(score1) || isNaN(score2)) {
            showNotification('–°—á–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ —á–∏—Å–µ–ª!', 'error');
            return;
        }
        
        let winner;
        if (score1 > score2) {
            // –ù–∞–π—Ç–∏ –∏–≥—Ä–æ–∫–∞ 1 –¥–ª—è —ç—Ç–æ–≥–æ –º–∞—Ç—á–∞
            const match = await getTournamentMatch(matchId);
            winner = match?.player1;
        } else if (score2 > score1) {
            const match = await getTournamentMatch(matchId);
            winner = match?.player2;
        } else {
            winner = 'draw';
        }
        
        try {
            const { error } = await supabaseClient
                .from('tournament_matches')
                .update({
                    score,
                    winner,
                    status: 'completed',
                    updated_at: new Date().toISOString()
                })
                .eq('id', matchId);
            
            if (error) throw error;
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∏–Ω–∞–ª - –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Ç—É—Ä–Ω–∏—Ä–∞
            const match = await getTournamentMatch(matchId);
            if (match && match.round === 'final' && winner && winner !== 'draw') {
                await supabaseClient
                    .from('tournaments')
                    .update({
                        winner,
                        status: 'completed',
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentTournament.id);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
            await loadTournamentDetails(currentTournament.id);
            
            showNotification('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', 'error');
        }
    }
    
    async function getTournamentMatch(matchId) {
        const { data } = await supabaseClient
            .from('tournament_matches')
            .select('*')
            .eq('id', matchId)
            .single();
        return data;
    }
    
    // ============================================
    // –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û–ì–†–ê–§–ò–ô
    // ============================================
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞
    async function uploadTournamentPhotos(files) {
        if (!isAdmin || !currentTournament) {
            showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏!', 'error');
            return;
        }
        
        if (files.length === 0) return;
        
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–∞ Supabase Storage
        // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Å—ã–ª–∫–∏ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
        
        showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π...', 'info');
        
        try {
            const uploadPromises = [];
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
            const filesToUpload = Array.from(files).slice(0, 10);
            
            for (const file of filesToUpload) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 5MB)`, 'error');
                    continue;
                }
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
                // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –≤ Supabase Storage
                // 2. –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É
                // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É tournament_photos
                
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—É—é –∑–∞–ø–∏—Å—å
                const photoData = {
                    tournament_id: currentTournament.id,
                    url: URL.createObjectURL(file), // –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞
                    uploaded_at: new Date().toISOString(),
                    uploaded_by: 'admin'
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Supabase (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
                /*
                const { error } = await supabaseClient
                    .from('tournament_photos')
                    .insert(photoData);
                
                if (error) throw error;
                */
                
                uploadPromises.push(Promise.resolve(photoData));
            }
            
            await Promise.all(uploadPromises);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
            await loadTournamentDetails(currentTournament.id);
            
            showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${filesToUpload.length} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π!`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π', 'error');
        }
    }
    
    // –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
    async function deleteTournamentPhoto(photoId) {
        if (!isAdmin) return;
        
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é?')) return;
        
        try {
            const { error } = await supabaseClient
                .from('tournament_photos')
                .delete()
                .eq('id', photoId);
            
            if (error) throw error;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
            await loadTournamentDetails(currentTournament.id);
            
            showNotification('‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', 'error');
        }
    }
    
    // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    function openPhotoModal(photoUrl) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        `;
        
        modal.innerHTML = `
            <img src="${photoUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            <button onclick="this.parentElement.remove()" style="
                position: absolute;
                top: 20px;
                right: 20px;
                background: none;
                border: none;
                color: white;
                font-size: 2em;
                cursor: pointer;
            ">√ó</button>
        `;
        
        document.body.appendChild(modal);
    }
    
    // ============================================
    // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ü–ò–°–ö–ê –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    function updateTournamentsDisplay() {
        const container = document.getElementById('tournamentsList');
        const noTournaments = document.getElementById('noTournaments');
        
        if (!container) return;
        
        if (tournaments.length === 0) {
            container.style.display = 'none';
            noTournaments.style.display = 'block';
            return;
        }
        
        container.style.display = 'block';
        noTournaments.style.display = 'none';
        
        container.innerHTML = tournaments.map(tournament => `
            <div class="tournament-card" onclick="showTournament('${tournament.id}')">
                <div class="tournament-header">
                    <div class="tournament-title">${tournament.name}</div>
                    <div class="tournament-date">
                        ${new Date(tournament.date).toLocaleDateString('ru-RU')}
                    </div>
                </div>
                
                <div style="color: #666; margin-bottom: 10px;">
                    ${tournament.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                </div>
                
                ${tournament.winner ? `
                    <div class="tournament-winner">
                        <img src="${players[tournament.winner]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                             class="tournament-winner-avatar">
                        <div>
                            <div style="font-weight: bold;">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${tournament.winner}</div>
                            <div style="font-size: 0.85em;">–†–µ–π—Ç–∏–Ω–≥: ${players[tournament.winner]?.rating || '0'} –æ—á–∫–æ–≤</div>
                        </div>
                    </div>
                ` : `
                    <div style="color: #FF9800; font-weight: bold;">
                        ${tournament.status === 'ongoing' ? 'üéÆ –í –ø—Ä–æ—Ü–µ—Å—Å–µ' : 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω'}
                    </div>
                `}
                
                <div class="tournament-participants">
                    ${tournament.participants ? tournament.participants.slice(0, 5).map(player => `
                        <div class="participant-badge">${player}</div>
                    `).join('') : ''}
                    ${tournament.participants && tournament.participants.length > 5 ? 
                        `<div class="participant-badge">+${tournament.participants.length - 5}</div>` : ''}
                </div>
                
                <div style="margin-top: 15px; font-size: 0.85em; color: #666;">
                    –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${tournament.participants?.length || 0} ‚Ä¢ 
                    –¢–∏–ø: ${getTournamentTypeName(tournament.type)}
                </div>
            </div>
        `).join('');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—ã
        document.getElementById('tournamentsAdminControls').style.display = isAdmin ? 'block' : 'none';
    }
    
    function getTournamentTypeName(type) {
        const types = {
            'round-robin': '–ö—Ä—É–≥–æ–≤–æ–π',
            'knockout': '–ü–ª–µ–π-–æ—Ñ—Ñ',
            'mixed': '–°–º–µ—à–∞–Ω–Ω—ã–π'
        };
        return types[type] || type;
    }
    
    // ============================================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ============================================
    
    // –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
    async function simulateTournament() {
        if (!isAdmin || !currentTournament) return;
        
        if (!confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é —Ç—É—Ä–Ω–∏—Ä–∞? –ë—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö –º–∞—Ç—á–µ–π.')) {
            return;
        }
        
        showNotification('üéÆ –°–∏–º—É–ª—è—Ü–∏—è —Ç—É—Ä–Ω–∏—Ä–∞...', 'info');
        
        try {
            // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            const { data: matches } = await supabaseClient
                .from('tournament_matches')
                .select('*')
                .eq('tournament_id', currentTournament.id);
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            for (const match of matches) {
                if (match.status !== 'completed') {
                    // –°–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const score1 = Math.floor(Math.random() * 3) + 1;
                    const score2 = Math.floor(Math.random() * 3);
                    const score = `${score1}:${score2}`;
                    const winner = score1 > score2 ? match.player1 : match.player2;
                    
                    await supabaseClient
                        .from('tournament_matches')
                        .update({
                            score,
                            winner,
                            status: 'completed'
                        })
                        .eq('id', match.id);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä
            await loadTournamentDetails(currentTournament.id);
            
            showNotification('‚úÖ –¢—É—Ä–Ω–∏—Ä —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
    function editTournament() {
        if (!isAdmin || !currentTournament) return;
        
        const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:', currentTournament.name);
        if (!newName) return;
        
        const newDescription = prompt('–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:', currentTournament.description || '');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä
        updateTournamentInfo(newName, newDescription);
    }
    
    async function updateTournamentInfo(name, description) {
        try {
            await supabaseClient
                .from('tournaments')
                .update({
                    name,
                    description,
                    updated_at: new Date().toISOString()
                })
                .eq('id', currentTournament.id);
            
            currentTournament.name = name;
            currentTournament.description = description;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            document.getElementById('tournamentName').textContent = name;
            
            showNotification('‚úÖ –¢—É—Ä–Ω–∏—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // ============================================
    // –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø
    // ============================================
    
    // –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ updateTournamentsDisplay –≤ updateAllDisplays
    function updateAllDisplays() {
        updateRatingTable();
        updateMatchesTable();
        updatePlayersTable();
        updatePenaltiesHistory();
        updatePeriodStats();
        updateYearProgressChart();
        updatePlayerSelects();
        updateAchievementsDisplay();
        updateTournamentsDisplay();
    }
    
    // ============================================
    // –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò (–û–°–¢–ê–Æ–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
    // ============================================
    
    // ... –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
    // (showPlayerProfile, returnToMain, getAchievementEmojis, updatePlayerStats, 
    //  updatePlayerAchievements, renderPlayerFormChart, getPlayerAchievements, 
    //  getAllAchievements, applyAchievementBonuses, updateAchievementsDisplay,
    //  loadAllData, savePlayerToSupabase, saveMatchToSupabase, savePenaltyToSupabase,
    //  deleteMatchFromSupabase, updateSupabaseStatus, updateSupabaseTime,
    //  loginAdmin, logoutAdmin, checkAutoLogin, updateMatchesTable,
    //  updateRatingTable, updatePlayersTable, updatePenaltiesHistory,
    //  addMatch, saveManualRatings, applyManualPenalty, checkAndApplyPenalties,
    //  addPlayer, removePlayer, deleteMatch, changeAvatar, updatePlayerSelects,
    //  updatePeriodStats, getActiveMonths, updateTopYearPlayers,
    //  updateYearProgressChart, comparePlayers, showNotification,
    //  setMatchDateToToday, openTab, init, loadSupabaseLibrary)
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ============================================
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    </script>
</body>
</html>
