<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞ - –°—Ç–∞–≤–∫–∏</title>
    <style>
        /* –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –°–¢–ê–í–û–ö */
        .betting-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .betting-panel h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bet-match-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .bet-match-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .bet-match-card.live {
            border-color: #ff4444;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { border-color: #ff4444; }
            50% { border-color: #ff8888; }
            100% { border-color: #ff4444; }
        }
        
        .match-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .match-players {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 200px;
        }
        
        .player-bet-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
        }
        
        .player-bet-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid white;
            margin-bottom: 5px;
        }
        
        .vs-text {
            font-size: 1.2em;
            font-weight: bold;
            color: #FFD700;
            margin: 0 10px;
        }
        
        .bet-odds {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .bet-odds.winner {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }
        
        .bet-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .bet-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bet-input-group input {
            flex: 1;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        
        .bet-input-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .bet-buttons {
            display: flex;
            gap: 10px;
        }
        
        .bet-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .bet-btn-player1 {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
        }
        
        .bet-btn-player2 {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
            color: white;
        }
        
        .bet-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .bet-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .max-bet-info {
            font-size: 0.9em;
            opacity: 0.9;
            text-align: center;
            margin-top: 10px;
        }
        
        .match-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-live {
            background: #ff4444;
            color: white;
            animation: pulse 1.5s infinite;
        }
        
        .status-pending {
            background: #ff9800;
            color: white;
        }
        
        .status-finished {
            background: #4CAF50;
            color: white;
        }
        
        .user-tokens {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .token-icon {
            font-size: 1.5em;
        }
        
        .token-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #FFD700;
        }
        
        .add-tokens-btn {
            margin-left: auto;
            padding: 8px 15px;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
            color: #FFD700;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .add-tokens-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }
        
        .bet-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .bet-history-table th {
            background: #4CAF50;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .bet-history-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .bet-history-table tr:hover {
            background: #f9f9f9;
        }
        
        .bet-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status-won {
            background: #e8f5e9;
            color: #2E7D32;
        }
        
        .status-lost {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-pending {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .shop-item-info {
            flex: 1;
        }
        
        .shop-item-price {
            color: #FFD700;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .buy-btn {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .buy-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .rules-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #ff9800;
            font-size: 0.9em;
        }
        
        .rules-info h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            padding: 14px 16px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
            min-width: fit-content;
        }
        
        .tab-btn.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            -webkit-text-size-adjust: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 18px 12px;
            text-align: center;
        }
        
        header h1 {
            font-size: 1.6em;
            margin-bottom: 6px;
            word-break: break-word;
            line-height: 1.3;
        }
        
        .header-subtitle {
            font-size: 0.95em;
            opacity: 0.9;
            padding: 0 8px;
            line-height: 1.4;
        }
        
        /* ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
    </style>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–≤–∏–¥–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="appContainer">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢ - –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫</h1>
            <div class="header-subtitle">–†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞ —Å –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏</div>
        </header>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('bets')">üé∞ –°—Ç–∞–≤–∫–∏</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üèÖ –¢—É—Ä–Ω–∏—Ä—ã</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content active" id="rating">
            <h2>üèÜ –¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div class="table-container">
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–û—á–∫–∏</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–ü–æ–±–µ–¥</th>
                            <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∏–≥—Ä–∞</th>
                            <th>–ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="ratingBody"></tbody>
                </table>
            </div>
            
            <!-- –ë–õ–û–ö –î–û–°–¢–ò–ñ–ï–ù–ò–ô –ò –ü–û–û–©–†–ï–ù–ò–ô -->
            <div class="achievements-container" id="achievementsContainer">
                <div class="achievements-header">
                    <div class="level-icon">üèÜ</div>
                    <h3>–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h3>
                </div>
                
                <div id="achievementsContent">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç -->
                    <p>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤...</p>
                </div>
                
                <div class="levels-info">
                    <h4>üéØ –£—Ä–æ–≤–Ω–∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</h4>
                    <p>–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π:</p>
                    <div class="levels-list">
                        <div class="level-badge">ü•â 1100 - –ù–∞—á–∏–Ω–∞—é—â–∏–π —á–µ–º–ø–∏–æ–Ω</div>
                        <div class="level-badge">ü•à 1300 - –û–ø—ã—Ç–Ω—ã–π –±–æ–µ—Ü</div>
                        <div class="level-badge">ü•á 1500 - –ú–∞—Å—Ç–µ—Ä —Å—Ç–æ–ª–∞</div>
                        <div class="level-badge">üëë 2000 - –õ–µ–≥–µ–Ω–¥–∞ –ª–∏–≥–∏</div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                        <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É –∏–≥—Ä–æ–∫–æ–≤. 
                        –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞.
                        <br>üéÅ <strong>–ë–æ–Ω—É—Å—ã:</strong> –ó–∞ –∫–∞–∂–¥—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—á–∫–∏:
                        ü•â +16 –æ—á–∫–æ–≤, ü•à +20 –æ—á–∫–æ–≤, ü•á +30 –æ—á–∫–æ–≤, üëë +50 –æ—á–∫–æ–≤
                    </p>
                </div>
            </div>
        </div>
        
        <!-- –ù–û–í–ê–Ø –í–ö–õ–ê–î–ö–ê: –°–¢–ê–í–ö–ò -->
        <div class="tab-content" id="bets">
            <h2>üé∞ –°–∏—Å—Ç–µ–º–∞ –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫</h2>
            
            <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="betting-panel" id="userBettingPanel">
                <h3>üë§ –í–∞—à –∏–≥—Ä–æ–≤–æ–π –∫–∞–±–∏–Ω–µ—Ç</h3>
                <div id="userCabinetInfo">
                    <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞–≤–∫–∞–º –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∫–∞–±–∏–Ω–µ—Ç</p>
                    <button class="bet-btn bet-btn-player1" onclick="openLoginModal()">üîê –í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç</button>
                </div>
            </div>
            
            <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫ -->
            <div class="betting-panel" id="activeBetsPanel">
                <h3>üî• –ê–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫</h3>
                <div id="activeBetsList">
                    <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ç—á–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Ç—á–µ–π...</p>
                </div>
            </div>
            
            <!-- –ú–∞–≥–∞–∑–∏–Ω -->
            <div class="betting-panel" id="shopPanel">
                <h3>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –ª–∏–≥–∏</h3>
                <div class="rules-info">
                    <h4>üìú –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
                    <p>üéØ <strong>–ñ–µ—Ç–æ–Ω—ã –ª–∏–≥–∏</strong> - —ç—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –∏–º–µ–µ—Ç –¥–µ–Ω–µ–∂–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏.</p>
                    <p>üí∞ <strong>–ü–æ–ª—É—á–µ–Ω–∏–µ –∂–µ—Ç–æ–Ω–æ–≤:</strong> +100 –∑–∞ –∫–∞–∂–¥—ã–π —Å—ã–≥—Ä–∞–Ω–Ω—ã–π –º–∞—Ç—á, +200 –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ —Ç—É—Ä–Ω–∏—Ä–µ.</p>
                    <p>‚ö†Ô∏è <strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞:</strong> –ù–µ –±–æ–ª–µ–µ 50% –æ—Ç –≤–∞—à–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞.</p>
                    <p>üèÜ <strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:</strong> –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ.</p>
                </div>
                
                <div id="shopItemsList">
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <h4>üö´ –û—Ç–º–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ —à—Ç—Ä–∞—Ñ–∞ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h4>
                            <p>–û—Ç–º–µ–Ω—è–µ—Ç –æ–¥–∏–Ω —à—Ç—Ä–∞—Ñ -60 –æ—á–∫–æ–≤ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 14+ –¥–Ω–µ–π</p>
                        </div>
                        <div class="shop-item-price">200 –∂–µ—Ç–æ–Ω–æ–≤</div>
                        <button class="buy-btn" onclick="buyShopItem('penalty_cancel')" disabled>–ö—É–ø–∏—Ç—å</button>
                    </div>
                    
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <h4>üìà +10 –æ—á–∫–æ–≤ —Ä–µ–π—Ç–∏–Ω–≥–∞</h4>
                            <p>–î–æ–±–∞–≤–ª—è–µ—Ç 10 –æ—á–∫–æ–≤ –∫ –≤–∞—à–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É</p>
                        </div>
                        <div class="shop-item-price">100 –∂–µ—Ç–æ–Ω–æ–≤</div>
                        <button class="buy-btn" onclick="buyShopItem('rating_boost')" disabled>–ö—É–ø–∏—Ç—å</button>
                    </div>
                </div>
            </div>
            
            <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ -->
            <div class="betting-panel" id="betHistoryPanel">
                <h3>üìä –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö —Å—Ç–∞–≤–æ–∫</h3>
                <div class="table-container">
                    <table class="bet-history-table" id="userBetHistory">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ú–∞—Ç—á</th>
                                <th>–°—Ç–∞–≤–∫–∞ –Ω–∞</th>
                                <th>–°—É–º–º–∞</th>
                                <th>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</th>
                                <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                                <th>–í—ã–∏–≥—Ä—ã—à</th>
                            </tr>
                        </thead>
                        <tbody id="betHistoryBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 20px;">
                                    –í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <div class="tab-content" id="matches">
            <h2>üéÆ –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π</h2>
            <div id="matchesContainer">
                <!-- –ú–∞—Ç—á–∏ –±—É–¥—É—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–Ω—è–º –∑–¥–µ—Å—å -->
            </div>
            
            <!-- –ë–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞ -->
            <div class="admin-controls" id="matchesAdminControls">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –º–∞—Ç—á–∞:</label>
                            <input type="date" id="matchDate">
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 1:</label>
                            <select id="player1"></select>
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 2:</label>
                            <select id="player2"></select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</label>
                            <select id="winner">
                                <option value="player1">–ò–≥—Ä–æ–∫ 1</option>
                                <option value="player2">–ò–≥—Ä–æ–∫ 2</option>
                                <option value="draw">–ù–∏—á—å—è</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–°—á–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="score" placeholder="3:2">
                        </div>
                        <button class="add-btn action-btn" onclick="addMatch()" style="margin-top: 20px; width: 100%;">
                            ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... -->
        
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç -->
    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <h3 style="margin-bottom: 20px;">üîê –í—Ö–æ–¥ –≤ –∏–≥—Ä–æ–≤–æ–π –∫–∞–±–∏–Ω–µ—Ç</h3>
            
            <div id="loginForm">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="loginUsername" placeholder="–í–∞—à –ª–æ–≥–∏–Ω" style="width: 100%; padding: 10px;">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="loginPassword" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" style="width: 100%; padding: 10px;">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="bet-btn bet-btn-player1" onclick="loginToCabinet()" style="flex: 1;">–í–æ–π—Ç–∏</button>
                    <button class="bet-btn bet-btn-player2" onclick="closeLoginModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                </div>
                <p style="margin-top: 15px; font-size: 0.9em; color: #666; text-align: center;">
                    –ù–µ—Ç –∫–∞–±–∏–Ω–µ—Ç–∞? –û–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                </p>
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    // ============================================
    const SUPABASE_URL = 'https://bqycjfcjtdawyrysgrbw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWNqZmNqdGRhd3lyeXNncmJ3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjYwMTk3MCwiZXhwIjoyMDgyMTc3OTcwfQ.lHA_79fw8PSj9ZHMExBpSEIpkonkCYOni7HniGGqadY';
    
    let supabaseClient = null;
    let isSupabaseInitialized = false;
    
    // ============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï (–¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ)
    // ============================================
    let players = {};
    let matches = [];
    let penaltyLog = [];
    let tournaments = [];
    let tournamentMatches = [];
    let tournamentPhotos = [];
    let isAdmin = false;
    const ADMIN_PASSWORD = "admin123";
    
    // –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –°–¢–ê–í–û–ö
    let playerCabinet = null;
    let betMatches = [];
    let userBets = [];
    
    // ============================================
    // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–¢–ê–í–û–ö
    // ============================================
    
    // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
    function openLoginModal() {
        document.getElementById('loginModal').style.display = 'flex';
    }
    
    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
    function closeLoginModal() {
        document.getElementById('loginModal').style.display = 'none';
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
    }
    
    // –í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç
    async function loginToCabinet() {
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value.trim();
        
        if (!username || !password) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!', 'error');
            return;
        }
        
        try {
            // –ò—â–µ–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
            const { data, error } = await supabaseClient
                .from('player_cabinets')
                .select('*')
                .eq('login', username)
                .single();
            
            if (error) {
                if (error.code === 'PGRST116') {
                    showNotification('–ö–∞–±–∏–Ω–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω! –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.', 'error');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
                }
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ!)
            if (data.password !== password) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!', 'error');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
            await supabaseClient
                .from('player_cabinets')
                .update({ last_login: new Date().toISOString() })
                .eq('id', data.id);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç–∞
            playerCabinet = data;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateCabinetDisplay();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await loadUserBets();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeLoginModal();
            
            showNotification(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${data.player_name}!`, 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç', 'error');
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞
    function updateCabinetDisplay() {
        if (!playerCabinet) return;
        
        const panel = document.getElementById('userCabinetInfo');
        panel.innerHTML = `
            <div class="user-tokens">
                <div class="token-icon">üí∞</div>
                <div>
                    <div style="font-weight: bold;">${playerCabinet.player_name}</div>
                    <div class="token-amount">${playerCabinet.tokens} –∂–µ—Ç–æ–Ω–æ–≤</div>
                </div>
                <div style="margin-left: auto; display: flex; flex-direction: column; gap: 5px; font-size: 0.9em;">
                    <div>–°—Ç–∞–≤–æ–∫ —Å–¥–µ–ª–∞–Ω–æ: ${playerCabinet.bets_made}</div>
                    <div>–°—Ç–∞–≤–æ–∫ –≤—ã–∏–≥—Ä–∞–Ω–æ: ${playerCabinet.bets_won}</div>
                    <div>–í—Å–µ–≥–æ –≤—ã–∏–≥—Ä–∞–Ω–æ: ${playerCabinet.total_won}</div>
                </div>
                ${isAdmin ? `
                    <button class="add-tokens-btn" onclick="openAddTokensModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∂–µ—Ç–æ–Ω—ã</button>
                ` : ''}
            </div>
            <p style="margin-top: 10px; font-size: 0.9em;">
                üéØ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–∞—Ç—á–∞ –∏ —Å—Ç–∞–≤–∫–∏
            </p>
        `;
    }
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫
    async function loadBetMatches() {
        if (!supabaseClient) return;
        
        try {
            const { data, error } = await supabaseClient
                .from('bet_matches')
                .select('*')
                .order('date', { ascending: true });
            
            if (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫:', error);
                return;
            }
            
            betMatches = data || [];
            updateBetMatchesDisplay();
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫:', error);
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫
    function updateBetMatchesDisplay() {
        const container = document.getElementById('activeBetsList');
        if (!container) return;
        
        if (betMatches.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫</p>
                    ${isAdmin ? `
                        <button class="bet-btn bet-btn-player1" onclick="createBetMatch()" style="margin-top: 10px;">
                            üèì –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫
                        </button>
                    ` : ''}
                </div>
            `;
            return;
        }
        
        let html = '';
        
        betMatches.forEach(match => {
            const isLive = match.status === 'live';
            const isFinished = match.status === 'finished';
            const player1 = players[match.player1];
            const player2 = players[match.player2];
            
            if (!player1 || !player2) return;
            
            const odds = match.odds || calculateOdds(player1.rating, player2.rating);
            const userMaxBet = playerCabinet ? Math.floor(playerCabinet.tokens * 0.5) : 0;
            
            html += `
                <div class="bet-match-card ${isLive ? 'live' : ''}">
                    <div class="match-info">
                        <div class="match-players">
                            <div class="player-bet-info">
                                <img src="${player1.avatar}" onerror="this.src='https://i.pravatar.cc/150?img=3'}">
                                <div style="font-weight: bold;">${match.player1}</div>
                                <div style="font-size: 0.9em;">–†–µ–π—Ç–∏–Ω–≥: ${player1.rating}</div>
                            </div>
                            
                            <div class="vs-text">VS</div>
                            
                            <div class="player-bet-info">
                                <img src="${player2.avatar}" onerror="this.src='https://i.pravatar.cc/150?img=3'}">
                                <div style="font-weight: bold;">${match.player2}</div>
                                <div style="font-size: 0.9em;">–†–µ–π—Ç–∏–Ω–≥: ${player2.rating}</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; gap: 5px; text-align: center;">
                            <div class="match-status ${isLive ? 'status-live' : isFinished ? 'status-finished' : 'status-pending'}">
                                ${isLive ? 'LIVE' : isFinished ? '–ó–ê–í–ï–†–®–ï–ù' : '–û–ñ–ò–î–ê–ï–¢–°–Ø'}
                            </div>
                            <div style="font-size: 0.9em;">
                                ${new Date(match.date).toLocaleDateString('ru-RU')}
                            </div>
                            ${match.description ? `
                                <div style="font-size: 0.85em; opacity: 0.9; max-width: 200px;">
                                    ${match.description}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; margin: 15px 0; gap: 10px;">
                        <div class="bet-odds ${odds.favorite === 'player1' ? 'winner' : ''}">
                            <div>${match.player1}</div>
                            <div style="color: #FFD700;">x${odds.player1.toFixed(2)}</div>
                        </div>
                        
                        <div class="bet-odds ${odds.favorite === 'player2' ? 'winner' : ''}">
                            <div>${match.player2}</div>
                            <div style="color: #FFD700;">x${odds.player2.toFixed(2)}</div>
                        </div>
                    </div>
                    
                    ${!isFinished && playerCabinet ? `
                        <div class="bet-form">
                            <div class="bet-input-group">
                                <input type="number" 
                                       id="betAmount_${match.id}" 
                                       placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏" 
                                       min="1" 
                                       max="${userMaxBet}"
                                       value="10">
                                <span style="white-space: nowrap;">–º–∞–∫—Å: ${userMaxBet}</span>
                            </div>
                            
                            <div class="bet-buttons">
                                <button class="bet-btn bet-btn-player1" 
                                        onclick="placeBet('${match.id}', 'player1', ${odds.player1})"
                                        ${playerCabinet.tokens < 1 ? 'disabled' : ''}>
                                    –°—Ç–∞–≤–∫–∞ –Ω–∞ ${match.player1}
                                </button>
                                <button class="bet-btn bet-btn-player2" 
                                        onclick="placeBet('${match.id}', 'player2', ${odds.player2})"
                                        ${playerCabinet.tokens < 1 ? 'disabled' : ''}>
                                    –°—Ç–∞–≤–∫–∞ –Ω–∞ ${match.player2}
                                </button>
                            </div>
                            
                            <div class="max-bet-info">
                                üí∞ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 50% –æ—Ç –±–∞–ª–∞–Ω—Å–∞ (${userMaxBet} –∂–µ—Ç–æ–Ω–æ–≤)
                            </div>
                        </div>
                    ` : isFinished ? `
                        <div style="text-align: center; padding: 10px; background: rgba(76, 175, 80, 0.2); border-radius: 8px;">
                            üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <strong>${match.result}</strong>
                            ${match.total_bets > 0 ? `| –°—Ç–∞–≤–æ–∫: ${match.total_bets} | –°—É–º–º–∞: ${match.total_amount}` : ''}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            ‚è≥ –í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                        </div>
                    `}
                    
                    ${isAdmin && !isFinished ? `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <div style="display: flex; gap: 10px; justify-content: center;">
                                <button class="bet-btn" style="background: #ff9800;" onclick="updateMatchStatus('${match.id}', 'live')">
                                    üöÄ –ù–∞—á–∞—Ç—å –º–∞—Ç—á
                                </button>
                                <button class="bet-btn" style="background: #4CAF50;" onclick="setMatchResult('${match.id}')">
                                    üèÜ –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∞—Ç—á
                                </button>
                                <button class="bet-btn" style="background: #f44336;" onclick="deleteBetMatch('${match.id}')">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
    function calculateOdds(rating1, rating2) {
        const diff = Math.abs(rating1 - rating2);
        
        // –ë–∞–∑–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
        let favoriteOdds, underdogOdds;
        
        if (diff < 100) {
            // –ú–∞–ª–∞—è —Ä–∞–∑–Ω–∏—Ü–∞
            favoriteOdds = 1.5;
            underdogOdds = 2.5;
        } else if (diff < 200) {
            // –°—Ä–µ–¥–Ω—è—è —Ä–∞–∑–Ω–∏—Ü–∞
            favoriteOdds = 1.3;
            underdogOdds = 3.0;
        } else if (diff < 300) {
            // –ë–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞
            favoriteOdds = 1.2;
            underdogOdds = 4.0;
        } else {
            // –û—á–µ–Ω—å –±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞
            favoriteOdds = 1.1;
            underdogOdds = 6.0;
        }
        
        const favorite = rating1 > rating2 ? 'player1' : 'player2';
        
        return {
            player1: rating1 > rating2 ? favoriteOdds : underdogOdds,
            player2: rating2 > rating1 ? favoriteOdds : underdogOdds,
            favorite: favorite
        };
    }
    
    // –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫ (–∞–¥–º–∏–Ω)
    async function createBetMatch() {
        if (!isAdmin) {
            showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫', 'error');
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
        const playerNames = Object.keys(players);
        if (playerNames.length < 2) {
            showNotification('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞', 'error');
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ
        const dialogDiv = document.createElement('div');
        dialogDiv.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        `;
        
        const dialogContent = document.createElement('div');
        dialogContent.style.cssText = `
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        `;
        
        dialogContent.innerHTML = `
            <h3 style="margin-bottom: 20px;">üèì –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫</h3>
            
            <div class="form-group">
                <label>–ò–≥—Ä–æ–∫ 1:</label>
                <select id="betPlayer1" style="width: 100%; padding: 10px; margin-bottom: 15px;">
                    ${playerNames.map(p => `<option value="${p}">${p} (${players[p].rating})</option>`).join('')}
                </select>
            </div>
            
            <div class="form-group">
                <label>–ò–≥—Ä–æ–∫ 2:</label>
                <select id="betPlayer2" style="width: 100%; padding: 10px; margin-bottom: 15px;">
                    ${playerNames.map(p => `<option value="${p}">${p} (${players[p].rating})</option>`).join('')}
                </select>
            </div>
            
            <div class="form-group">
                <label>–î–∞—Ç–∞ –º–∞—Ç—á–∞:</label>
                <input type="datetime-local" id="betMatchDate" style="width: 100%; padding: 10px; margin-bottom: 15px;">
            </div>
            
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <input type="text" id="betMatchDescription" placeholder="–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç—á, –§–∏–Ω–∞–ª —Ç—É—Ä–Ω–∏—Ä–∞ –∏ —Ç.–¥." style="width: 100%; padding: 10px; margin-bottom: 20px;">
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button id="createBetMatchBtn" style="flex: 1; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    –°–æ–∑–¥–∞—Ç—å
                </button>
                <button id="cancelBetMatchBtn" style="flex: 1; padding: 12px; background: #f5f5f5; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        `;
        
        dialogDiv.appendChild(dialogContent);
        document.body.appendChild(dialogDiv);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∑–∞–≤—Ç—Ä–∞)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('betMatchDate').value = tomorrow.toISOString().slice(0, 16);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('createBetMatchBtn').onclick = async () => {
            const player1 = document.getElementById('betPlayer1').value;
            const player2 = document.getElementById('betPlayer2').value;
            const date = document.getElementById('betMatchDate').value;
            const description = document.getElementById('betMatchDescription').value;
            
            if (!player1 || !player2 || !date) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (player1 === player2) {
                showNotification('–ò–≥—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏', 'error');
                return;
            }
            
            try {
                const odds = calculateOdds(players[player1].rating, players[player2].rating);
                
                const newMatch = {
                    id: Date.now().toString(),
                    player1: player1,
                    player2: player2,
                    player1_rating: players[player1].rating,
                    player2_rating: players[player2].rating,
                    description: description || null,
                    date: new Date(date).toISOString(),
                    status: 'pending',
                    odds: odds,
                    result: null,
                    total_bets: 0,
                    total_amount: 0,
                    bets: [],
                    created_at: new Date().toISOString()
                };
                
                const { error } = await supabaseClient
                    .from('bet_matches')
                    .insert(newMatch);
                
                if (error) throw error;
                
                betMatches.push(newMatch);
                updateBetMatchesDisplay();
                
                document.body.removeChild(dialogDiv);
                showNotification('‚úÖ –ú–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫ —Å–æ–∑–¥–∞–Ω!', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞', 'error');
            }
        };
        
        document.getElementById('cancelBetMatchBtn').onclick = () => {
            document.body.removeChild(dialogDiv);
        };
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –¥–∏–∞–ª–æ–≥–∞
        dialogDiv.addEventListener('click', (e) => {
            if (e.target === dialogDiv) {
                document.body.removeChild(dialogDiv);
            }
        });
    }
    
    // –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
    async function placeBet(matchId, betOn, odds) {
        if (!playerCabinet) {
            showNotification('–í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫', 'error');
            return;
        }
        
        const match = betMatches.find(m => m.id === matchId);
        if (!match) {
            showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            return;
        }
        
        if (match.status !== 'pending' && match.status !== 'live') {
            showNotification('–°—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á –∑–∞–∫—Ä—ã—Ç—ã', 'error');
            return;
        }
        
        const betAmountInput = document.getElementById(`betAmount_${matchId}`);
        const betAmount = parseInt(betAmountInput.value);
        
        if (isNaN(betAmount) || betAmount < 1) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏', 'error');
            return;
        }
        
        const maxBet = Math.floor(playerCabinet.tokens * 0.5);
        if (betAmount > maxBet) {
            showNotification(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: ${maxBet} –∂–µ—Ç–æ–Ω–æ–≤ (50% –æ—Ç –±–∞–ª–∞–Ω—Å–∞)`, 'error');
            return;
        }
        
        if (betAmount > playerCabinet.tokens) {
            showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∂–µ—Ç–æ–Ω–æ–≤', 'error');
            return;
        }
        
        try {
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ —Å—Ç–∞–≤–∫–µ
            const betId = `${matchId}_${Date.now()}`;
            const potentialWin = Math.floor(betAmount * odds);
            
            const betRecord = {
                id: betId,
                match_id: matchId,
                player_login: playerCabinet.login,
                player_name: playerCabinet.player_name,
                bet_on: betOn,
                amount: betAmount,
                odds: odds,
                potential_win: potentialWin,
                status: 'pending',
                placed_at: new Date().toISOString()
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞–≤–∫—É –≤ –±–∞–∑—É
            const { error: betError } = await supabaseClient
                .from('bet_history')
                .insert(betRecord);
            
            if (betError) throw betError;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á
            const updatedBets = [...(match.bets || []), betRecord];
            const { error: matchError } = await supabaseClient
                .from('bet_matches')
                .update({
                    bets: updatedBets,
                    total_bets: (match.total_bets || 0) + 1,
                    total_amount: (match.total_amount || 0) + betAmount
                })
                .eq('id', matchId);
            
            if (matchError) throw matchError;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
            const newTokens = playerCabinet.tokens - betAmount;
            const { error: cabinetError } = await supabaseClient
                .from('player_cabinets')
                .update({
                    tokens: newTokens,
                    bets_made: (playerCabinet.bets_made || 0) + 1,
                    bet_history: [...(playerCabinet.bet_history || []), betRecord]
                })
                .eq('id', playerCabinet.id);
            
            if (cabinetError) throw cabinetError;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            playerCabinet.tokens = newTokens;
            playerCabinet.bets_made += 1;
            playerCabinet.bet_history.push(betRecord);
            
            match.bets = updatedBets;
            match.total_bets += 1;
            match.total_amount += betAmount;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateCabinetDisplay();
            updateBetMatchesDisplay();
            await loadUserBets();
            
            showNotification(`‚úÖ –°—Ç–∞–≤–∫–∞ –Ω–∞ ${betAmount} –∂–µ—Ç–æ–Ω–æ–≤ –ø—Ä–∏–Ω—è—Ç–∞! –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: ${potentialWin}`, 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏:', error);
            showNotification('–û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏', 'error');
        }
    }
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async function loadUserBets() {
        if (!playerCabinet || !supabaseClient) return;
        
        try {
            const { data, error } = await supabaseClient
                .from('bet_history')
                .select('*')
                .eq('player_login', playerCabinet.login)
                .order('placed_at', { ascending: false });
            
            if (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫:', error);
                return;
            }
            
            userBets = data || [];
            updateBetHistoryDisplay();
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫:', error);
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫
    function updateBetHistoryDisplay() {
        const tbody = document.getElementById('betHistoryBody');
        if (!tbody) return;
        
        if (!playerCabinet) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 20px;">
                        –í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫
                    </td>
                </tr>
            `;
            return;
        }
        
        if (userBets.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 20px;">
                        –í—ã –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–æ–∫
                    </td>
                </tr>
            `;
            return;
        }
        
        let html = '';
        
        userBets.forEach(bet => {
            const match = betMatches.find(m => m.id === bet.match_id);
            let statusClass = '';
            let statusText = '';
            
            switch(bet.status) {
                case 'won':
                    statusClass = 'status-won';
                    statusText = '–í—ã–∏–≥—Ä–∞–Ω–∞';
                    break;
                case 'lost':
                    statusClass = 'status-lost';
                    statusText = '–ü—Ä–æ–∏–≥—Ä–∞–Ω–∞';
                    break;
                default:
                    statusClass = 'status-pending';
                    statusText = '–û–∂–∏–¥–∞–µ—Ç';
            }
            
            html += `
                <tr>
                    <td>${new Date(bet.placed_at).toLocaleDateString('ru-RU')}</td>
                    <td>${match ? `${match.player1} vs ${match.player2}` : '–ú–∞—Ç—á —É–¥–∞–ª–µ–Ω'}</td>
                    <td><strong>${bet.bet_on}</strong></td>
                    <td>${bet.amount} –∂–µ—Ç–æ–Ω–æ–≤</td>
                    <td>x${bet.odds.toFixed(2)}</td>
                    <td><span class="bet-status ${statusClass}">${statusText}</span></td>
                    <td>${bet.win_amount ? bet.win_amount + ' –∂–µ—Ç–æ–Ω–æ–≤' : '-'}</td>
                </tr>
            `;
        });
        
        tbody.innerHTML = html;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω)
    async function updateMatchStatus(matchId, status) {
        if (!isAdmin) {
            showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞', 'error');
            return;
        }
        
        try {
            const { error } = await supabaseClient
                .from('bet_matches')
                .update({ status: status })
                .eq('id', matchId);
            
            if (error) throw error;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const match = betMatches.find(m => m.id === matchId);
            if (match) {
                match.status = status;
            }
            
            updateBetMatchesDisplay();
            showNotification(`‚úÖ –°—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω: ${status}`, 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –º–∞—Ç—á–∞', 'error');
        }
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω)
    async function setMatchResult(matchId) {
        if (!isAdmin) {
            showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã', 'error');
            return;
        }
        
        const match = betMatches.find(m => m.id === matchId);
        if (!match) {
            showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            return;
        }
        
        const result = prompt(`–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ ${match.player1} vs ${match.player2}:\n1 - ${match.player1}\n2 - ${match.player2}\nX - –ù–∏—á—å—è\n–û—Ç–º–µ–Ω–∞`);
        
        if (!result) return;
        
        let winner;
        if (result === '1') winner = match.player1;
        else if (result === '2') winner = match.player2;
        else if (result.toLowerCase() === 'x') winner = 'draw';
        else {
            showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç', 'error');
            return;
        }
        
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞
            const { error: matchError } = await supabaseClient
                .from('bet_matches')
                .update({ 
                    status: 'finished',
                    result: winner
                })
                .eq('id', matchId);
            
            if (matchError) throw matchError;
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á
            const { data: bets, error: betsError } = await supabaseClient
                .from('bet_history')
                .select('*')
                .eq('match_id', matchId)
                .eq('status', 'pending');
            
            if (betsError) throw betsError;
            
            for (const bet of bets) {
                let betStatus = 'lost';
                let winAmount = 0;
                
                if (winner === 'draw') {
                    betStatus = 'draw';
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–≤–∫—É –ø—Ä–∏ –Ω–∏—á—å–µ
                    winAmount = bet.amount;
                } else if (bet.bet_on === winner) {
                    betStatus = 'won';
                    winAmount = bet.potential_win;
                    
                    // –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à –∏–≥—Ä–æ–∫—É
                    const { data: cabinet, error: cabinetError } = await supabaseClient
                        .from('player_cabinets')
                        .select('*')
                        .eq('login', bet.player_login)
                        .single();
                    
                    if (!cabinetError && cabinet) {
                        const newTokens = cabinet.tokens + winAmount;
                        const newTotalWon = (cabinet.total_won || 0) + winAmount;
                        const newBetsWon = (cabinet.bets_won || 0) + 1;
                        
                        await supabaseClient
                            .from('player_cabinets')
                            .update({
                                tokens: newTokens,
                                total_won: newTotalWon,
                                bets_won: newBetsWon
                            })
                            .eq('id', cabinet.id);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏
                await supabaseClient
                    .from('bet_history')
                    .update({
                        status: betStatus,
                        result: winner,
                        win_amount: winAmount
                    })
                    .eq('id', bet.id);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            match.status = 'finished';
            match.result = winner;
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª –≤ –∫–∞–±–∏–Ω–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
            if (playerCabinet) {
                await loadUserBets();
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç–∞
                const { data: cabinetData } = await supabaseClient
                    .from('player_cabinets')
                    .select('*')
                    .eq('login', playerCabinet.login)
                    .single();
                
                if (cabinetData) {
                    playerCabinet = cabinetData;
                    updateCabinetDisplay();
                }
            }
            
            updateBetMatchesDisplay();
            showNotification(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${winner}`, 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–∞—Ç—á–∞', 'error');
        }
    }
    
    // –£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫ (–∞–¥–º–∏–Ω)
    async function deleteBetMatch(matchId) {
        if (!isAdmin) {
            showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –º–∞—Ç—á–∏', 'error');
            return;
        }
        
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á? –í—Å–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ –Ω–µ–≥–æ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
            return;
        }
        
        try {
            // –£–¥–∞–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞–≤–æ–∫ –¥–ª—è —ç—Ç–æ–≥–æ –º–∞—Ç—á–∞
            await supabaseClient
                .from('bet_history')
                .delete()
                .eq('match_id', matchId);
            
            // –£–¥–∞–ª—è–µ–º –º–∞—Ç—á
            const { error } = await supabaseClient
                .from('bet_matches')
                .delete()
                .eq('id', matchId);
            
            if (error) throw error;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            betMatches = betMatches.filter(m => m.id !== matchId);
            userBets = userBets.filter(b => b.match_id !== matchId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateBetMatchesDisplay();
            updateBetHistoryDisplay();
            
            showNotification('‚úÖ –ú–∞—Ç—á —É–¥–∞–ª–µ–Ω', 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç—á–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç—á–∞', 'error');
        }
    }
    
    // –ö—É–ø–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω–µ
    async function buyShopItem(itemType) {
        if (!playerCabinet) {
            showNotification('–í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–æ–∫', 'error');
            return;
        }
        
        let price, action;
        
        switch(itemType) {
            case 'penalty_cancel':
                price = 200;
                action = async () => {
                    // –û—Ç–º–µ–Ω–∞ —à—Ç—Ä–∞—Ñ–∞ - –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —à—Ç—Ä–∞—Ñ –∏–≥—Ä–æ–∫–∞
                    const playerName = playerCabinet.player_name;
                    const player = players[playerName];
                    
                    if (player && player.penalties > 0) {
                        // –î–æ–±–∞–≤–ª—è–µ–º 60 –æ—á–∫–æ–≤ (–æ—Ç–º–µ–Ω–∞ —à—Ç—Ä–∞—Ñ–∞)
                        player.rating += 60;
                        player.penalties = Math.max(0, player.penalties - 60);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        await savePlayerToSupabase(playerName, player);
                        showNotification('‚úÖ –®—Ç—Ä–∞—Ñ –æ—Ç–º–µ–Ω–µ–Ω! +60 –æ—á–∫–æ–≤ –∫ —Ä–µ–π—Ç–∏–Ω–≥—É', 'success');
                    } else {
                        showNotification('–ù–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ –¥–ª—è –æ—Ç–º–µ–Ω—ã', 'info');
                        return false;
                    }
                    return true;
                };
                break;
                
            case 'rating_boost':
                price = 100;
                action = async () => {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
                    const playerName = playerCabinet.player_name;
                    const player = players[playerName];
                    
                    if (player) {
                        player.rating += 10;
                        await savePlayerToSupabase(playerName, player);
                        showNotification('‚úÖ +10 –æ—á–∫–æ–≤ –∫ —Ä–µ–π—Ç–∏–Ω–≥—É!', 'success');
                    }
                    return true;
                };
                break;
                
            default:
                showNotification('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç', 'error');
                return;
        }
        
        if (playerCabinet.tokens < price) {
            showNotification(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∂–µ—Ç–æ–Ω–æ–≤. –ù—É–∂–Ω–æ: ${price}`, 'error');
            return;
        }
        
        try {
            // –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
            const success = await action();
            if (!success) return;
            
            // –°–ø–∏—Å–∞–Ω–∏–µ –∂–µ—Ç–æ–Ω–æ–≤
            const newTokens = playerCabinet.tokens - price;
            const { error } = await supabaseClient
                .from('player_cabinets')
                .update({
                    tokens: newTokens,
                    shop_purchases: [...(playerCabinet.shop_purchases || []), {
                        item: itemType,
                        price: price,
                        date: new Date().toISOString()
                    }]
                })
                .eq('id', playerCabinet.id);
            
            if (error) throw error;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            playerCabinet.tokens = newTokens;
            playerCabinet.shop_purchases.push({
                item: itemType,
                price: price,
                date: new Date().toISOString()
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateCabinetDisplay();
            updateAllDisplays();
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞', 'error');
        }
    }
    
    // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤ (–∞–¥–º–∏–Ω)
    function openAddTokensModal() {
        if (!isAdmin) return;
        
        const dialogDiv = document.createElement('div');
        dialogDiv.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        `;
        
        const dialogContent = document.createElement('div');
        dialogContent.style.cssText = `
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 400px;
            width: 100%;
        `;
        
        dialogContent.innerHTML = `
            <h3 style="margin-bottom: 20px;">üí∞ –î–æ–±–∞–≤–∏—Ç—å –∂–µ—Ç–æ–Ω—ã –∏–≥—Ä–æ–∫—É</h3>
            
            <div class="form-group">
                <label>–ò–≥—Ä–æ–∫:</label>
                <select id="addTokensPlayer" style="width: 100%; padding: 10px; margin-bottom: 15px;">
                    ${Object.keys(players).map(p => `<option value="${p}">${p}</option>`).join('')}
                </select>
            </div>
            
            <div class="form-group">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ—Ç–æ–Ω–æ–≤:</label>
                <input type="number" id="addTokensAmount" value="100" min="1" max="10000" style="width: 100%; padding: 10px; margin-bottom: 20px;">
            </div>
            
            <div class="form-group">
                <label>–ü—Ä–∏—á–∏–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <input type="text" id="addTokensReason" placeholder="–ó–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ —Ç—É—Ä–Ω–∏—Ä–µ –∏ —Ç.–¥." style="width: 100%; padding: 10px; margin-bottom: 20px;">
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button id="confirmAddTokensBtn" style="flex: 1; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
                <button id="cancelAddTokensBtn" style="flex: 1; padding: 12px; background: #f5f5f5; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        `;
        
        dialogDiv.appendChild(dialogContent);
        document.body.appendChild(dialogDiv);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('confirmAddTokensBtn').onclick = async () => {
            const playerName = document.getElementById('addTokensPlayer').value;
            const amount = parseInt(document.getElementById('addTokensAmount').value);
            const reason = document.getElementById('addTokensReason').value;
            
            if (isNaN(amount) || amount < 1) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ—Ç–æ–Ω–æ–≤', 'error');
                return;
            }
            
            try {
                // –ò—â–µ–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
                const { data: cabinet, error } = await supabaseClient
                    .from('player_cabinets')
                    .select('*')
                    .eq('player_name', playerName)
                    .single();
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        // –ö–∞–±–∏–Ω–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
                        await createPlayerCabinet(playerName);
                        // –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–ª—É—á–∞–µ–º –∫–∞–±–∏–Ω–µ—Ç
                        const { data: newCabinet } = await supabaseClient
                            .from('player_cabinets')
                            .select('*')
                            .eq('player_name', playerName)
                            .single();
                        
                        await addTokensToCabinet(newCabinet, amount, reason);
                    } else {
                        throw error;
                    }
                } else {
                    await addTokensToCabinet(cabinet, amount, reason);
                }
                
                document.body.removeChild(dialogDiv);
                showNotification(`‚úÖ ${amount} –∂–µ—Ç–æ–Ω–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∏–≥—Ä–æ–∫—É ${playerName}`, 'success');
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
                if (playerCabinet && playerCabinet.player_name === playerName) {
                    const { data: updatedCabinet } = await supabaseClient
                        .from('player_cabinets')
                        .select('*')
                        .eq('player_name', playerName)
                        .single();
                    
                    if (updatedCabinet) {
                        playerCabinet = updatedCabinet;
                        updateCabinetDisplay();
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤', 'error');
            }
        };
        
        document.getElementById('cancelAddTokensBtn').onclick = () => {
            document.body.removeChild(dialogDiv);
        };
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –¥–∏–∞–ª–æ–≥–∞
        dialogDiv.addEventListener('click', (e) => {
            if (e.target === dialogDiv) {
                document.body.removeChild(dialogDiv);
            }
        });
    }
    
    // –°–æ–∑–¥–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
    async function createPlayerCabinet(playerName) {
        const player = players[playerName];
        if (!player) {
            throw new Error('–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å
        const login = playerName.toLowerCase().replace(/\s+/g, '_') + '_' + Math.random().toString(36).substr(2, 5);
        const password = Math.random().toString(36).substr(2, 8);
        
        const newCabinet = {
            player_name: playerName,
            login: login,
            password: password,
            tokens: 100, // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª
            bets_made: 0,
            bets_won: 0,
            total_won: 0,
            bet_history: [],
            shop_purchases: [],
            join_date: new Date().toISOString(),
            last_login: new Date().toISOString()
        };
        
        const { error } = await supabaseClient
            .from('player_cabinets')
            .insert(newCabinet);
        
        if (error) throw error;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ —É–≤–µ–¥–æ–º–∏—Ç—å –∏–≥—Ä–æ–∫–∞)
        console.log(`–°–æ–∑–¥–∞–Ω –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è ${playerName}: –ª–æ–≥–∏–Ω=${login}, –ø–∞—Ä–æ–ª—å=${password}`);
        
        return newCabinet;
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å –∂–µ—Ç–æ–Ω—ã –≤ –∫–∞–±–∏–Ω–µ—Ç
    async function addTokensToCabinet(cabinet, amount, reason) {
        const newTokens = (cabinet.tokens || 0) + amount;
        
        const { error } = await supabaseClient
            .from('player_cabinets')
            .update({
                tokens: newTokens,
                updated_at: new Date().toISOString()
            })
            .eq('id', cabinet.id);
        
        if (error) throw error;
    }
    
    // ============================================
    // –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –°–¢–ê–í–û–ö
    // ============================================
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
    async function loadAllData() {
        if (!supabaseClient) {
            console.log('üîÑ Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–±—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å...');
            await initSupabase();
            return;
        }
        
        try {
            console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞—é –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase...');
            updateSupabaseStatus('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
            document.getElementById('refreshBtn').disabled = true;
            document.getElementById('refreshBtn').classList.add('loading');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤
            const { data: playersData, error: playersError } = await supabaseClient
                .from('players')
                .select('*')
                .order('rating', { ascending: false });
            
            if (playersError) {
                if (playersError.message.includes('does not exist')) {
                    console.log('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ players –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    updateSupabaseStatus('‚ö†Ô∏è –ù–µ—Ç —Ç–∞–±–ª–∏—Ü');
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:', playersError);
                    updateSupabaseStatus('‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö');
                }
            } else if (playersData) {
                const newPlayers = {};
                playersData.forEach(player => {
                    newPlayers[player.name] = {
                        id: player.id,
                        rating: player.rating || 1000,
                        matches: player.matches || 0,
                        wins: player.wins || 0,
                        lastGame: player.last_game ? new Date(player.last_game) : null,
                        joinDate: player.join_date ? new Date(player.join_date) : new Date(),
                        penalties: player.penalties || 0,
                        avatar: player.avatar || `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`,
                        achievement_bonuses: player.achievement_bonuses || {},
                        created_at: player.created_at
                    };
                });
                players = newPlayers;
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${playersData.length} –∏–≥—Ä–æ–∫–æ–≤`);
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç—á–∏
            const { data: matchesData, error: matchesError } = await supabaseClient
                .from('matches')
                .select('*')
                .order('date', { ascending: false });
            
            if (matchesError && !matchesError.message.includes('does not exist')) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π:', matchesError);
            } else if (matchesData) {
                matches = matchesData.map(match => ({
                    id: match.id,
                    date: new Date(match.date),
                    player1: match.player1,
                    player2: match.player2,
                    winner: match.winner,
                    change1: match.change1 || 0,
                    change2: match.change2 || 0,
                    score: match.score || ''
                }));
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${matchesData.length} –º–∞—Ç—á–µ–π`);
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —à—Ç—Ä–∞—Ñ—ã
            const { data: penaltiesData, error: penaltiesError } = await supabaseClient
                .from('penalties')
                .select('*')
                .order('date', { ascending: false });
            
            if (penaltiesError && !penaltiesError.message.includes('does not exist')) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ç—Ä–∞—Ñ–æ–≤:', penaltiesError);
            } else if (penaltiesData) {
                penaltyLog = penaltiesData.map(penalty => ({
                    id: penalty.id,
                    date: new Date(penalty.date),
                    player: penalty.player,
                    amount: penalty.amount || 0,
                    daysInactive: penalty.days_inactive || 0,
                    manual: penalty.manual || false
                }));
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${penaltiesData.length} —à—Ç—Ä–∞—Ñ–æ–≤`);
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
            await loadTournaments();
            
            // –ó–ê–ì–†–£–ñ–ê–ï–ú –î–ê–ù–ù–´–ï –î–õ–Ø –°–¢–ê–í–û–ö
            await loadBetMatches();
            
            console.log('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Supabase');
            updateSupabaseStatus('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            updateSupabaseTime();
            
            updateAllDisplays();
            
            if (isAdmin) {
                setTimeout(applyAchievementBonuses, 1000);
            }
            
        } catch (error) {
            console.error('‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            updateSupabaseStatus('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
        } finally {
            document.getElementById('refreshBtn').disabled = false;
            document.getElementById('refreshBtn').classList.remove('loading');
        }
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
    async function addPlayer() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏–≥—Ä–æ–∫–æ–≤!', 'error');
            return;
        }
        
        const name = document.getElementById('newPlayerName').value.trim();
        const avatar = document.getElementById('newPlayerAvatar').value.trim();
        const rating = parseInt(document.getElementById('newPlayerRating').value) || 1000;
        
        if (!name) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞!', 'error');
            return;
        }
        
        if (players[name]) {
            showNotification('–ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
            return;
        }
        
        const newPlayer = { 
            rating: rating, 
            matches: 0, 
            wins: 0, 
            lastGame: null, 
            joinDate: new Date(),
            penalties: 0,
            avatar: avatar || `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`,
            achievement_bonuses: {}
        };
        
        players[name] = newPlayer;
        
        try {
            await savePlayerToSupabase(name, newPlayer);
            
            // –°–û–ó–î–ê–ï–ú –ö–ê–ë–ò–ù–ï–¢ –î–õ–Ø –ò–ì–†–û–ö–ê
            await createPlayerCabinet(name);
            
            updatePlayerSelects();
            updateAllDisplays();
            
            document.getElementById('newPlayerName').value = '';
            document.getElementById('newPlayerAvatar').value = '';
            document.getElementById('newPlayerRating').value = 1000;
            
            showNotification(`‚úÖ –ò–≥—Ä–æ–∫ ${name} –¥–æ–±–∞–≤–ª–µ–Ω! –ö–∞–±–∏–Ω–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.`, 'success');
            
            setTimeout(applyAchievementBonuses, 500);
            
        } catch (error) {
            showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞', 'error');
        }
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
    async function removePlayer(name) {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∏–≥—Ä–æ–∫–æ–≤!', 'error');
            return;
        }
        
        if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ ${name}? –í—Å–µ –µ–≥–æ –º–∞—Ç—á–∏, —Å—Ç–∞–≤–∫–∏ –∏ –∫–∞–±–∏–Ω–µ—Ç —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) return;
        
        try {
            // –£–¥–∞–ª—è–µ–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
            await supabaseClient
                .from('player_cabinets')
                .delete()
                .eq('player_name', name);
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞–≤–∫–∏ –∏–≥—Ä–æ–∫–∞
            await supabaseClient
                .from('bet_history')
                .delete()
                .eq('player_name', name);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:', error);
        }
        
        delete players[name];
        matches = matches.filter(m => m.player1 !== name && m.player2 !== name);
        penaltyLog = penaltyLog.filter(p => p.player !== name);
        
        await loadAllData();
        
        updatePlayerSelects();
        updateAllDisplays();
        showNotification(`‚úÖ –ò–≥—Ä–æ–∫ ${name} —É–¥–∞–ª–µ–Ω!`, 'success');
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞
    async function addMatch() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–Ω–æ—Å–∏—Ç—å –º–∞—Ç—á–∏!', 'error');
            return;
        }
        
        const date = document.getElementById('matchDate').value;
        const p1 = document.getElementById('player1').value;
        const p2 = document.getElementById('player2').value;
        const winner = document.getElementById('winner').value;
        const score = document.getElementById('score').value;
        
        if (!p1 || !p2) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤!', 'error');
            return;
        }
        
        if (p1 === p2) {
            showNotification('–ò–≥—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏!', 'error');
            return;
        }
        
        if (!date) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –º–∞—Ç—á–∞!', 'error');
            return;
        }
        
        const matchDate = new Date(date);
        const now = new Date();
        matchDate.setHours(now.getHours(), now.getMinutes(), now.getSeconds());
        
        const realWinner = winner === 'player1' ? p1 : winner === 'player2' ? p2 : 'draw';
        
        if (!players[p1] || !players[p2]) {
            showNotification('–û–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!', 'error');
            return;
        }
        
        const rating1 = players[p1].rating;
        const rating2 = players[p2].rating;
        const ratingDiff = Math.abs(rating1 - rating2);
        
        const strongPlayer = rating1 > rating2 ? p1 : p2;
        const weakPlayer = rating1 > rating2 ? p2 : p1;
        const isUpset = realWinner === weakPlayer;
        
        let change1, change2;
        
        if (realWinner === p1) {
            players[p1].wins++;
            
            if (isUpset && ratingDiff >= 200 && p1 === weakPlayer) {
                change1 = 32;
                change2 = -32;
            } else {
                change1 = 16;
                change2 = -16;
            }
        } else if (realWinner === p2) {
            players[p2].wins++;
            
            if (isUpset && ratingDiff >= 200 && p2 === weakPlayer) {
                change1 = -32;
                change2 = 32;
            } else {
                change1 = -16;
                change2 = 16;
            }
        } else {
            change1 = 0;
            change2 = 0;
        }
        
        players[p1].rating += change1;
        players[p2].rating += change2;
        players[p1].matches++;
        players[p2].matches++;
        players[p1].lastGame = matchDate;
        players[p2].lastGame = matchDate;
        
        const newMatch = {
            id: Date.now().toString(),
            date: matchDate,
            player1: p1,
            player2: p2,
            winner: realWinner,
            change1: change1,
            change2: change2,
            score: score
        };
        
        matches.unshift(newMatch);
        
        try {
            await saveMatchToSupabase(newMatch);
            await savePlayerToSupabase(p1, players[p1]);
            await savePlayerToSupabase(p2, players[p2]);
            
            // –ù–ê–ß–ò–°–õ–Ø–ï–ú –ñ–ï–¢–û–ù–´ –ó–ê –ê–ö–¢–ò–í–ù–û–°–¢–¨
            await awardTokensForActivity(p1, 100); // 100 –∂–µ—Ç–æ–Ω–æ–≤ –∑–∞ –º–∞—Ç—á
            await awardTokensForActivity(p2, 100);
            
            updateAllDisplays();
            setMatchDateToToday();
            if (document.getElementById('score')) {
                document.getElementById('score').value = '';
            }
            
            let notificationMessage = `‚úÖ –ú–∞—Ç—á –¥–æ–±–∞–≤–ª–µ–Ω! ${p1}: ${change1 > 0 ? '+' : ''}${change1}, ${p2}: ${change2 > 0 ? '+' : ''}${change2}`;
            
            if (isUpset && ratingDiff >= 200) {
                notificationMessage += ` (–ü—Ä–∞–≤–∏–ª–æ 32 –æ—á–∫–æ–≤ - —Å–ª–∞–±—ã–π –ø–æ–±–µ–¥–∏–ª —Å–∏–ª—å–Ω–æ–≥–æ, —Ä–∞–∑–Ω–∏—Ü–∞ ${ratingDiff})`;
            }
            
            showNotification(notificationMessage, 'success');
            
            setTimeout(applyAchievementBonuses, 500);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç—á–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç—á–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö', 'error');
        }
    }
    
    // –ù–∞—á–∏—Å–ª–∏—Ç—å –∂–µ—Ç–æ–Ω—ã –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    async function awardTokensForActivity(playerName, amount) {
        try {
            // –ò—â–µ–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
            const { data: cabinet, error } = await supabaseClient
                .from('player_cabinets')
                .select('*')
                .eq('player_name', playerName)
                .single();
            
            if (error) {
                if (error.code === 'PGRST116') {
                    // –ö–∞–±–∏–Ω–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
                    await createPlayerCabinet(playerName);
                    return;
                }
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–∞:', error);
                return;
            }
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –∂–µ—Ç–æ–Ω—ã
            const newTokens = (cabinet.tokens || 0) + amount;
            await supabaseClient
                .from('player_cabinets')
                .update({
                    tokens: newTokens,
                    updated_at: new Date().toISOString()
                })
                .eq('id', cabinet.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (playerCabinet && playerCabinet.player_name === playerName) {
                playerCabinet.tokens = newTokens;
                updateCabinetDisplay();
            }
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤:', error);
        }
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–æ–∫
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const tabElement = document.getElementById(tabName);
        if (tabElement) {
            tabElement.classList.add('active');
        }
        
        const activeButton = document.querySelector(`.tab-btn[onclick*="${tabName}"]`);
        if (activeButton) {
            activeButton.classList.add('active');
        }
        
        if (tabName === 'stats') {
            setTimeout(() => {
                updateYearProgressChart();
            }, 100);
        } else if (tabName === 'tournaments') {
            setTimeout(() => {
                updateTournamentsDisplay();
                updateTournamentPlayersList();
            }, 100);
        } else if (tabName === 'bets') {
            setTimeout(() => {
                updateBetMatchesDisplay();
                updateBetHistoryDisplay();
            }, 100);
        }
    }
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)
    // ============================================
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        checkAutoLogin();
        
        setMatchDateToToday();
        
        await initSupabase();
        
        updatePlayerSelects();
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }
    
    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    // ...
    </script>
</body>
</html>
