<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞</title>
    <style>
        /* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            -webkit-text-size-adjust: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 18px 12px;
            text-align: center;
        }
        
        header h1 {
            font-size: 1.6em;
            margin-bottom: 6px;
            word-break: break-word;
            line-height: 1.3;
        }
        
        .header-subtitle {
            font-size: 0.95em;
            opacity: 0.9;
            padding: 0 8px;
            line-height: 1.4;
        }
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –¢–£–†–ù–ò–†–û–í */
        .tournament-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tournament-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .tournament-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tournament-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
        }
        
        .tournament-winner {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .tournament-photo {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin: 20px 0;
            border: 3px solid #4CAF50;
        }
        
        .tournament-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .tournament-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .tournament-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .tournament-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #4CAF50;
        }
        
        .tournament-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .tournament-card p {
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .tournament-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .tournament-generator {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
        }
        
        .tournament-generator h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tournament-players-select {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .player-select-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .player-select-item:hover {
            background: #e8f5e9;
        }
        
        .player-select-item.selected {
            background: #4CAF50;
            color: white;
        }
        
        .player-select-item img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .bracket-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .bracket-round {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .bracket-round h4 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
            padding-bottom: 5px;
            border-bottom: 2px solid #4CAF50;
        }
        
        .bracket-match {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        
        .bracket-match:hover {
            background: #e8f5e9;
        }
        
        .bracket-match.winner {
            background: #4CAF50;
            color: white;
            border-color: #45a049;
        }
        
        .bracket-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .bracket-player:last-child {
            border-bottom: none;
        }
        
        .bracket-player-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bracket-player-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .bracket-player-score {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .tournament-match-result {
            background: white;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .tournament-match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .tournament-match-players {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .tournament-match-score {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            margin: 10px 0;
        }
        
        .tournament-match-score input {
            width: 60px;
            text-align: center;
            padding: 5px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .score-separator {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .tournament-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .round-robin-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .round-robin-table th {
            background: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
        }
        
        .round-robin-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        .round-robin-table tr:hover {
            background: #f9f9f9;
        }
        
        .round-robin-table .player-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: flex-start;
        }
        
        .round-robin-table .player-cell img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .tournament-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        /* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è... */
        .player-profile-container {
            padding: 20px 15px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
        
        /* –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –≤–∫–ª–∞–¥–æ–∫ */
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            padding: 14px 16px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
            min-width: fit-content;
        }
        
        .tab-btn.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }
        
        .tab-content {
            display: none;
            padding: 15px 12px;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ... –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
        
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="tournamentContainer" style="display: none;">
        <div class="tournament-container" id="tournamentContent">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div style="padding: 20px; text-align: center;">
            <a href="#" class="back-button" onclick="returnToMainFromTournament()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç—É—Ä–Ω–∏—Ä–æ–≤</a>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä–æ–∫–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="playerProfileContainer" style="display: none;">
        <div class="player-profile-container">
            <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä–æ–∫–∞ -->
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–≤–∏–¥–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="appContainer">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢</h1>
            <div class="header-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞</div>
        </header>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ - –î–û–ë–ê–í–õ–ï–ù–ê –í–ö–õ–ê–î–ö–ê –¢–£–†–ù–ò–†–û–í -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üéØ –¢—É—Ä–Ω–∏—Ä—ã</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ - –î–û–ë–ê–í–õ–ï–ù–ê –í–ö–õ–ê–î–ö–ê –¢–£–†–ù–ò–†–û–í -->
        <div class="tab-content active" id="rating">
            <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
        </div>
        
        <div class="tab-content" id="tournaments">
            <h2>üéØ –¢—É—Ä–Ω–∏—Ä—ã</h2>
            
            <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
            <div class="tournament-generator" id="tournamentGenerator">
                <h3>üéÆ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä</h3>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                            <input type="text" id="tournamentName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É–±–æ–∫ –í–µ—Å–Ω—ã 2024">
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                            <select id="tournamentType" onchange="updateTournamentType()">
                                <option value="round-robin-3">–ö—Ä—É–≥–æ–≤–æ–π (3 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="round-robin-4">–ö—Ä—É–≥–æ–≤–æ–π (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="single-elimination-4">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="single-elimination-8">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8 –∏–≥—Ä–æ–∫–æ–≤)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</label>
                            <div class="tournament-players-select" id="tournamentPlayersSelect">
                                <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Ç–∫–∏:</label>
                            <div id="tournamentPreview">
                                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                            </div>
                        </div>
                        <button class="add-btn action-btn" onclick="createTournament()" style="width: 100%; margin-top: 20px;">
                            üèÜ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
            <h3>üìã –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤</h3>
            <div class="tournament-grid" id="tournamentsList">
                <!-- –¢—É—Ä–Ω–∏—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <div class="tab-content" id="matches">
            <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –º–∞—Ç—á–µ–π -->
        </div>
        
        <!-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–∫–ª–∞–¥–∫–∏ ... -->
        
        <!-- –ü–∞–Ω–µ–ª–∏ –≤–Ω–∏–∑—É —Å–∞–π—Ç–∞ -->
        <div class="bottom-panels">
            <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞–Ω–µ–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        </div>
    </div>

    <script>
    // ============================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE
    // ============================================
    const SUPABASE_URL = 'https://bqycjfcjtdawyrysgrbw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWNqZmNqdGRhd3lyeXNncmJ3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjYwMTk3MCwiZXhwIjoyMDgyMTc3OTcwfQ.lHA_79fw8PSj9ZHMExBpSEIpkonkCYOni7HniGGqadY';
    
    let supabaseClient = null;
    let isSupabaseInitialized = false;
    
    // ============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –¢–£–†–ù–ò–†–û–í
    // ============================================
    let tournaments = [];
    let tournamentPlayers = [];
    
    // ============================================
    // –§–£–ù–ö–¶–ò–ò –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç—É—Ä–Ω–∏—Ä—ã
    async function loadTournaments() {
        if (!supabaseClient) return;
        
        try {
            const { data, error } = await supabaseClient
                .from('tournaments')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
                return;
            }
            
            tournaments = data || [];
            updateTournamentsList();
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function updateTournamentsList() {
        const container = document.getElementById('tournamentsList');
        if (!container) return;
        
        if (tournaments.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #666; margin-bottom: 10px;">üéæ –¢—É—Ä–Ω–∏—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç—É—Ä–Ω–∏—Ä —Å –ø–æ–º–æ—â—å—é –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –≤—ã—à–µ</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        
        tournaments.forEach(tournament => {
            const card = document.createElement('div');
            card.className = 'tournament-card';
            card.onclick = () => showTournament(tournament.id);
            
            const winnerText = tournament.winner ? 
                `üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${tournament.winner}` : 
                'üèÜ –¢—É—Ä–Ω–∏—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ';
            
            card.innerHTML = `
                <h3>${tournament.name}</h3>
                <p><strong>–¢–∏–ø:</strong> ${getTournamentTypeName(tournament.type)}</p>
                <p><strong>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</strong> ${tournament.participants_count || 0}</p>
                <p><strong>–°–æ–∑–¥–∞–Ω:</strong> ${new Date(tournament.created_at).toLocaleDateString('ru-RU')}</p>
                <p>${winnerText}</p>
                <div class="tournament-stats">
                    <span>üéÆ ${tournament.matches_count || 0} –º–∞—Ç—á–µ–π</span>
                    ${isAdmin ? `<button class="delete-btn action-btn" onclick="deleteTournament('${tournament.id}', event)" style="padding: 2px 8px; font-size: 12px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` : ''}
                </div>
            `;
            
            container.appendChild(card);
        });
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
    function getTournamentTypeName(type) {
        const types = {
            'round-robin-3': '–ö—Ä—É–≥–æ–≤–æ–π (3 –∏–≥—Ä–æ–∫–∞)',
            'round-robin-4': '–ö—Ä—É–≥–æ–≤–æ–π (4 –∏–≥—Ä–æ–∫–∞)',
            'single-elimination-4': '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4)',
            'single-elimination-8': '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8)'
        };
        return types[type] || type;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤ —Ç—É—Ä–Ω–∏—Ä–µ
    function updateTournamentPlayersSelect() {
        const container = document.getElementById('tournamentPlayersSelect');
        if (!container) return;
        
        container.innerHTML = '';
        tournamentPlayers = [];
        
        Object.keys(players).forEach(playerName => {
            const player = players[playerName];
            const item = document.createElement('div');
            item.className = 'player-select-item';
            item.onclick = () => toggleTournamentPlayer(playerName, item);
            
            item.innerHTML = `
                <img src="${player.avatar}" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                <span>${playerName}</span>
            `;
            
            container.appendChild(item);
        });
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞
    function toggleTournamentPlayer(playerName, element) {
        const index = tournamentPlayers.indexOf(playerName);
        const tournamentType = document.getElementById('tournamentType').value;
        const requiredPlayers = getRequiredPlayersCount(tournamentType);
        
        if (index === -1) {
            if (tournamentPlayers.length >= requiredPlayers) {
                showNotification(`–ú–∞–∫—Å–∏–º—É–º ${requiredPlayers} –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞`, 'warning');
                return;
            }
            tournamentPlayers.push(playerName);
            element.classList.add('selected');
        } else {
            tournamentPlayers.splice(index, 1);
            element.classList.remove('selected');
        }
        
        updateTournamentPreview();
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
    function getRequiredPlayersCount(type) {
        const counts = {
            'round-robin-3': 3,
            'round-robin-4': 4,
            'single-elimination-4': 4,
            'single-elimination-8': 8
        };
        return counts[type] || 0;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç—É—Ä–Ω–∏—Ä–∞
    function updateTournamentPreview() {
        const preview = document.getElementById('tournamentPreview');
        if (!preview) return;
        
        const type = document.getElementById('tournamentType').value;
        const requiredPlayers = getRequiredPlayersCount(type);
        
        if (tournamentPlayers.length === 0) {
            preview.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞</p>';
            return;
        }
        
        let previewHTML = `
            <p><strong>–£—á–∞—Å—Ç–Ω–∏–∫–∏ (${tournamentPlayers.length}/${requiredPlayers}):</strong></p>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0;">
        `;
        
        tournamentPlayers.forEach(playerName => {
            const player = players[playerName];
            previewHTML += `
                <div style="display: flex; align-items: center; gap: 5px; background: #e8f5e9; padding: 5px 10px; border-radius: 20px;">
                    <img src="${player.avatar}" style="width: 20px; height: 20px; border-radius: 50%;">
                    <span>${playerName}</span>
                </div>
            `;
        });
        
        previewHTML += '</div>';
        
        if (tournamentPlayers.length < requiredPlayers) {
            previewHTML += `<p style="color: #ff9800;">‚ö†Ô∏è –ù—É–∂–Ω–æ –µ—â–µ ${requiredPlayers - tournamentPlayers.length} –∏–≥—Ä–æ–∫–æ–≤</p>`;
        } else if (tournamentPlayers.length > requiredPlayers) {
            previewHTML += `<p style="color: #f44336;">‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–æ–≤. –ú–∞–∫—Å–∏–º—É–º ${requiredPlayers}</p>`;
        } else {
            previewHTML += '<p style="color: #4CAF50;">‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ç—É—Ä–Ω–∏—Ä–∞!</p>';
        }
        
        preview.innerHTML = previewHTML;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞
    function updateTournamentType() {
        tournamentPlayers = [];
        document.querySelectorAll('.player-select-item').forEach(item => {
            item.classList.remove('selected');
        });
        updateTournamentPreview();
    }
    
    // –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
    async function createTournament() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        const name = document.getElementById('tournamentName').value.trim();
        const type = document.getElementById('tournamentType').value;
        const requiredPlayers = getRequiredPlayersCount(type);
        
        if (!name) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
            return;
        }
        
        if (tournamentPlayers.length !== requiredPlayers) {
            showNotification(`–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ ${requiredPlayers} –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
            return;
        }
        
        try {
            // –°–æ–∑–¥–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
            const { data: tournament, error } = await supabaseClient
                .from('tournaments')
                .insert({
                    name: name,
                    type: type,
                    participants: tournamentPlayers,
                    participants_count: tournamentPlayers.length,
                    status: 'active',
                    winner: null
                })
                .select()
                .single();
            
            if (error) throw error;
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—á–∏ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞
            const matches = generateTournamentMatches(type, tournamentPlayers, tournament.id);
            
            for (const match of matches) {
                await supabaseClient
                    .from('tournament_matches')
                    .insert(match);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π –≤ —Ç—É—Ä–Ω–∏—Ä–µ
            await supabaseClient
                .from('tournaments')
                .update({ matches_count: matches.length })
                .eq('id', tournament.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            await loadTournaments();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('tournamentName').value = '';
            tournamentPlayers = [];
            document.querySelectorAll('.player-select-item').forEach(item => {
                item.classList.remove('selected');
            });
            updateTournamentPreview();
            
            showNotification(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${name}" —Å–æ–∑–¥–∞–Ω!`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ç—á–µ–π –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞
    function generateTournamentMatches(type, participants, tournamentId) {
        const matches = [];
        const now = new Date();
        
        if (type.startsWith('round-robin')) {
            // –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä
            const playerCount = type === 'round-robin-3' ? 3 : 4;
            
            for (let i = 0; i < playerCount; i++) {
                for (let j = i + 1; j < playerCount; j++) {
                    matches.push({
                        tournament_id: tournamentId,
                        round: 1,
                        player1: participants[i],
                        player2: participants[j],
                        winner: null,
                        score1: 0,
                        score2: 0,
                        games1: 0,
                        games2: 0,
                        status: 'scheduled',
                        match_order: matches.length + 1
                    });
                }
            }
        } else if (type.startsWith('single-elimination')) {
            // –û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
            const playerCount = type === 'single-elimination-4' ? 4 : 8;
            const rounds = Math.log2(playerCount);
            
            // –ü–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥
            for (let i = 0; i < playerCount / 2; i++) {
                matches.push({
                    tournament_id: tournamentId,
                    round: 1,
                    player1: participants[i * 2],
                    player2: participants[i * 2 + 1],
                    winner: null,
                    score1: 0,
                    score2: 0,
                    games1: 0,
                    games2: 0,
                    status: 'scheduled',
                    match_order: i + 1
                });
            }
            
            // –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞—É–Ω–¥—ã (–ø–æ–ª—É—Ñ–∏–Ω–∞–ª—ã, —Ñ–∏–Ω–∞–ª)
            for (let round = 2; round <= rounds; round++) {
                const matchesInRound = playerCount / Math.pow(2, round);
                for (let i = 0; i < matchesInRound; i++) {
                    matches.push({
                        tournament_id: tournamentId,
                        round: round,
                        player1: null, // –ë—É–¥—É—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
                        player2: null,
                        winner: null,
                        score1: 0,
                        score2: 0,
                        games1: 0,
                        games2: 0,
                        status: 'pending',
                        match_order: matches.length + 1
                    });
                }
            }
        }
        
        return matches;
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
    async function showTournament(tournamentId) {
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) return;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('playerProfileContainer').style.display = 'none';
        document.getElementById('tournamentContainer').style.display = 'block';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç—É—Ä–Ω–∏—Ä–∞
        await loadTournamentDetails(tournamentId);
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö
        window.scrollTo(0, 0);
    }
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç—É—Ä–Ω–∏—Ä–∞
    async function loadTournamentDetails(tournamentId) {
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
            const { data: tournament, error: tournamentError } = await supabaseClient
                .from('tournaments')
                .select('*')
                .eq('id', tournamentId)
                .single();
            
            if (tournamentError) throw tournamentError;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            const { data: tournamentMatches, error: matchesError } = await supabaseClient
                .from('tournament_matches')
                .select('*')
                .eq('tournament_id', tournamentId)
                .order('round', { ascending: true })
                .order('match_order', { ascending: true });
            
            if (matchesError) throw matchesError;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const { data: photos, error: photosError } = await supabaseClient
                .storage
                .from('tournament-photos')
                .list(tournamentId + '/');
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
            renderTournamentPage(tournament, tournamentMatches || [], photos || []);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
    function renderTournamentPage(tournament, matches, photos) {
        const container = document.getElementById('tournamentContent');
        if (!container) return;
        
        let html = `
            <div class="tournament-header">
                <h1 class="tournament-title">${tournament.name}</h1>
                <div class="tournament-meta">
                    <span>üéØ ${getTournamentTypeName(tournament.type)}</span>
                    <span>üë• ${tournament.participants_count} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                    <span>üìÖ ${new Date(tournament.created_at).toLocaleDateString('ru-RU')}</span>
                </div>
            </div>
        `;
        
        // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å
        if (tournament.winner) {
            html += `
                <div class="tournament-winner">
                    üèÜ –ü–û–ë–ï–î–ò–¢–ï–õ–¨: ${tournament.winner}
                </div>
            `;
        }
        
        // –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        if (photos.length > 0) {
            html += `<h3>üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>`;
            photos.forEach(photo => {
                const photoUrl = `${SUPABASE_URL}/storage/v1/object/public/tournament-photos/${tournament.id}/${photo.name}`;
                html += `<img src="${photoUrl}" class="tournament-photo" alt="–§–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞">`;
            });
        }
        
        // –£—á–∞—Å—Ç–Ω–∏–∫–∏
        html += `
            <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
        `;
        
        tournament.participants.forEach(playerName => {
            const player = players[playerName];
            if (player) {
                html += `
                    <div style="display: flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 8px 15px; border-radius: 20px; border: 1px solid #e0e0e0;">
                        <img src="${player.avatar}" style="width: 30px; height: 30px; border-radius: 50%;">
                        <span>${playerName}</span>
                        ${playerName === tournament.winner ? 'üëë' : ''}
                    </div>
                `;
            }
        });
        
        html += `</div>`;
        
        // –¢–∞–±–ª–∏—Ü–∞ –∏–ª–∏ —Å–µ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
        if (tournament.type.startsWith('round-robin')) {
            html += renderRoundRobinTable(tournament, matches);
        } else {
            html += renderBracket(tournament, matches);
        }
        
        // –ú–∞—Ç—á–∏
        html += `<h3>üéÆ –í—Å–µ –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>`;
        
        if (matches.length === 0) {
            html += `<p>–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>`;
        } else {
            matches.forEach(match => {
                html += renderTournamentMatch(match);
            });
        }
        
        // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        if (isAdmin) {
            html += `
                <div class="tournament-actions">
                    <button class="delete-btn action-btn" onclick="deleteTournament('${tournament.id}')">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä
                    </button>
                    <button class="add-btn action-btn" onclick="uploadTournamentPhoto('${tournament.id}')">
                        üì∏ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                    </button>
                </div>
            `;
        }
        
        container.innerHTML = html;
        
        // –ï—Å–ª–∏ —Ç—É—Ä–Ω–∏—Ä –∞–∫—Ç–∏–≤–µ–Ω –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        if (tournament.status === 'active' && isAdmin) {
            addMatchResultInputs(tournament, matches);
        }
    }
    
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function renderRoundRobinTable(tournament, matches) {
        const participants = tournament.participants;
        const tableData = {};
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        participants.forEach(player => {
            tableData[player] = {
                matches: 0,
                wins: 0,
                losses: 0,
                draws: 0,
                points: 0,
                gamesWon: 0,
                gamesLost: 0,
                gamesDiff: 0
            };
        });
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏
        matches.forEach(match => {
            if (match.status === 'completed') {
                const player1 = match.player1;
                const player2 = match.player2;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∞—Ç—á–µ–π
                tableData[player1].matches++;
                tableData[player2].matches++;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä
                tableData[player1].gamesWon += match.games1;
                tableData[player1].gamesLost += match.games2;
                tableData[player2].gamesWon += match.games2;
                tableData[player2].gamesLost += match.games1;
                
                if (match.winner === player1) {
                    tableData[player1].wins++;
                    tableData[player1].points += 2;
                    tableData[player2].losses++;
                } else if (match.winner === player2) {
                    tableData[player2].wins++;
                    tableData[player2].points += 2;
                    tableData[player1].losses++;
                } else if (match.winner === 'draw') {
                    tableData[player1].draws++;
                    tableData[player2].draws++;
                    tableData[player1].points += 1;
                    tableData[player2].points += 1;
                }
            }
        });
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –∏–≥—Ä
        participants.forEach(player => {
            tableData[player].gamesDiff = tableData[player].gamesWon - tableData[player].gamesLost;
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –æ—á–∫–∞–º, –∑–∞—Ç–µ–º –ø–æ —Ä–∞–∑–Ω–∏—Ü–µ –∏–≥—Ä
        const sortedPlayers = [...participants].sort((a, b) => {
            if (tableData[b].points !== tableData[a].points) {
                return tableData[b].points - tableData[a].points;
            }
            return tableData[b].gamesDiff - tableData[a].gamesDiff;
        });
        
        let html = `
            <h3>üìä –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h3>
            <div class="table-container">
                <table class="round-robin-table">
                    <thead>
                        <tr>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–ò</th>
                            <th>–í</th>
                            <th>–ü</th>
                            <th>–ù</th>
                            <th>–û</th>
                            <th>+/-</th>
                            <th>–†–∞–∑–Ω–∏—Ü–∞</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        sortedPlayers.forEach((player, index) => {
            const data = tableData[player];
            const playerObj = players[player];
            
            html += `
                <tr ${index < 2 ? 'style="background: #e8f5e9;"' : ''}>
                    <td class="player-cell">
                        <img src="${playerObj?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                             onerror="this.src='https://i.pravatar.cc/150?img=3'}">
                        <span>${player} ${index === 0 && tournament.status === 'completed' ? 'üëë' : ''}</span>
                    </td>
                    <td>${data.matches}</td>
                    <td>${data.wins}</td>
                    <td>${data.losses}</td>
                    <td>${data.draws}</td>
                    <td><strong>${data.points}</strong></td>
                    <td>${data.gamesWon}:${data.gamesLost}</td>
                    <td><strong>${data.gamesDiff > 0 ? '+' : ''}${data.gamesDiff}</strong></td>
                </tr>
            `;
        });
        
        html += `
                    </tbody>
                </table>
            </div>
        `;
        
        return html;
    }
    
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–µ—Ç–∫—É —Ç—É—Ä–Ω–∏—Ä–∞
    function renderBracket(tournament, matches) {
        const rounds = {};
        
        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ —Ä–∞—É–Ω–¥–∞–º
        matches.forEach(match => {
            if (!rounds[match.round]) {
                rounds[match.round] = [];
            }
            rounds[match.round].push(match);
        });
        
        let html = '<h3>üìä –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞</h3><div class="bracket-container">';
        
        Object.keys(rounds).sort().forEach(roundNumber => {
            const roundMatches = rounds[roundNumber];
            const roundName = getRoundName(parseInt(roundNumber), tournament.participants_count);
            
            html += `
                <div class="bracket-round">
                    <h4>${roundName}</h4>
            `;
            
            roundMatches.forEach(match => {
                const isCompleted = match.status === 'completed';
                const isWinner1 = isCompleted && match.winner === match.player1;
                const isWinner2 = isCompleted && match.winner === match.player2;
                
                html += `
                    <div class="bracket-match ${isCompleted ? (isWinner1 || isWinner2 ? 'winner' : '') : ''}">
                        <div class="bracket-player">
                            <div class="bracket-player-info">
                                ${match.player1 ? `
                                    <img src="${players[match.player1]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                         class="bracket-player-avatar">
                                    <span>${match.player1}</span>
                                ` : '<span>?</span>'}
                            </div>
                            <div class="bracket-player-score">
                                ${isCompleted ? match.score1 : '-'}
                            </div>
                        </div>
                        <div class="bracket-player">
                            <div class="bracket-player-info">
                                ${match.player2 ? `
                                    <img src="${players[match.player2]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                         class="bracket-player-avatar">
                                    <span>${match.player2}</span>
                                ` : '<span>?</span>'}
                            </div>
                            <div class="bracket-player-score">
                                ${isCompleted ? match.score2 : '-'}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
        });
        
        html += '</div>';
        return html;
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—É–Ω–¥–∞
    function getRoundName(round, participantsCount) {
        const roundsMap = {
            1: participantsCount === 4 ? '–ü–æ–ª—É—Ñ–∏–Ω–∞–ª—ã' : '1/8 —Ñ–∏–Ω–∞–ª–∞',
            2: participantsCount === 4 ? '–§–∏–Ω–∞–ª' : '1/4 —Ñ–∏–Ω–∞–ª–∞',
            3: '–ü–æ–ª—É—Ñ–∏–Ω–∞–ª—ã',
            4: '–§–∏–Ω–∞–ª'
        };
        return roundsMap[round] || `–†–∞—É–Ω–¥ ${round}`;
    }
    
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –º–∞—Ç—á —Ç—É—Ä–Ω–∏—Ä–∞
    function renderTournamentMatch(match) {
        const player1 = players[match.player1];
        const player2 = players[match.player2];
        
        let result = '';
        if (match.status === 'completed') {
            if (match.winner === 'draw') {
                result = `–ù–∏—á—å—è ${match.score1}:${match.score2}`;
            } else {
                result = `–ü–æ–±–µ–¥–∏–ª: ${match.winner} ${match.score1}:${match.score2}`;
            }
        }
        
        return `
            <div class="tournament-match-result">
                <div class="tournament-match-header">
                    <span><strong>–†–∞—É–Ω–¥ ${match.round}</strong></span>
                    <span>${match.status === 'completed' ? '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è'}</span>
                </div>
                <div class="tournament-match-players">
                    <div style="flex: 1; text-align: center;">
                        <img src="${player1?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                             style="width: 40px; height: 40px; border-radius: 50%;">
                        <div>${match.player1 || '?'}</div>
                    </div>
                    <div style="font-size: 1.5em; font-weight: bold;">VS</div>
                    <div style="flex: 1; text-align: center;">
                        <img src="${player2?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                             style="width: 40px; height: 40px; border-radius: 50%;">
                        <div>${match.player2 || '?'}</div>
                    </div>
                </div>
                ${result ? `<div style="text-align: center; margin-top: 10px; color: #4CAF50; font-weight: bold;">${result}</div>` : ''}
                ${match.games1 > 0 || match.games2 > 0 ? 
                    `<div style="text-align: center; font-size: 0.9em; color: #666;">–°–µ—Ç–æ–≤: ${match.games1}:${match.games2}</div>` : ''}
            </div>
        `;
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function addMatchResultInputs(tournament, matches) {
        const pendingMatches = matches.filter(m => m.status === 'scheduled');
        
        if (pendingMatches.length > 0) {
            let html = '<h3>üìù –í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞—Ç—á–µ–π</h3>';
            
            pendingMatches.forEach(match => {
                html += `
                    <div class="tournament-match-result">
                        <h4>–ú–∞—Ç—á ${match.match_order} (–†–∞—É–Ω–¥ ${match.round})</h4>
                        <div class="tournament-match-players">
                            <div style="flex: 1; text-align: center;">
                                <img src="${players[match.player1]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                     style="width: 40px; height: 40px; border-radius: 50%;">
                                <div>${match.player1}</div>
                            </div>
                            <div style="font-size: 1.5em; font-weight: bold;">VS</div>
                            <div style="flex: 1; text-align: center;">
                                <img src="${players[match.player2]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                     style="width: 40px; height: 40px; border-radius: 50%;">
                                <div>${match.player2}</div>
                            </div>
                        </div>
                        <div class="tournament-match-score">
                            <input type="number" id="score1_${match.id}" min="0" value="0" style="width: 60px;">
                            <span class="score-separator">:</span>
                            <input type="number" id="score2_${match.id}" min="0" value="0" style="width: 60px;">
                        </div>
                        <div class="tournament-match-score">
                            <span>–°–µ—Ç—ã:</span>
                            <input type="number" id="games1_${match.id}" min="0" max="5" value="0" style="width: 50px;">
                            <span class="score-separator">:</span>
                            <input type="number" id="games2_${match.id}" min="0" max="5" value="0" style="width: 50px;">
                        </div>
                        <div class="tournament-controls">
                            <button class="add-btn action-btn" onclick="saveMatchResult('${match.id}', '${match.player1}', '${tournament.id}')">
                                ${match.player1} –ø–æ–±–µ–¥–∏–ª
                            </button>
                            <button class="add-btn action-btn" onclick="saveMatchResult('${match.id}', '${match.player2}', '${tournament.id}')">
                                ${match.player2} –ø–æ–±–µ–¥–∏–ª
                            </button>
                            <button class="penalty-btn action-btn" onclick="saveMatchResult('${match.id}', 'draw', '${tournament.id}')">
                                –ù–∏—á—å—è
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('tournamentContent').innerHTML += html;
        }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞
    async function saveMatchResult(matchId, winner, tournamentId) {
        if (!isAdmin) return;
        
        const score1 = parseInt(document.getElementById(`score1_${matchId}`)?.value) || 0;
        const score2 = parseInt(document.getElementById(`score2_${matchId}`)?.value) || 0;
        const games1 = parseInt(document.getElementById(`games1_${matchId}`)?.value) || 0;
        const games2 = parseInt(document.getElementById(`games2_${matchId}`)?.value) || 0;
        
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á
            const { error: matchError } = await supabaseClient
                .from('tournament_matches')
                .update({
                    winner: winner,
                    score1: score1,
                    score2: score2,
                    games1: games1,
                    games2: games2,
                    status: 'completed',
                    completed_at: new Date().toISOString()
                })
                .eq('id', matchId);
            
            if (matchError) throw matchError;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –æ–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥
            const tournament = tournaments.find(t => t.id === tournamentId);
            if (tournament.type.startsWith('single-elimination')) {
                await updateNextRoundMatches(matchId, tournamentId, winner);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–µ–Ω –ª–∏ —Ç—É—Ä–Ω–∏—Ä
            await checkTournamentCompletion(tournamentId);
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
            await loadTournamentDetails(tournamentId);
            
            showNotification('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', 'error');
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ç—á–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
    async function updateNextRoundMatches(matchId, tournamentId, winner) {
        try {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–∞—Ç—á
            const { data: currentMatch, error: matchError } = await supabaseClient
                .from('tournament_matches')
                .select('*')
                .eq('id', matchId)
                .single();
            
            if (matchError) throw matchError;
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞—Ç—á —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            const { data: nextMatches, error: nextError } = await supabaseClient
                .from('tournament_matches')
                .select('*')
                .eq('tournament_id', tournamentId)
                .eq('round', currentMatch.round + 1)
                .eq('status', 'pending');
            
            if (nextError) throw nextError;
            
            if (nextMatches.length > 0) {
                const nextMatch = nextMatches.find(match => 
                    !match.player1 || !match.player2
                );
                
                if (nextMatch) {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–∞—Ç—á–µ
                    const matchOrderInRound = currentMatch.match_order;
                    const isFirstInPair = matchOrderInRound % 2 === 1;
                    
                    const updateData = {};
                    if (isFirstInPair) {
                        updateData.player1 = winner;
                    } else {
                        updateData.player2 = winner;
                    }
                    
                    // –ï—Å–ª–∏ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ scheduled
                    const bothPlayersSet = (nextMatch.player1 && updateData.player2) || 
                                          (nextMatch.player2 && updateData.player1);
                    
                    if (bothPlayersSet) {
                        updateData.status = 'scheduled';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
                    const { error: updateError } = await supabaseClient
                        .from('tournament_matches')
                        .update(updateData)
                        .eq('id', nextMatch.id);
                    
                    if (updateError) throw updateError;
                }
            }
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞:', error);
            throw error;
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞
    async function checkTournamentCompletion(tournamentId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏
            const { data: pendingMatches, error: pendingError } = await supabaseClient
                .from('tournament_matches')
                .select('id')
                .eq('tournament_id', tournamentId)
                .eq('status', 'scheduled');
            
            if (pendingError) throw pendingError;
            
            // –ï—Å–ª–∏ –≤—Å–µ –º–∞—Ç—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
            if (pendingMatches.length === 0) {
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                const { data: finalMatch, error: finalError } = await supabaseClient
                    .from('tournament_matches')
                    .select('winner')
                    .eq('tournament_id', tournamentId)
                    .order('round', { ascending: false })
                    .order('match_order', { ascending: false })
                    .limit(1)
                    .single();
                
                if (!finalError && finalMatch.winner && finalMatch.winner !== 'draw') {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä
                    await supabaseClient
                        .from('tournaments')
                        .update({
                            status: 'completed',
                            winner: finalMatch.winner,
                            completed_at: new Date().toISOString()
                        })
                        .eq('id', tournamentId);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–±–µ–¥–∞—Ö –≤ –ø—Ä–æ—Ñ–∏–ª—è—Ö –∏–≥—Ä–æ–∫–æ–≤
                    await updatePlayerTournamentWins(finalMatch.winner);
                }
            }
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
        }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–±–µ–¥–∞—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞
    async function updatePlayerTournamentWins(playerName) {
        try {
            const player = players[playerName];
            if (player) {
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–±–µ–¥–∞—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö
                // –ù–∞–ø—Ä–∏–º–µ—Ä, —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–æ–±–µ–¥ –∏–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
                console.log(`üéâ –ò–≥—Ä–æ–∫ ${playerName} –≤—ã–∏–≥—Ä–∞–ª —Ç—É—Ä–Ω–∏—Ä!`);
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–±–µ–¥ –∏–≥—Ä–æ–∫–∞:', error);
        }
    }
    
    // –£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä
    async function deleteTournament(tournamentId, event = null) {
        if (event) event.stopPropagation();
        
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
            return;
        }
        
        try {
            // –£–¥–∞–ª—è–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            await supabaseClient
                .from('tournament_matches')
                .delete()
                .eq('tournament_id', tournamentId);
            
            // –£–¥–∞–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä
            const { error } = await supabaseClient
                .from('tournaments')
                .delete()
                .eq('id', tournamentId);
            
            if (error) throw error;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            await loadTournaments();
            
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç—É—Ä–Ω–∏—Ä–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É
            if (document.getElementById('tournamentContainer').style.display === 'block') {
                returnToMainFromTournament();
            }
            
            showNotification('‚úÖ –¢—É—Ä–Ω–∏—Ä —É–¥–∞–ª–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
    async function uploadTournamentPhoto(tournamentId) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showNotification('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 5MB)', 'error');
                return;
            }
            
            try {
                const fileName = `${Date.now()}_${file.name}`;
                const { error } = await supabaseClient
                    .storage
                    .from('tournament-photos')
                    .upload(`${tournamentId}/${fileName}`, file);
                
                if (error) throw error;
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
                await loadTournamentDetails(tournamentId);
                
                showNotification('‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ', 'error');
            }
        };
        
        input.click();
    }
    
    // –í–µ—Ä–Ω—É—Ç—å—Å—è –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç—É—Ä–Ω–∏—Ä–∞
    function returnToMainFromTournament() {
        document.getElementById('appContainer').style.display = 'block';
        document.getElementById('tournamentContainer').style.display = 'none';
        document.getElementById('playerProfileContainer').style.display = 'none';
        openTab('tournaments');
        window.scrollTo(0, 0);
        return false;
    }
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –¢–£–†–ù–ò–†–û–í
    // ============================================
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è init –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ-–ª–æ–≥–∏–Ω
        checkAutoLogin();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
        setMatchDateToToday();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Supabase
        await initSupabase();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
        updatePlayerSelects();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤
        updateTournamentPlayersSelect();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
        await loadTournaments();
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è updateAllDisplays
    function updateAllDisplays() {
        updateRatingTable();
        updateMatchesTable();
        updatePlayersTable();
        updatePenaltiesHistory();
        updatePeriodStats();
        updateYearProgressChart();
        updatePlayerSelects();
        updateAchievementsDisplay();
        updateTournamentPlayersSelect();
        updateTournamentsList();
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è openTab –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function openTab(tabName) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
        const tabElement = document.getElementById(tabName);
        if (tabElement) {
            tabElement.classList.add('active');
        }
        
        const activeButton = document.querySelector(`.tab-btn[onclick*="${tabName}"]`);
        if (activeButton) {
            activeButton.classList.add('active');
        }
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É - –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
        if (tabName === 'stats') {
            setTimeout(() => {
                updateYearProgressChart();
            }, 100);
        }
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ —Ç—É—Ä–Ω–∏—Ä—ã - –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        if (tabName === 'tournaments') {
            setTimeout(() => {
                loadTournaments();
            }, 100);
        }
    }
    
    // –û—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
    // ============================================
    // –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
    // ============================================
    
    let players = {};
    let matches = [];
    let penaltyLog = [];
    let isAdmin = false;
    const ADMIN_PASSWORD = "admin123";
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
    
    </script>
</body>
</html>
