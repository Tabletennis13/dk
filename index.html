<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞</title>
    <style>
        /* –í–µ—Å—å –≤–∞—à CSS —Å—Ç–∏–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            -webkit-text-size-adjust: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 18px 12px;
            text-align: center;
        }
        
        header h1 {
            font-size: 1.6em;
            margin-bottom: 6px;
            word-break: break-word;
            line-height: 1.3;
        }
        
        .header-subtitle {
            font-size: 0.95em;
            opacity: 0.9;
            padding: 0 8px;
            line-height: 1.4;
        }
        
        /* –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... */
        
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä–æ–∫–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="playerProfileContainer" style="display: none;">
        <div class="player-profile-container">
            <div class="player-profile-header">
                <img id="playerProfileAvatar" src="" class="player-avatar-large" onerror="this.src='https://i.pravatar.cc/150?img=3'">
                <div class="player-info-large">
                    <h1 id="playerProfileName" class="player-name-large"></h1>
                    <div id="playerProfileRating" class="player-rating-large"></div>
                    <div id="playerProfileEmojis" class="achievement-emojis"></div>
                    <div id="playerProfileStats" class="player-profile-stats"></div>
                </div>
            </div>
            
            <div class="player-stats-grid">
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é</h3>
                    <div id="playerWeekStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –º–µ—Å—è—Ü</h3>
                    <div id="playerMonthStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –≥–æ–¥</h3>
                    <div id="playerYearStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="stat-period-box">
                    <h3>üìÖ –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</h3>
                    <div id="playerAllTimeStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üìà –ì—Ä–∞—Ñ–∏–∫ —Ñ–æ—Ä–º—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∞—Ç—á–µ–π)</h3>
                <canvas id="playerFormChart" class="chart-canvas"></canvas>
            </div>
            
            <div class="player-achievements-section">
                <h3>üèÜ –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞</h3>
                <div id="playerAllAchievements" class="achievements-list">
                    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <a href="#" class="back-button" onclick="returnToMain()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–π—Ç–∏–Ω–≥—É</a>
        </div>
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="tournamentPageContainer" style="display: none;">
        <div class="player-profile-container">
            <div class="tournament-page-header">
                <h1 id="tournamentPageName"></h1>
                <div id="tournamentPageMeta" class="tournament-meta"></div>
            </div>
            
            <div class="tournament-winner" id="tournamentWinnerSection">
                <!-- –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å -->
            </div>
            
            <div class="tournament-photo-section" id="tournamentPhotoSection">
                <h3>üì∏ –§–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div class="tournament-photo-container" id="tournamentPhotoContainer">
                    <div id="tournamentPhotoPlaceholder">
                        <p style="color: #666; text-align: center; padding: 40px;">
                            üèì –§–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                        </p>
                    </div>
                    <img id="tournamentPhoto" class="tournament-photo" style="display: none;">
                </div>
                <button class="upload-photo-btn" id="uploadPhotoBtn" onclick="uploadTournamentPhoto()" style="display: none;">
                    üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
            </div>
            
            <div class="tournament-bracket" id="tournamentBracket">
                <!-- –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
            
            <div class="tournament-matches" id="tournamentMatches">
                <h3>üéÆ –í—Å–µ –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                <div id="tournamentMatchesList"></div>
            </div>
            
            <a href="#" class="back-button" onclick="returnToTournaments()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç—É—Ä–Ω–∏—Ä–∞–º</a>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–≤–∏–¥–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="container" id="appContainer">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢</h1>
            <div class="header-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞</div>
        </header>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üèÖ –¢—É—Ä–Ω–∏—Ä—ã</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content active" id="rating">
            <h2>üèÜ –¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div class="table-container">
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–û—á–∫–∏</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–ü–æ–±–µ–¥</th>
                            <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∏–≥—Ä–∞</th>
                            <th>–ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="ratingBody"></tbody>
                </table>
            </div>
            
            <!-- –ë–õ–û–ö –î–û–°–¢–ò–ñ–ï–ù–ò–ô –ò –ü–û–û–©–†–ï–ù–ò–ô -->
            <div class="achievements-container" id="achievementsContainer">
                <div class="achievements-header">
                    <div class="level-icon">üèÜ</div>
                    <h3>–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h3>
                </div>
                
                <div id="achievementsContent">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç -->
                    <p>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤...</p>
                </div>
                
                <div class="levels-info">
                    <h4>üéØ –£—Ä–æ–≤–Ω–∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</h4>
                    <p>–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π:</p>
                    <div class="levels-list">
                        <div class="level-badge">ü•â 1100 - –ù–∞—á–∏–Ω–∞—é—â–∏–π —á–µ–º–ø–∏–æ–Ω</div>
                        <div class="level-badge">ü•à 1300 - –û–ø—ã—Ç–Ω—ã–π –±–æ–µ—Ü</div>
                        <div class="level-badge">ü•á 1500 - –ú–∞—Å—Ç–µ—Ä —Å—Ç–æ–ª–∞</div>
                        <div class="level-badge">üëë 2000 - –õ–µ–≥–µ–Ω–¥–∞ –ª–∏–≥–∏</div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                        <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É –∏–≥—Ä–æ–∫–æ–≤. 
                        –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞.
                        <br>üéÅ <strong>–ë–æ–Ω—É—Å—ã:</strong> –ó–∞ –∫–∞–∂–¥—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—á–∫–∏:
                        ü•â +16 –æ—á–∫–æ–≤, ü•à +20 –æ—á–∫–æ–≤, ü•á +30 –æ—á–∫–æ–≤, üëë +50 –æ—á–∫–æ–≤
                    </p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="matches">
            <h2>üéÆ –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π</h2>
            <div id="matchesContainer">
                <!-- –ú–∞—Ç—á–∏ –±—É–¥—É—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–Ω—è–º –∑–¥–µ—Å—å -->
            </div>
            
            <!-- –ë–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞ -->
            <div class="admin-controls" id="matchesAdminControls">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –º–∞—Ç—á–∞:</label>
                            <input type="date" id="matchDate">
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 1:</label>
                            <select id="player1"></select>
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 2:</label>
                            <select id="player2"></select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</label>
                            <select id="winner">
                                <option value="player1">–ò–≥—Ä–æ–∫ 1</option>
                                <option value="player2">–ò–≥—Ä–æ–∫ 2</option>
                                <option value="draw">–ù–∏—á—å—è</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–°—á–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="score" placeholder="3:2">
                        </div>
                        <button class="add-btn action-btn" onclick="addMatch()" style="margin-top: 20px; width: 100%;">
                            ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="players">
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h2>
            <div class="admin-controls" id="playersAdminControls">
                <h4>‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–ò–º—è –∏–≥—Ä–æ–∫–∞:</label>
                            <input type="text" id="newPlayerName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
                        </div>
                        <div class="form-group">
                            <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="newPlayerAvatar" placeholder="https://example.com/avatar.jpg">
                        </div>
                        <div class="form-group">
                            <label>–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥:</label>
                            <input type="number" id="newPlayerRating" value="1000">
                        </div>
                        <button class="add-btn action-btn" onclick="addPlayer()" style="width: 100%;">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
                        </button>
                    </div>
                    <div>
                        <p><strong>–°–æ–≤–µ—Ç—ã:</strong></p>
                        <ul style="list-style: none; padding: 0;">
                            <li>‚Ä¢ –î–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <a href="https://pravatar.cc" target="_blank">pravatar.cc</a></li>
                            <li>‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: 1000</li>
                            <li>‚Ä¢ –ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–≤–∞—Ç–∞—Ä</th>
                            <th>–ò–º—è</th>
                            <th>–†–µ–π—Ç–∏–Ω–≥</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–ü–æ–±–µ–¥</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="playersBody"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="tournaments">
            <h2>üèÖ –¢—É—Ä–Ω–∏—Ä—ã</h2>
            
            <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
            <div class="tournament-generator" id="tournamentGenerator">
                <div class="generator-header" onclick="toggleTournamentGenerator()">
                    <span>üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–æ–≤</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                
                <div class="generator-grid">
                    <div class="generator-section">
                        <h4>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–Ω–∏—Ä–µ</h4>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞:</label>
                            <input type="text" id="tournamentName" placeholder="–í–µ—Å–µ–Ω–Ω–∏–π –∫—É–±–æ–∫ 2024">
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏:</label>
                            <select id="tournamentType">
                                <option value="round_robin_3">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="round_robin_4">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="round_robin_5">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –∏–≥—Ä–æ–∫–æ–≤)</option>
                                <option value="round_robin_6">–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (6 –∏–≥—Ä–æ–∫–æ–≤)</option>
                                <option value="single_elimination_4">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4 –∏–≥—Ä–æ–∫–∞)</option>
                                <option value="single_elimination_8">–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8 –∏–≥—Ä–æ–∫–æ–≤)</option>
                                <option value="double_elimination_4">–î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è (4 –∏–≥—Ä–æ–∫–∞)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="generator-section">
                        <h4>üë• –í—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h4>
                        <div class="player-checkbox-list" id="tournamentPlayersList">
                            <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                            –í—ã–±—Ä–∞–Ω–æ: <span id="selectedPlayersCount">0</span> –∏–≥—Ä–æ–∫–æ–≤
                        </div>
                    </div>
                </div>
                
                <button class="generate-btn" onclick="generateTournament()">
                    üèÜ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                </button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
            <h3>üìã –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤</h3>
            <div class="tournament-grid" id="tournamentsList">
                <!-- –¢—É—Ä–Ω–∏—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <div class="tab-content" id="stats">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            <div class="form-group" style="max-width: 400px;">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</label>
                <select id="statsPlayerSelect" onchange="updatePeriodStats()"></select>
            </div>
            
            <div class="period-stats">
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –Ω–µ–¥–µ–ª—é</h3>
                    <div id="weekStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –º–µ—Å—è—Ü</h3>
                    <div id="monthStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –≥–æ–¥</h3>
                    <div id="yearStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
                <div class="period-box">
                    <h3>üìÖ –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</h3>
                    <div id="allTimeStats">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</div>
                </div>
            </div>
            
            <h3>üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
            <div class="year-progress" id="yearProgress"></div>
            
            <h3>üî• –¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤ –≥–æ–¥–∞</h3>
            <div id="topYearPlayers"></div>
            
            <h3>‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</h3>
            <div class="comparison-container">
                <div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 1:</label>
                        <select id="comparePlayer1"></select>
                    </div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 2:</label>
                        <select id="comparePlayer2"></select>
                    </div>
                    <button class="add-btn action-btn" onclick="comparePlayers()" style="width: 100%;">
                        üîç –°—Ä–∞–≤–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤
                    </button>
                </div>
                <div id="comparisonResult" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°—Ä–∞–≤–Ω–∏—Ç—å"</p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="penalties">
            <h2>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
            <div class="admin-controls" id="penaltiesAdminControls">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–æ–≤ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="penalty-btn action-btn" onclick="checkAndApplyPenalties()">
                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ-—à—Ç—Ä–∞—Ñ—ã
                </button>
                <p><small>–®—Ç—Ä–∞—Ñ: -60 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–µ 14+ –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</small></p>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–®—Ç—Ä–∞—Ñ</th>
                            <th>–î–Ω–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</th>
                            <th>–¢–∏–ø</th>
                        </tr>
                    </thead>
                    <tbody id="penaltiesHistoryBody"></tbody>
                </table>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª–∏ –≤–Ω–∏–∑—É —Å–∞–π—Ç–∞ -->
        <div class="bottom-panels">
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–º (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) -->
            <div class="admin-controls-panel" id="ratingAdminControls">
                <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–º (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h4>
                <button class="penalty-btn action-btn" onclick="checkAndApplyPenalties()">
                    ‚ö†Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ-—à—Ç—Ä–∞—Ñ—ã (14+ –¥–Ω–µ–π = -60)
                </button>
                <button class="add-btn action-btn" onclick="saveManualRatings()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤
                </button>
                <p><small>–ò–∑–º–µ–Ω–∏—Ç–µ –æ—á–∫–∏ –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤"</small></p>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å Supabase -->
            <div class="supabase-panel">
                <div class="supabase-status">
                    <strong>‚òÅÔ∏è Supabase Cloud Sync</strong>
                    <div>–°—Ç–∞—Ç—É—Å: <span id="supabaseStatus" class="status-loading">‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span></div>
                    <div>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="supabaseTime">--:--:--</span></div>
                </div>
                <button class="action-btn add-btn" onclick="loadAllData()" id="refreshBtn">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="admin-panel" id="adminPanel">
                <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä. –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
                <button class="logout-btn" onclick="logoutAdmin()">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º–∞</button>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å –≤—Ö–æ–¥–∞ -->
            <div class="login-panel" id="loginPanel">
                <h3>üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h3>
                <p>–î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –º–∞—Ç—á–µ–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</p>
                <input type="password" id="adminPassword" class="password-input" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                <button class="login-btn" onclick="loginAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE
    // ============================================
    const SUPABASE_URL = 'https://bqycjfcjtdawyrysgrbw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWNqZmNqdGRhd3lyeXNncmJ3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjYwMTk3MCwiZXhwIjoyMDgyMTc3OTcwfQ.lHA_79fw8PSj9ZHMExBpSEIpkonkCYOni7HniGGqadY';
    
    let supabaseClient = null;
    let isSupabaseInitialized = false;
    
    // ============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // ============================================
    let players = {};
    let matches = [];
    let penaltyLog = [];
    let tournaments = [];
    let tournamentMatches = [];
    let tournamentPhotos = [];
    let isAdmin = false;
    const ADMIN_PASSWORD = "admin123";
    
    // ============================================
    // –§–£–ù–ö–¶–ò–ò –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê (–î–û–ë–ê–í–õ–ï–ù–´ –ü–†–û–ü–£–©–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò)
    // ============================================
    function loginAdmin() {
        const password = document.getElementById('adminPassword').value;
        const passwordHash = btoa(password);
        
        if (password === ADMIN_PASSWORD) {
            isAdmin = true;
            document.getElementById('appContainer').classList.add('admin-active');
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            
            document.getElementById('ratingAdminControls').style.display = 'block';
            document.getElementById('matchesAdminControls').style.display = 'block';
            document.getElementById('penaltiesAdminControls').style.display = 'block';
            document.getElementById('playersAdminControls').style.display = 'block';
            
            localStorage.setItem('tennisAdmin', 'true');
            
            updateAllDisplays();
            
            setTimeout(applyAchievementBonuses, 1000);
            
            showNotification('‚úÖ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!', 'success');
        } else {
            showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!', 'error');
        }
    }
    
    function logoutAdmin() {
        isAdmin = false;
        document.getElementById('appContainer').classList.remove('admin-active');
        document.getElementById('loginPanel').style.display = 'block';
        
        document.getElementById('ratingAdminControls').style.display = 'none';
        document.getElementById('matchesAdminControls').style.display = 'none';
        document.getElementById('penaltiesAdminControls').style.display = 'none';
        document.getElementById('playersAdminControls').style.display = 'none';
        
        localStorage.removeItem('tennisAdmin');
        
        updateAllDisplays();
        
        showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'info');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ (–µ—Å–ª–∏ –±—ã–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–µ—Å—Å–∏—è)
    function checkAutoLogin() {
        const saved = localStorage.getItem('tennisAdmin');
        if (saved === 'true') {
            isAdmin = true;
            document.getElementById('appContainer').classList.add('admin-active');
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('ratingAdminControls').style.display = 'block';
            document.getElementById('matchesAdminControls').style.display = 'block';
            document.getElementById('penaltiesAdminControls').style.display = 'block';
            document.getElementById('playersAdminControls').style.display = 'block';
        }
    }
    
    // ============================================
    // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–£–†–ù–ò–†–û–í –° –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ú –†–ê–°–ü–ò–°–ê–ù–ò–ï–ú
    // ============================================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function toggleTournamentGenerator() {
        const generator = document.getElementById('tournamentGenerator');
        generator.classList.toggle('expanded');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤ –∏–∑ Supabase
    async function loadTournaments() {
        if (!supabaseClient) return;
        
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä—ã
            const { data: tournamentsData, error: tournamentsError } = await supabaseClient
                .from('tournaments')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (tournamentsError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', tournamentsError);
                return;
            }
            
            tournaments = tournamentsData || [];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            const { data: tournamentMatchesData, error: tournamentMatchesError } = await supabaseClient
                .from('tournament_matches')
                .select('*');
            
            if (tournamentMatchesError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π —Ç—É—Ä–Ω–∏—Ä–æ–≤:', tournamentMatchesError);
            } else {
                tournamentMatches = tournamentMatchesData || [];
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤
            const { data: tournamentPhotosData, error: tournamentPhotosError } = await supabaseClient
                .from('tournament_photos')
                .select('*');
            
            if (tournamentPhotosError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', tournamentPhotosError);
            } else {
                tournamentPhotos = tournamentPhotosData || [];
            }
            
            console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${tournaments.length} —Ç—É—Ä–Ω–∏—Ä–æ–≤`);
            updateTournamentsDisplay();
            updateTournamentPlayersList();
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function updateTournamentPlayersList() {
        const container = document.getElementById('tournamentPlayersList');
        if (!container) return;
        
        const playerNames = Object.keys(players).sort();
        
        let html = '';
        playerNames.forEach(playerName => {
            const player = players[playerName];
            html += `
                <div class="player-checkbox-item">
                    <input type="checkbox" id="player_${playerName}" value="${playerName}" 
                           onchange="updateSelectedPlayersCount()">
                    <img src="${player.avatar}" 
                         onerror="this.src='https://i.pravatar.cc/150?img=3'}" 
                         style="width: 30px; height: 30px; border-radius: 50%;">
                    <label for="player_${playerName}" style="flex: 1; cursor: pointer;">
                        ${playerName}
                    </label>
                    <span style="color: #4CAF50; font-weight: bold;">${player.rating}</span>
                </div>
            `;
        });
        
        container.innerHTML = html;
        updateSelectedPlayersCount();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    function updateSelectedPlayersCount() {
        const selectedCount = document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked').length;
        document.getElementById('selectedPlayersCount').textContent = selectedCount;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    async function generateTournament() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        const tournamentName = document.getElementById('tournamentName').value.trim();
        const tournamentType = document.getElementById('tournamentType').value;
        
        if (!tournamentName) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
        const selectedPlayers = Array.from(
            document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]:checked')
        ).map(checkbox => checkbox.value);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
        let requiredPlayers = 0;
        let tournamentTypeName = '';
        
        switch(tournamentType) {
            case 'round_robin_3':
                requiredPlayers = 3;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (3 –∏–≥—Ä–æ–∫–∞)';
                if (selectedPlayers.length !== 3) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 3 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'round_robin_4':
                requiredPlayers = 4;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (4 –∏–≥—Ä–æ–∫–∞)';
                if (selectedPlayers.length !== 4) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 4 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'round_robin_5':
                requiredPlayers = 5;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (5 –∏–≥—Ä–æ–∫–æ–≤)';
                if (selectedPlayers.length !== 5) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 5 –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
                    return;
                }
                break;
            case 'round_robin_6':
                requiredPlayers = 6;
                tournamentTypeName = '–ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (6 –∏–≥—Ä–æ–∫–æ–≤)';
                if (selectedPlayers.length !== 6) {
                    showNotification(`–î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 6 –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
                    return;
                }
                break;
            case 'single_elimination_4':
                requiredPlayers = 4;
                tournamentTypeName = '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (4 –∏–≥—Ä–æ–∫–∞)';
                if (selectedPlayers.length !== 4) {
                    showNotification(`–î–ª—è –æ–ª–∏–º–ø–∏–π—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 4 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            case 'single_elimination_8':
                requiredPlayers = 8;
                tournamentTypeName = '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (8 –∏–≥—Ä–æ–∫–æ–≤)';
                if (selectedPlayers.length !== 8) {
                    showNotification(`–î–ª—è –æ–ª–∏–º–ø–∏–π—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 8 –∏–≥—Ä–æ–∫–æ–≤!`, 'error');
                    return;
                }
                break;
            case 'double_elimination_4':
                requiredPlayers = 4;
                tournamentTypeName = '–î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è (4 –∏–≥—Ä–æ–∫–∞)';
                if (selectedPlayers.length !== 4) {
                    showNotification(`–î–ª—è –¥–≤–æ–π–Ω–æ–π —ç–ª–∏–º–∏–Ω–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 4 –∏–≥—Ä–æ–∫–∞!`, 'error');
                    return;
                }
                break;
            default:
                showNotification('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞!', 'error');
                return;
        }
        
        // –°–æ–∑–¥–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
        const newTournament = {
            id: Date.now().toString(),
            name: tournamentName,
            type: tournamentType,
            type_name: tournamentTypeName,
            players: selectedPlayers,
            status: 'active',
            created_at: new Date().toISOString(),
            winner: null,
            final_match_id: null
        };
        
        try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            const { error } = await supabaseClient
                .from('tournaments')
                .insert({
                    id: newTournament.id,
                    name: newTournament.name,
                    type: newTournament.type,
                    type_name: newTournament.type_name,
                    players: newTournament.players,
                    status: newTournament.status,
                    created_at: newTournament.created_at,
                    winner: newTournament.winner,
                    final_match_id: newTournament.final_match_id
                });
            
            if (error) throw error;
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—á–∏ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ (–° –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ú –†–ê–°–ü–ò–°–ê–ù–ò–ï–ú)
            const tournamentMatches = generateTournamentMatches(newTournament);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Ç—á–∏ –≤ Supabase
            for (const match of tournamentMatches) {
                await supabaseClient
                    .from('tournament_matches')
                    .insert({
                        id: match.id,
                        tournament_id: newTournament.id,
                        round: match.round,
                        match_number: match.match_number,
                        player1: match.player1,
                        player2: match.player2,
                        winner: match.winner,
                        score: match.score,
                        player1_games: match.player1_games || 0,
                        player2_games: match.player2_games || 0,
                        player1_points: match.player1_points || 0,
                        player2_points: match.player2_points || 0,
                        is_final: match.is_final || false,
                        status: match.status
                    });
            }
            
            tournaments.unshift(newTournament);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateTournamentsDisplay();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('tournamentName').value = '';
            document.querySelectorAll('#tournamentPlayersList input[type="checkbox"]').forEach(cb => cb.checked = false);
            updateSelectedPlayersCount();
            
            showNotification(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${tournamentName}" —Å–æ–∑–¥–∞–Ω!`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Ç—á–µ–π —Ç—É—Ä–Ω–∏—Ä–∞ —Å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
    function generateTournamentMatches(tournament) {
        const matches = [];
        const players = tournament.players;
        
        switch(tournament.type) {
            case 'round_robin_3':
            case 'round_robin_4':
            case 'round_robin_5':
            case 'round_robin_6':
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
                const optimizedMatches = generateRoundRobinSchedule(players);
                
                // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—á–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º
                optimizedMatches.forEach((match, index) => {
                    matches.push({
                        id: `${tournament.id}_match_${index + 1}`,
                        tournament_id: tournament.id,
                        round: match.round || Math.floor(index / Math.ceil(players.length / 2)) + 1,
                        match_number: index + 1,
                        player1: match.player1,
                        player2: match.player2,
                        winner: null,
                        score: null,
                        player1_games: 0,
                        player2_games: 0,
                        player1_points: 0,
                        player2_points: 0,
                        is_final: false,
                        status: 'scheduled'
                    });
                });
                break;
                
            case 'single_elimination_4':
                // –û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤
                matches.push(
                    {
                        id: `${tournament.id}_semifinal_1`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 1,
                        player1: players[0],
                        player2: players[1],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    },
                    {
                        id: `${tournament.id}_semifinal_2`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 2,
                        player1: players[2],
                        player2: players[3],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    },
                    {
                        id: `${tournament.id}_final`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 3,
                        player1: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                        player2: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                        winner: null,
                        score: null,
                        is_final: true,
                        status: 'scheduled'
                    }
                );
                break;
                
            case 'single_elimination_8':
                // –û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è 8 –∏–≥—Ä–æ–∫–æ–≤ (—á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª—ã, –ø–æ–ª—É—Ñ–∏–Ω–∞–ª—ã, —Ñ–∏–Ω–∞–ª)
                for (let i = 0; i < 4; i++) {
                    matches.push({
                        id: `${tournament.id}_quarterfinal_${i + 1}`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: i + 1,
                        player1: players[i * 2],
                        player2: players[i * 2 + 1],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    });
                }
                
                for (let i = 0; i < 2; i++) {
                    matches.push({
                        id: `${tournament.id}_semifinal_${i + 1}`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 5 + i,
                        player1: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ —á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª–æ–≤
                        player2: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ —á–µ—Ç–≤–µ—Ä—Ç—å—Ñ–∏–Ω–∞–ª–æ–≤
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled'
                    });
                }
                
                matches.push({
                    id: `${tournament.id}_final`,
                    tournament_id: tournament.id,
                    round: 3,
                    match_number: 7,
                    player1: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                    player2: null, // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–æ–≤
                    winner: null,
                    score: null,
                    is_final: true,
                    status: 'scheduled'
                });
                break;
                
            case 'double_elimination_4':
                // –î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤
                matches.push(
                    {
                        id: `${tournament.id}_upper_1`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 1,
                        player1: players[0],
                        player2: players[1],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'upper'
                    },
                    {
                        id: `${tournament.id}_upper_2`,
                        tournament_id: tournament.id,
                        round: 1,
                        match_number: 2,
                        player1: players[2],
                        player2: players[3],
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'upper'
                    },
                    {
                        id: `${tournament.id}_lower_1`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 3,
                        player1: null, // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π –∏–∑ upper_1
                        player2: null, // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π –∏–∑ upper_2
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'lower'
                    },
                    {
                        id: `${tournament.id}_upper_final`,
                        tournament_id: tournament.id,
                        round: 2,
                        match_number: 4,
                        player1: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å upper_1
                        player2: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å upper_2
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'upper'
                    },
                    {
                        id: `${tournament.id}_lower_final`,
                        tournament_id: tournament.id,
                        round: 3,
                        match_number: 5,
                        player1: null, // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π upper_final
                        player2: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å lower_1
                        winner: null,
                        score: null,
                        is_final: false,
                        status: 'scheduled',
                        bracket: 'lower'
                    },
                    {
                        id: `${tournament.id}_grand_final`,
                        tournament_id: tournament.id,
                        round: 4,
                        match_number: 6,
                        player1: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å upper_final
                        player2: null, // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å lower_final
                        winner: null,
                        score: null,
                        is_final: true,
                        status: 'scheduled',
                        bracket: 'grand'
                    }
                );
                break;
        }
        
        return matches;
    }
    
    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ —Å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
    function generateRoundRobinSchedule(players) {
        const matches = [];
        const playerCount = players.length;
        
        if (playerCount === 3) {
            // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 3 –∏–≥—Ä–æ–∫–æ–≤
            // –ò–≥—Ä–æ–∫–∏: A, B, C
            // –†–∞—É–Ω–¥ 1: A vs B (C –æ—Ç–¥—ã—Ö–∞–µ—Ç)
            // –†–∞—É–Ω–¥ 2: A vs C (B –æ—Ç–¥—ã—Ö–∞–µ—Ç)
            // –†–∞—É–Ω–¥ 3: B vs C (A –æ—Ç–¥—ã—Ö–∞–µ—Ç)
            matches.push(
                { player1: players[0], player2: players[1], round: 1 },
                { player1: players[0], player2: players[2], round: 2 },
                { player1: players[1], player2: players[2], round: 3 }
            );
        }
        else if (playerCount === 4) {
            // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤ (–ë–µ—Ä–≥–µ—Ä —Ç–∞–±–ª–∏—Ü–∞)
            // –ò–≥—Ä–æ–∫–∏: A, B, C, D
            matches.push(
                // –†–∞—É–Ω–¥ 1: A-D, B-C
                { player1: players[0], player2: players[3], round: 1 },
                { player1: players[1], player2: players[2], round: 1 },
                // –†–∞—É–Ω–¥ 2: A-C, D-B
                { player1: players[0], player2: players[2], round: 2 },
                { player1: players[3], player2: players[1], round: 2 },
                // –†–∞—É–Ω–¥ 3: A-B, C-D
                { player1: players[0], player2: players[1], round: 3 },
                { player1: players[2], player2: players[3], round: 3 }
            );
        }
        else if (playerCount === 5) {
            // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 5 –∏–≥—Ä–æ–∫–æ–≤
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–≥—Ä–æ–∫–æ–º –∏ "BYE" (–æ—Ç–¥—ã—Ö–æ–º)
            const playersWithBye = [...players, "BYE"]; // 6 "–∏–≥—Ä–æ–∫–æ–≤" –≤–∫–ª—é—á–∞—è –æ—Ç–¥—ã—Ö
            
            for (let round = 0; round < playerCount; round++) {
                const roundMatches = [];
                
                // –§–∏–∫—Å–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                for (let i = 1; i < playersWithBye.length / 2; i++) {
                    const playerA = playersWithBye[i];
                    const playerB = playersWithBye[playersWithBye.length - i];
                    
                    if (playerA !== "BYE" && playerB !== "BYE") {
                        roundMatches.push({
                            player1: playerA,
                            player2: playerB,
                            round: round + 1
                        });
                    }
                }
                
                // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫ –∏–≥—Ä–∞–µ—Ç —Å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º
                const fixedPlayer = playersWithBye[0];
                const centerPlayer = playersWithBye[playersWithBye.length / 2];
                
                if (fixedPlayer !== "BYE" && centerPlayer !== "BYE") {
                    roundMatches.push({
                        player1: fixedPlayer,
                        player2: centerPlayer,
                        round: round + 1
                    });
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ç—á–∏ —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞
                matches.push(...roundMatches);
                
                // –í—Ä–∞—â–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ (–∫—Ä–æ–º–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ)
                const last = playersWithBye.pop();
                playersWithBye.splice(1, 0, last);
            }
        }
        else if (playerCount === 6) {
            // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 6 –∏–≥—Ä–æ–∫–æ–≤
            // –ò–≥—Ä–æ–∫–∏: A, B, C, D, E, F
            matches.push(
                // –†–∞—É–Ω–¥ 1: A-F, B-E, C-D
                { player1: players[0], player2: players[5], round: 1 },
                { player1: players[1], player2: players[4], round: 1 },
                { player1: players[2], player2: players[3], round: 1 },
                
                // –†–∞—É–Ω–¥ 2: A-E, F-D, B-C
                { player1: players[0], player2: players[4], round: 2 },
                { player1: players[5], player2: players[3], round: 2 },
                { player1: players[1], player2: players[2], round: 2 },
                
                // –†–∞—É–Ω–¥ 3: A-D, E-C, F-B
                { player1: players[0], player2: players[3], round: 3 },
                { player1: players[4], player2: players[2], round: 3 },
                { player1: players[5], player2: players[1], round: 3 },
                
                // –†–∞—É–Ω–¥ 4: A-C, D-B, E-F
                { player1: players[0], player2: players[2], round: 4 },
                { player1: players[3], player2: players[1], round: 4 },
                { player1: players[4], player2: players[5], round: 4 },
                
                // –†–∞—É–Ω–¥ 5: A-B, C-F, D-E
                { player1: players[0], player2: players[1], round: 5 },
                { player1: players[2], player2: players[5], round: 5 },
                { player1: players[3], player2: players[4], round: 5 }
            );
        }
        else {
            // –û–±—â–∏–π —Å–ª—É—á–∞–π –¥–ª—è –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
            // –°–æ–∑–¥–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–∞—Ä—ã
            const allPairs = [];
            for (let i = 0; i < players.length; i++) {
                for (let j = i + 1; j < players.length; j++) {
                    allPairs.push({
                        player1: players[i],
                        player2: players[j]
                    });
                }
            }
            
            // –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–∞—É–Ω–¥–∞–º
            let round = 1;
            let matchesInRound = 0;
            const maxMatchesPerRound = Math.floor(players.length / 2);
            
            allPairs.forEach(pair => {
                matches.push({
                    player1: pair.player1,
                    player2: pair.player2,
                    round: round
                });
                
                matchesInRound++;
                if (matchesInRound >= maxMatchesPerRound) {
                    round++;
                    matchesInRound = 0;
                }
            });
        }
        
        return matches;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    function checkScheduleQuality(schedule, players) {
        console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è", players.length, "–∏–≥—Ä–æ–∫–æ–≤");
        
        const playerStats = {};
        players.forEach(player => {
            playerStats[player] = {
                matches: 0,
                consecutiveMatches: 0,
                maxConsecutive: 0,
                currentConsecutive: 0,
                lastMatchRound: -1,
                breaks: 0
            };
        });
        
        // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —Ä–∞—É–Ω–¥–∞–º
        schedule.forEach((match, index) => {
            const round = match.round || Math.floor(index / Math.ceil(players.length / 2)) + 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∏–≥—Ä–æ–∫–∞ 1
            updatePlayerMatchStats(playerStats[match.player1], round);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∏–≥—Ä–æ–∫–∞ 2
            updatePlayerMatchStats(playerStats[match.player2], round);
        });
        
        // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        players.forEach(player => {
            const stats = playerStats[player];
            console.log(`üë§ ${player}: ${stats.matches} –º–∞—Ç—á–µ–π, –º–∞–∫—Å–∏–º—É–º –ø–æ–¥—Ä—è–¥: ${stats.maxConsecutive}, –ø–µ—Ä–µ—Ä—ã–≤–æ–≤: ${stats.breaks}`);
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–≥—Ä–æ–∫–∏ —Å 3+ –º–∞—Ç—á–∞–º–∏ –ø–æ–¥—Ä—è–¥
        const playersWith3Consecutive = players.filter(player => 
            playerStats[player].maxConsecutive >= 3
        );
        
        if (playersWith3Consecutive.length > 0) {
            console.warn(`‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–≥—Ä–æ–∫–∏ —Å 3+ –º–∞—Ç—á–∞–º–∏ –ø–æ–¥—Ä—è–¥:`, playersWith3Consecutive);
            return false;
        }
        
        console.log("‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ!");
        return true;
    }
    
    function updatePlayerMatchStats(stats, round) {
        stats.matches++;
        
        if (stats.lastMatchRound === round - 1) {
            // –ò–≥—Ä–æ–∫ –∏–≥—Ä–∞–ª –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ä–∞—É–Ω–¥–µ
            stats.currentConsecutive++;
            stats.maxConsecutive = Math.max(stats.maxConsecutive, stats.currentConsecutive);
        } else if (stats.lastMatchRound >= 0) {
            // –£ –∏–≥—Ä–æ–∫–∞ –±—ã–ª –ø–µ—Ä–µ—Ä—ã–≤
            stats.breaks++;
            stats.currentConsecutive = 1;
        } else {
            // –ü–µ—Ä–≤—ã–π –º–∞—Ç—á –∏–≥—Ä–æ–∫–∞
            stats.currentConsecutive = 1;
        }
        
        stats.lastMatchRound = round;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function updateTournamentsDisplay() {
        const container = document.getElementById('tournamentsList');
        if (!container) return;
        
        if (tournaments.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: #f8f9fa; border-radius: 12px;">
                    <h3 style="color: #666; margin-bottom: 15px;">üèì –¢—É—Ä–Ω–∏—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p style="color: #888;">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç—É—Ä–Ω–∏—Ä —Å –ø–æ–º–æ—â—å—é –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –≤—ã—à–µ!</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        tournaments.forEach(tournament => {
            const tournamentMatchesCount = tournamentMatches.filter(m => m.tournament_id === tournament.id).length;
            const completedMatches = tournamentMatches.filter(m => m.tournament_id === tournament.id && m.winner).length;
            const winner = tournament.winner ? players[tournament.winner] : null;
            
            // –ù–∞—Ö–æ–¥–∏–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
            const tournamentPhoto = tournamentPhotos.find(p => p.tournament_id === tournament.id);
            
            html += `
                <div class="tournament-card ${winner ? 'winner' : ''}">
                    <div class="tournament-header">
                        <div class="tournament-name">${tournament.name}</div>
                        <div class="tournament-type">${tournament.type_name}</div>
                    </div>
                    
                    ${tournamentPhoto ? `
                        <div style="margin: 15px 0; border-radius: 8px; overflow: hidden;">
                            <img src="${tournamentPhoto.photo_url}" 
                                 style="width: 100%; height: 150px; object-fit: cover;"
                                 onerror="this.style.display='none'">
                        </div>
                    ` : ''}
                    
                    <div class="tournament-stats">
                        <div class="stat-item">
                            <div class="stat-value-large">${tournament.players.length}</div>
                            <div class="stat-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-large">${completedMatches}/${tournamentMatchesCount}</div>
                            <div class="stat-label">–ú–∞—Ç—á–µ–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-large">${tournament.status === 'completed' ? 'üèÅ' : 'üèÉ'}</div>
                            <div class="stat-label">–°—Ç–∞—Ç—É—Å</div>
                        </div>
                    </div>
                    
                    ${winner ? `
                        <div class="tournament-winner">
                            <img src="${winner.avatar}" class="winner-avatar" 
                                 onerror="this.src='https://i.pravatar.cc/150?img=3'}">
                            <div class="winner-info">
                                <div class="winner-label">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</div>
                                <div class="winner-name">${tournament.winner}</div>
                            </div>
                        </div>
                    ` : `
                        <div style="padding: 10px; background: #e8f5e9; border-radius: 8px; margin-top: 15px; text-align: center;">
                            ‚è≥ –¢—É—Ä–Ω–∏—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
                        </div>
                    `}
                    
                    <div class="tournament-actions">
                        <button class="view-tournament-btn" onclick="viewTournament('${tournament.id}')">
                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                        ${isAdmin ? `
                            <button class="delete-tournament-btn" onclick="deleteTournament('${tournament.id}')">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–∞
    function viewTournament(tournamentId) {
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—É—Ä–Ω–∏—Ä–∞
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('tournamentPageContainer').style.display = 'block';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—É—Ä–Ω–∏—Ä–µ
        document.getElementById('tournamentPageName').textContent = tournament.name;
        
        const metaContainer = document.getElementById('tournamentPageMeta');
        metaContainer.innerHTML = `
            <div>üé≤ –¢–∏–ø: ${tournament.type_name}</div>
            <div>üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${tournament.players.length}</div>
            <div>üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date(tournament.created_at).toLocaleDateString('ru-RU')}</div>
            <div>üèÅ –°—Ç–∞—Ç—É—Å: ${tournament.status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</div>
        `;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        const winnerSection = document.getElementById('tournamentWinnerSection');
        if (tournament.winner) {
            const winner = players[tournament.winner];
            winnerSection.innerHTML = `
                <div style="display: flex; align-items: center; gap: 20px; padding: 20px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 12px; color: #333;">
                    <div style="font-size: 3em;">üèÜ</div>
                    <div style="flex: 1;">
                        <div style="font-size: 1.5em; font-weight: bold;">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å —Ç—É—Ä–Ω–∏—Ä–∞</div>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            <img src="${winner.avatar}" style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid white;"
                                 onerror="this.src='https://i.pravatar.cc/150?img=3'}">
                            <div>
                                <div style="font-size: 1.8em; font-weight: bold;">${tournament.winner}</div>
                                <div style="font-size: 1.2em; color: #2E7D32;">–†–µ–π—Ç–∏–Ω–≥: ${winner.rating}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            winnerSection.style.display = 'block';
        } else {
            winnerSection.style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
        const tournamentPhoto = tournamentPhotos.find(p => p.tournament_id === tournament.id);
        const photoContainer = document.getElementById('tournamentPhotoContainer');
        const photoElement = document.getElementById('tournamentPhoto');
        const photoPlaceholder = document.getElementById('tournamentPhotoPlaceholder');
        
        if (tournamentPhoto) {
            photoElement.src = tournamentPhoto.photo_url;
            photoElement.style.display = 'block';
            photoPlaceholder.style.display = 'none';
        } else {
            photoElement.style.display = 'none';
            photoPlaceholder.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        document.getElementById('uploadPhotoBtn').style.display = isAdmin ? 'block' : 'none';
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä–Ω—É—é —Å–µ—Ç–∫–∏
        displayTournamentBracket(tournament);
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞ (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
        displayTournamentMatches(tournament);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        photoElement.dataset.tournamentId = tournament.id;
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.scrollTo(0, 0);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
    function displayTournamentBracket(tournament) {
        const container = document.getElementById('tournamentBracket');
        if (!container) return;
        
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id);
        
        if (tournament.type.includes('round_robin')) {
            // –ö—Ä—É–≥–æ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            displayRoundRobinTable(tournament, container, matches);
        } else {
            // –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ–±–∫–∏
            displayBracket(tournament, container, matches);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function displayRoundRobinTable(tournament, container, matches) {
        const players = tournament.players;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        const stats = {};
        players.forEach(player => {
            stats[player] = {
                wins: 0,
                losses: 0,
                games_won: 0,
                games_lost: 0,
                points_won: 0,
                points_lost: 0,
                matches_played: 0
            };
        });
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –º–∞—Ç—á–µ–π
        matches.forEach(match => {
            if (match.winner) {
                if (match.winner === match.player1) {
                    stats[match.player1].wins++;
                    stats[match.player2].losses++;
                } else if (match.winner === match.player2) {
                    stats[match.player2].wins++;
                    stats[match.player1].losses++;
                }
                
                stats[match.player1].games_won += (match.player1_games || 0);
                stats[match.player1].games_lost += (match.player2_games || 0);
                stats[match.player2].games_won += (match.player2_games || 0);
                stats[match.player2].games_lost += (match.player1_games || 0);
                
                stats[match.player1].points_won += (match.player1_points || 0);
                stats[match.player1].points_lost += (match.player2_points || 0);
                stats[match.player2].points_won += (match.player2_points || 0);
                stats[match.player2].points_lost += (match.player1_points || 0);
                
                stats[match.player1].matches_played++;
                stats[match.player2].matches_played++;
            }
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–±–µ–¥, –∑–∞—Ç–µ–º –ø–æ —Ä–∞–∑–Ω–∏—Ü–µ –ø–∞—Ä—Ç–∏–π, –∑–∞—Ç–µ–º –ø–æ —Ä–∞–∑–Ω–∏—Ü–µ –æ—á–∫–æ–≤
        const sortedPlayers = [...players].sort((a, b) => {
            const statA = stats[a];
            const statB = stats[b];
            
            // –ü–æ –ø–æ–±–µ–¥–∞–º
            if (statB.wins !== statA.wins) {
                return statB.wins - statA.wins;
            }
            
            // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –ø–∞—Ä—Ç–∏–π
            const gamesDiffA = statA.games_won - statA.games_lost;
            const gamesDiffB = statB.games_won - statB.games_lost;
            if (gamesDiffB !== gamesDiffA) {
                return gamesDiffB - gamesDiffA;
            }
            
            // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –æ—á–∫–æ–≤
            const pointsDiffA = statA.points_won - statA.points_lost;
            const pointsDiffB = statB.points_won - statB.points_lost;
            return pointsDiffB - pointsDiffA;
        });
        
        let html = `
            <h3>üèì –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h3>
            <div class="table-container">
                <table class="round-robin-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–ú–∞—Ç—á–∏</th>
                            <th>–í-–ü</th>
                            <th>–ü–∞—Ä—Ç–∏–∏ +/-</th>
                            <th>–û—á–∫–∏ +/-</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        sortedPlayers.forEach((player, index) => {
            const stat = stats[player];
            const gamesDiff = stat.games_won - stat.games_lost;
            const pointsDiff = stat.points_won - stat.points_lost;
            
            html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="player-cell" onclick="showPlayerProfile('${player}')" style="cursor: pointer;">
                            <img src="${players[player]?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 class="avatar" style="width: 32px; height: 32px;">
                            <span>${player}</span>
                        </div>
                    </td>
                    <td>${stat.matches_played}</td>
                    <td>${stat.wins}-${stat.losses}</td>
                    <td>${gamesDiff > 0 ? '+' : ''}${gamesDiff}</td>
                    <td>${pointsDiff > 0 ? '+' : ''}${pointsDiff}</td>
                    <td>
                        <button class="action-btn add-btn" onclick="enterMatchResult('${tournament.id}', '${player}')" 
                                ${!isAdmin ? 'disabled style="opacity: 0.5;"' : ''}>
                            ‚úèÔ∏è –í–Ω–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        </button>
                    </td>
                </tr>
            `;
        });
        
        html += `
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h4>üìä –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç:</h4>
                <ol style="margin-left: 20px;">
                    <li>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥</li>
                    <li>–†–∞–∑–Ω–∏—Ü–∞ –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–≥—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π</li>
                    <li>–†–∞–∑–Ω–∏—Ü–∞ –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–≥—Ä–∞–Ω–Ω—ã—Ö –æ—á–∫–æ–≤</li>
                    <li>–õ–∏—á–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)</li>
                </ol>
                <p style="margin-top: 10px; color: #666;">
                    <strong>–§–∏–Ω–∞–ª–∏—Å—Ç—ã:</strong> –î–≤–æ–µ –ª—É—á—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤—ã—Ö–æ–¥—è—Ç –≤ —Ñ–∏–Ω–∞–ª
                </p>
            </div>
        `;
        
        container.innerHTML = html;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
    function displayBracket(tournament, container, matches) {
        let html = '<h3>üèÜ –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞</h3>';
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ —Ä–∞—É–Ω–¥–∞–º
        const rounds = {};
        matches.forEach(match => {
            if (!rounds[match.round]) {
                rounds[match.round] = [];
            }
            rounds[match.round].push(match);
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞—É–Ω–¥—ã
        const sortedRounds = Object.keys(rounds).sort((a, b) => a - b);
        
        html += '<div class="bracket-container">';
        
        sortedRounds.forEach(roundNum => {
            const roundMatches = rounds[roundNum];
            
            html += `
                <div class="bracket-round">
                    <div style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #4CAF50;">
                        ${getRoundName(parseInt(roundNum), tournament.type)}
                    </div>
            `;
            
            roundMatches.forEach(match => {
                const player1 = match.player1 ? players[match.player1] : null;
                const player2 = match.player2 ? players[match.player2] : null;
                
                html += `
                    <div class="bracket-match ${match.is_final ? 'final' : ''}">
                        <div class="bracket-player ${match.winner === match.player1 ? 'winner' : ''}">
                            <span>${player1 ? player1.name || match.player1 : 'TBD'}</span>
                            ${match.score ? `<span class="player-score">${getPlayerScore(match, 1)}</span>` : ''}
                        </div>
                        <div style="text-align: center; margin: 5px 0; font-weight: bold; color: #666;">vs</div>
                        <div class="bracket-player ${match.winner === match.player2 ? 'winner' : ''}">
                            <span>${player2 ? player2.name || match.player2 : 'TBD'}</span>
                            ${match.score ? `<span class="player-score">${getPlayerScore(match, 2)}</span>` : ''}
                        </div>
                        ${match.winner ? `
                            <div style="text-align: center; margin-top: 10px; padding: 5px; background: #4CAF50; color: white; border-radius: 4px; font-size: 0.9em;">
                                –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${match.winner}
                            </div>
                        ` : ''}
                        ${isAdmin ? `
                            <div style="text-align: center; margin-top: 10px;">
                                <button class="action-btn add-btn" onclick="enterMatchResult('${tournament.id}', null, '${match.id}')" style="width: 100%; padding: 5px;">
                                    ‚úèÔ∏è –í–Ω–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
        });
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞—É–Ω–¥–∞
    function getRoundName(round, tournamentType) {
        if (tournamentType.includes('single_elimination')) {
            switch(round) {
                case 1: return '1/4 —Ñ–∏–Ω–∞–ª–∞';
                case 2: return '1/2 —Ñ–∏–Ω–∞–ª–∞';
                case 3: return '–§–∏–Ω–∞–ª';
                default: return `–†–∞—É–Ω–¥ ${round}`;
            }
        } else if (tournamentType.includes('double_elimination')) {
            switch(round) {
                case 1: return '–í–µ—Ä—Ö–Ω—è—è —Å–µ—Ç–∫–∞';
                case 2: return '–ù–∏–∂–Ω—è—è —Å–µ—Ç–∫–∞';
                case 3: return '–§–∏–Ω–∞–ª –Ω–∏–∂–Ω–µ–π';
                case 4: return '–ì—Ä–∞–Ω–¥-—Ñ–∏–Ω–∞–ª';
                default: return `–†–∞—É–Ω–¥ ${round}`;
            }
        }
        return `–†–∞—É–Ω–¥ ${round}`;
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
    function getPlayerScore(match, playerNumber) {
        if (!match.score) return '0';
        
        if (playerNumber === 1) {
            return match.player1_games || '0';
        } else {
            return match.player2_games || '0';
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –º–∞—Ç—á–µ–π —Ç—É—Ä–Ω–∏—Ä–∞ (–ê–î–ê–ü–¢–ò–†–û–í–ê–ù–ê –î–õ–Ø –¢–ï–õ–ï–§–û–ù–ê)
    function displayTournamentMatches(tournament) {
        const container = document.getElementById('tournamentMatchesList');
        if (!container) return;
        
        const matches = tournamentMatches
            .filter(m => m.tournament_id === tournament.id)
            .sort((a, b) => {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞—É–Ω–¥–∞–º –∏ –Ω–æ–º–µ—Ä–∞–º –º–∞—Ç—á–µ–π
                if (a.round !== b.round) return a.round - b.round;
                return a.match_number - b.match_number;
            });
        
        if (matches.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">–ú–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
            return;
        }
        
        let html = '';
        
        matches.forEach(match => {
            const player1 = players[match.player1];
            const player2 = players[match.player2];
            
            html += `
                <div class="match-result ${match.is_final ? 'final' : ''}">
                    <div class="match-players">
                        <div class="player-match-info">
                            <img src="${player1?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer;"
                                 onclick="showPlayerProfile('${match.player1}')">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; font-size: 14px;">${match.player1 || 'TBD'}</div>
                                ${match.player1_games !== undefined ? `
                                    <div class="match-details" style="font-size: 12px;">
                                        –ü–∞—Ä—Ç–∏–∏: ${match.player1_games}, –û—á–∫–∏: ${match.player1_points || 0}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="match-vs">vs</div>
                        
                        <div class="player-match-info">
                            <div style="flex: 1; text-align: right;">
                                <div style="font-weight: bold; font-size: 14px;">${match.player2 || 'TBD'}</div>
                                ${match.player2_games !== undefined ? `
                                    <div class="match-details" style="font-size: 12px; text-align: right;">
                                        –ü–∞—Ä—Ç–∏–∏: ${match.player2_games}, –û—á–∫–∏: ${match.player2_points || 0}
                                    </div>
                                ` : ''}
                            </div>
                            <img src="${player2?.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                                 style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer; margin-left: 10px;"
                                 onclick="showPlayerProfile('${match.player2}')">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 5px; margin-top: 10px;">
                        ${match.score ? `
                            <div class="match-score">${match.score}</div>
                            <div class="match-details" style="text-align: center;">
                                ${match.is_final ? '–§–ò–ù–ê–õ' : `–†–∞—É–Ω–¥ ${match.round}`}
                                ${match.winner ? ` ¬∑ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${match.winner}` : ''}
                            </div>
                        ` : `
                            <div style="padding: 5px 15px; background: #ff9800; color: white; border-radius: 20px; font-weight: bold; font-size: 13px;">
                                ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è
                            </div>
                        `}
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–∞—Ç—á–∞ (–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø)
    async function enterMatchResult(tournamentId, playerName, matchId = null) {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–Ω–æ—Å–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!', 'error');
            return;
        }
        
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        let match;
        
        if (matchId) {
            // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–∞—Ç—á
            match = tournamentMatches.find(m => m.id === matchId && m.tournament_id === tournamentId);
        } else if (playerName && tournament.type.includes('round_robin')) {
            // –î–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞—Ö–æ–¥–∏–º –º–∞—Ç—á —Å —É—á–∞—Å—Ç–∏–µ–º –∏–≥—Ä–æ–∫–∞
            
            // –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
            const dialogDiv = document.createElement('div');
            dialogDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const dialogContent = document.createElement('div');
            dialogContent.style.cssText = `
                background: white;
                padding: 25px;
                border-radius: 12px;
                max-width: 500px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ (–∏–≥—Ä–æ–∫–∏ –∏–∑ —Ç—É—Ä–Ω–∏—Ä–∞, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ)
            const possibleOpponents = tournament.players.filter(p => p !== playerName);
            
            let selectHtml = `<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</option>`;
            possibleOpponents.forEach(opponent => {
                selectHtml += `<option value="${opponent}">${opponent}</option>`;
            });
            
            dialogContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –¥–ª—è ${playerName}</h3>
                <div class="form-group">
                    <label>–°–æ–ø–µ—Ä–Ω–∏–∫:</label>
                    <select id="opponentSelect" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                        ${selectHtml}
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button id="cancelBtn" style="flex: 1; padding: 12px; background: #f5f5f5; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button id="confirmBtn" style="flex: 1; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            `;
            
            dialogDiv.appendChild(dialogContent);
            document.body.appendChild(dialogDiv);
            
            // –û–∂–∏–¥–∞–µ–º –≤—ã–±–æ—Ä–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
            return new Promise((resolve) => {
                document.getElementById('cancelBtn').onclick = () => {
                    document.body.removeChild(dialogDiv);
                    resolve();
                };
                
                document.getElementById('confirmBtn').onclick = () => {
                    const opponentSelect = document.getElementById('opponentSelect');
                    const opponent = opponentSelect.value;
                    
                    if (!opponent) {
                        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞!', 'error');
                        return;
                    }
                    
                    // –£–¥–∞–ª—è–µ–º –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ
                    document.body.removeChild(dialogDiv);
                    
                    // –ù–∞—Ö–æ–¥–∏–º –º–∞—Ç—á
                    match = tournamentMatches.find(m => 
                        m.tournament_id === tournamentId &&
                        ((m.player1 === playerName && m.player2 === opponent) ||
                         (m.player1 === opponent && m.player2 === playerName))
                    );
                    
                    if (!match) {
                        showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                        resolve();
                        return;
                    }
                    
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    continueMatchResultEntry(match, tournamentId);
                    resolve();
                };
            });
            
        } else {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞—Ç—á!', 'error');
            return;
        }
        
        if (match) {
            continueMatchResultEntry(match, tournamentId);
        }
    }
    
    // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–∞—Ç—á–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø)
    async function continueMatchResultEntry(match, tournamentId) {
        if (!match) {
            showNotification('–ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }

        // –ù–∞—Ö–æ–¥–∏–º —Ç—É—Ä–Ω–∏—Ä –ø–æ ID
        const tournament = tournaments.find(t => t.id === tournamentId);
        if (!tournament) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }

        if (match.winner) {
            if (!confirm('–†–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≤–Ω–µ—Å–µ–Ω. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å?')) {
                return;
            }
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        const score = prompt(`–í–≤–µ–¥–∏—Ç–µ —Å—á–µ—Ç –º–∞—Ç—á–∞ ${match.player1} vs ${match.player2} (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3:2):`);
        if (!score) return;

        // –ü–∞—Ä—Å–∏–º —Å—á–µ—Ç
        const [player1GamesStr, player2GamesStr] = score.split(':');
        const player1Games = parseInt(player1GamesStr);
        const player2Games = parseInt(player2GamesStr);

        if (isNaN(player1Games) || isNaN(player2Games)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—á–µ—Ç–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç "3:2"', 'error');
            return;
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        let winner;
        if (player1Games > player2Games) {
            winner = match.player1;
        } else if (player2Games > player1Games) {
            winner = match.player2;
        } else {
            winner = 'draw';
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ—á–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–Ω–∏—Ü—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        const pointsInput = prompt('–í–≤–µ–¥–∏—Ç–µ –æ—á–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–Ω–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 11:9,11:8,9:11,11:6,11:7 —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):\n(–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ)');
        
        let player1Points = 0;
        let player2Points = 0;
        
        if (pointsInput) {
            const games = pointsInput.split(',');
            games.forEach(game => {
                const [p1PointsStr, p2PointsStr] = game.split(':');
                const p1Points = parseInt(p1PointsStr) || 0;
                const p2Points = parseInt(p2PointsStr) || 0;
                
                player1Points += p1Points;
                player2Points += p2Points;
            });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á
        match.winner = winner;
        match.score = score;
        match.player1_games = player1Games;
        match.player2_games = player2Games;
        match.player1_points = player1Points;
        match.player2_points = player2Points;
        match.status = 'completed';

        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—á –≤ Supabase
            await supabaseClient
                .from('tournament_matches')
                .update({
                    winner: match.winner,
                    score: match.score,
                    player1_games: match.player1_games,
                    player2_games: match.player2_games,
                    player1_points: match.player1_points,
                    player2_points: match.player2_points,
                    status: match.status
                })
                .eq('id', match.id);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–µ–Ω –ª–∏ —Ç—É—Ä–Ω–∏—Ä
            checkTournamentCompletion(tournament);

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (document.getElementById('tournamentPageContainer').style.display === 'block') {
                viewTournament(tournamentId);
            } else {
                updateTournamentsDisplay();
            }

            showNotification('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');

        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function checkEarlyTournamentFinish(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id && m.winner);
        
        console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ "${tournament.name}"`);
        console.log(`üìä –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π: ${matches.length}`);
        
        // –î–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 3 –∏–≥—Ä–æ–∫–∞
        if (tournament.type === 'round_robin_3' && tournament.players.length === 3) {
            // –í —Ç—É—Ä–Ω–∏—Ä–µ –Ω–∞ 3 –∏–≥—Ä–æ–∫–∞ –≤—Å–µ–≥–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—ã–≥—Ä–∞–Ω–æ 3 –º–∞—Ç—á–∞
            // –ï—Å–ª–∏ –≤—Å–µ 3 –º–∞—Ç—á–∞ —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
            if (matches.length === 3) {
                console.log(`‚úÖ –í—Å–µ 3 –º–∞—Ç—á–∞ —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            // –ï—Å–ª–∏ —Å—ã–≥—Ä–∞–Ω–æ 2 –º–∞—Ç—á–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            if (matches.length === 2) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥
                const winStats = {};
                tournament.players.forEach(player => {
                    winStats[player] = 0;
                });
                
                // –°—á–∏—Ç–∞–µ–º –ø–æ–±–µ–¥—ã
                matches.forEach(match => {
                    if (match.winner && match.winner !== 'draw') {
                        winStats[match.winner]++;
                    }
                });
                
                console.log(`üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–±–µ–¥:`, winStats);
                
                // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥
                const maxWins = Math.max(...Object.values(winStats));
                const playersWithMaxWins = Object.keys(winStats).filter(p => winStats[p] === maxWins);
                
                // –ï—Å–ª–∏ —É –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ 2 –ø–æ–±–µ–¥—ã, –æ–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º –º–æ–≥—É—Ç –∏–º–µ—Ç—å 1 –ø–æ–±–µ–¥—É)
                if (maxWins === 2) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${playersWithMaxWins[0]} –≤—ã–∏–≥—Ä–∞–ª 2 –º–∞—Ç—á–∞ –∏–∑ 2. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
        }
        
        // –î–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 4 –∏–≥—Ä–æ–∫–∞
        if (tournament.type === 'round_robin_4' && tournament.players.length === 4) {
            // –ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω —Å—ã–≥—Ä–∞—Ç—å 3 –º–∞—Ç—á–∞ (–≤—Å–µ–≥–æ 6 –º–∞—Ç—á–µ–π)
            // –ï—Å–ª–∏ –≤—Å–µ 6 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
            if (matches.length === 6) {
                console.log(`‚úÖ –í—Å–µ 6 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥
            const winStats = {};
            tournament.players.forEach(player => {
                winStats[player] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–≥—Ä–æ–∫ —Å 3 –ø–æ–±–µ–¥–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–µ 4 –∏–≥—Ä–æ–∫–æ–≤)
            for (const player in winStats) {
                if (winStats[player] === 3) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${player} –≤—ã–∏–≥—Ä–∞–ª –≤—Å–µ 3 –º–∞—Ç—á–∞. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–≥–Ω–∞—Ç—å –ª–∏–¥–µ—Ä–∞
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedPlayers = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedPlayers.length >= 2) {
                    const [leader, leaderWins] = sortedPlayers[0];
                    const [second, secondWins] = sortedPlayers[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    // –ï—Å–ª–∏ –ª–∏–¥–µ—Ä–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–≥–Ω–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –≤—ã–∏–≥—Ä–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∞—Ç—á–∏
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        // –î–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 5 –∏–≥—Ä–æ–∫–æ–≤
        if (tournament.type === 'round_robin_5' && tournament.players.length === 5) {
            // –ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω —Å—ã–≥—Ä–∞—Ç—å 4 –º–∞—Ç—á–∞ (–≤—Å–µ–≥–æ 10 –º–∞—Ç—á–µ–π)
            // –ï—Å–ª–∏ –≤—Å–µ 10 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
            if (matches.length === 10) {
                console.log(`‚úÖ –í—Å–µ 10 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥
            const winStats = {};
            tournament.players.forEach(player => {
                winStats[player] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–≥—Ä–æ–∫ —Å 4 –ø–æ–±–µ–¥–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–µ 5 –∏–≥—Ä–æ–∫–æ–≤)
            for (const player in winStats) {
                if (winStats[player] === 4) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${player} –≤—ã–∏–≥—Ä–∞–ª –≤—Å–µ 4 –º–∞—Ç—á–∞. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–≥–Ω–∞—Ç—å –ª–∏–¥–µ—Ä–∞
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedPlayers = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedPlayers.length >= 2) {
                    const [leader, leaderWins] = sortedPlayers[0];
                    const [second, secondWins] = sortedPlayers[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    // –ï—Å–ª–∏ –ª–∏–¥–µ—Ä–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–≥–Ω–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –≤—ã–∏–≥—Ä–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∞—Ç—á–∏
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        // –î–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–∞ 6 –∏–≥—Ä–æ–∫–æ–≤
        if (tournament.type === 'round_robin_6' && tournament.players.length === 6) {
            // –ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω —Å—ã–≥—Ä–∞—Ç—å 5 –º–∞—Ç—á–µ–π (–≤—Å–µ–≥–æ 15 –º–∞—Ç—á–µ–π)
            // –ï—Å–ª–∏ –≤—Å–µ 15 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
            if (matches.length === 15) {
                console.log(`‚úÖ –í—Å–µ 15 –º–∞—Ç—á–µ–π —Å—ã–≥—Ä–∞–Ω—ã, —Ç—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å!`);
                return true;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥
            const winStats = {};
            tournament.players.forEach(player => {
                winStats[player] = 0;
            });
            
            matches.forEach(match => {
                if (match.winner && match.winner !== 'draw') {
                    winStats[match.winner]++;
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–≥—Ä–æ–∫ —Å 5 –ø–æ–±–µ–¥–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–µ 6 –∏–≥—Ä–æ–∫–æ–≤)
            for (const player in winStats) {
                if (winStats[player] === 5) {
                    console.log(`üéØ –ò–≥—Ä–æ–∫ ${player} –≤—ã–∏–≥—Ä–∞–ª –≤—Å–µ 5 –º–∞—Ç—á–µ–π. –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    return true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–≥–Ω–∞—Ç—å –ª–∏–¥–µ—Ä–∞
            const remainingMatches = tournamentMatches.filter(m => 
                m.tournament_id === tournament.id && !m.winner
            ).length;
            
            if (remainingMatches > 0) {
                const sortedPlayers = Object.entries(winStats)
                    .sort(([,a], [,b]) => b - a);
                
                if (sortedPlayers.length >= 2) {
                    const [leader, leaderWins] = sortedPlayers[0];
                    const [second, secondWins] = sortedPlayers[1];
                    const maxPossibleWinsForSecond = secondWins + remainingMatches;
                    
                    // –ï—Å–ª–∏ –ª–∏–¥–µ—Ä–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–≥–Ω–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –≤—ã–∏–≥—Ä–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∞—Ç—á–∏
                    if (leaderWins > maxPossibleWinsForSecond) {
                        console.log(`üéØ –õ–∏–¥–µ—Ä ${leader} (${leaderWins} –ø–æ–±–µ–¥) –Ω–µ–¥–æ—Å—è–≥–∞–µ–º –¥–ª—è ${second} (–º–∞–∫—Å–∏–º—É–º ${maxPossibleWinsForSecond} –ø–æ–±–µ–¥). –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                        return true;
                    }
                }
            }
        }
        
        console.log(`‚è≥ –¢—É—Ä–Ω–∏—Ä –Ω–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ`);
        return false;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    async function checkTournamentCompletion(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id);
        const completedMatches = matches.filter(m => m.winner);
        
        console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ "${tournament.name}"`);
        console.log(`üìä –ú–∞—Ç—á–µ–π: ${completedMatches.length}/${matches.length}`);
        
        // –ï—Å–ª–∏ –≤—Å–µ –º–∞—Ç—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
        if (completedMatches.length === matches.length) {
            console.log(`‚úÖ –í—Å–µ –º–∞—Ç—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!`);
            tournament.status = 'completed';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞
            if (tournament.type.includes('round_robin')) {
                determineRoundRobinWinner(tournament);
            } else {
                determineBracketWinner(tournament);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            await updateTournamentInDatabase(tournament);
            
        } else {
            // –ü–†–û–í–ï–†–Ø–ï–ú –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –î–û–°–†–û–ß–ù–û–ì–û –ó–ê–í–ï–†–®–ï–ù–ò–Ø –î–õ–Ø –ö–†–£–ì–û–í–´–• –¢–£–†–ù–ò–†–û–í
            if (tournament.type.includes('round_robin')) {
                console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞`);
                const canFinishEarly = checkEarlyTournamentFinish(tournament);
                if (canFinishEarly) {
                    console.log(`‚úÖ –¢—É—Ä–Ω–∏—Ä –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ!`);
                    tournament.status = 'completed';
                    determineRoundRobinWinner(tournament);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
                    await updateTournamentInDatabase(tournament);
                    
                    console.log(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${tournament.name}" –∑–∞–≤–µ—Ä—à–µ–Ω –¥–æ—Å—Ä–æ—á–Ω–æ! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${tournament.winner}`);
                } else {
                    console.log(`‚è≥ –¢—É—Ä–Ω–∏—Ä –µ—â–µ –Ω–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å`);
                }
            }
        }
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    async function updateTournamentInDatabase(tournament) {
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ Supabase
            await supabaseClient
                .from('tournaments')
                .update({
                    status: tournament.status,
                    winner: tournament.winner,
                    final_match_id: tournament.final_match_id
                })
                .eq('id', tournament.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥ –∏–≥—Ä–æ–∫–∞
            if (tournament.winner && players[tournament.winner]) {
                if (!players[tournament.winner].tournament_wins) {
                    players[tournament.winner].tournament_wins = 0;
                }
                players[tournament.winner].tournament_wins++;
                await savePlayerToSupabase(tournament.winner, players[tournament.winner]);
            }
            
            console.log(`‚úÖ –¢—É—Ä–Ω–∏—Ä "${tournament.name}" –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${tournament.winner}`);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
    function determineRoundRobinWinner(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id && m.winner);
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const stats = {};
        tournament.players.forEach(player => {
            stats[player] = {
                wins: 0,
                losses: 0,
                games_won: 0,
                games_lost: 0,
                points_won: 0,
                points_lost: 0
            };
        });
        
        matches.forEach(match => {
            if (match.winner === match.player1) {
                stats[match.player1].wins++;
                stats[match.player2].losses++;
            } else if (match.winner === match.player2) {
                stats[match.player2].wins++;
                stats[match.player1].losses++;
            }
            
            stats[match.player1].games_won += (match.player1_games || 0);
            stats[match.player1].games_lost += (match.player2_games || 0);
            stats[match.player2].games_won += (match.player2_games || 0);
            stats[match.player2].games_lost += (match.player1_games || 0);
            
            stats[match.player1].points_won += (match.player1_points || 0);
            stats[match.player1].points_lost += (match.player2_points || 0);
            stats[match.player2].points_won += (match.player2_points || 0);
            stats[match.player2].points_lost += (match.player1_points || 0);
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤
        const sortedPlayers = [...tournament.players].sort((a, b) => {
            const statA = stats[a];
            const statB = stats[b];
            
            // –ü–æ –ø–æ–±–µ–¥–∞–º
            if (statB.wins !== statA.wins) {
                return statB.wins - statA.wins;
            }
            
            // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –ø–∞—Ä—Ç–∏–π
            const gamesDiffA = statA.games_won - statA.games_lost;
            const gamesDiffB = statB.games_won - statB.games_lost;
            if (gamesDiffB !== gamesDiffA) {
                return gamesDiffB - gamesDiffA;
            }
            
            // –ü–æ —Ä–∞–∑–Ω–∏—Ü–µ –æ—á–∫–æ–≤
            const pointsDiffA = statA.points_won - statA.points_lost;
            const pointsDiffB = statB.points_won - statB.points_lost;
            return pointsDiffB - pointsDiffA;
        });
        
        // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å - –ø–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ
        if (sortedPlayers.length > 0) {
            tournament.winner = sortedPlayers[0];
            
            // –ù–∞—Ö–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á (–µ—Å–ª–∏ –±—ã–ª –º–µ–∂–¥—É –¥–≤—É–º—è –ª—É—á—à–∏–º–∏)
            const finalMatch = matches.find(m => 
                (m.player1 === sortedPlayers[0] && m.player2 === sortedPlayers[1]) ||
                (m.player1 === sortedPlayers[1] && m.player2 === sortedPlayers[0])
            );
            
            if (finalMatch) {
                tournament.final_match_id = finalMatch.id;
            }
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
    function determineBracketWinner(tournament) {
        const matches = tournamentMatches.filter(m => m.tournament_id === tournament.id);
        
        // –ù–∞—Ö–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á
        const finalMatch = matches.find(m => m.is_final);
        
        if (finalMatch && finalMatch.winner) {
            tournament.winner = finalMatch.winner;
            tournament.final_match_id = finalMatch.id;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
    async function uploadTournamentPhoto() {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ!', 'error');
            return;
        }
        
        const tournamentId = document.getElementById('tournamentPhoto').dataset.tournamentId;
        if (!tournamentId) {
            showNotification('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)', 'error');
                return;
            }
            
            try {
                showNotification('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...', 'info');
                
                // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
                const fileName = `${tournamentId}_${Date.now()}_${file.name}`;
                const filePath = `tournament-photos/${fileName}`;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –≤ Supabase Storage
                const { data, error } = await supabaseClient.storage
                    .from('tournament-photos')
                    .upload(filePath, file);
                
                if (error) throw error;
                
                // –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL
                const { data: urlData } = supabaseClient.storage
                    .from('tournament-photos')
                    .getPublicUrl(filePath);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–æ—Ç–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                const { error: dbError } = await supabaseClient
                    .from('tournament_photos')
                    .upsert({
                        tournament_id: tournamentId,
                        photo_url: urlData.publicUrl,
                        uploaded_at: new Date().toISOString()
                    }, {
                        onConflict: 'tournament_id'
                    });
                
                if (dbError) throw dbError;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const existingPhotoIndex = tournamentPhotos.findIndex(p => p.tournament_id === tournamentId);
                if (existingPhotoIndex !== -1) {
                    tournamentPhotos[existingPhotoIndex] = {
                        tournament_id: tournamentId,
                        photo_url: urlData.publicUrl,
                        uploaded_at: new Date().toISOString()
                    };
                } else {
                    tournamentPhotos.push({
                        tournament_id: tournamentId,
                        photo_url: urlData.publicUrl,
                        uploaded_at: new Date().toISOString()
                    });
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const photoElement = document.getElementById('tournamentPhoto');
                const photoPlaceholder = document.getElementById('tournamentPhotoPlaceholder');
                
                photoElement.src = urlData.publicUrl;
                photoElement.style.display = 'block';
                photoPlaceholder.style.display = 'none';
                
                showNotification('‚úÖ –§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ', 'error');
            }
        };
        
        input.click();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞
    async function deleteTournament(tournamentId) {
        if (!isAdmin) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã!', 'error');
            return;
        }
        
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç—É—Ä–Ω–∏—Ä? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
            return;
        }
        
        try {
            // –£–¥–∞–ª—è–µ–º –º–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞
            await supabaseClient
                .from('tournament_matches')
                .delete()
                .eq('tournament_id', tournamentId);
            
            // –£–¥–∞–ª—è–µ–º —Ñ–æ—Ç–æ —Ç—É—Ä–Ω–∏—Ä–∞
            await supabaseClient
                .from('tournament_photos')
                .delete()
                .eq('tournament_id', tournamentId);
            
            // –£–¥–∞–ª—è–µ–º —Ç—É—Ä–Ω–∏—Ä
            await supabaseClient
                .from('tournaments')
                .delete()
                .eq('id', tournamentId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            tournaments = tournaments.filter(t => t.id !== tournamentId);
            tournamentMatches = tournamentMatches.filter(m => m.tournament_id !== tournamentId);
            tournamentPhotos = tournamentPhotos.filter(p => p.tournament_id !== tournamentId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateTournamentsDisplay();
            showNotification('‚úÖ –¢—É—Ä–Ω–∏—Ä —É–¥–∞–ª–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É —Ç—É—Ä–Ω–∏—Ä–æ–≤
    function returnToTournaments() {
        document.getElementById('appContainer').style.display = 'block';
        document.getElementById('tournamentPageContainer').style.display = 'none';
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.scrollTo(0, 0);
        return false;
    }
    
    // ============================================
    // –û–°–¢–ê–í–®–ò–ô–°–Ø –ö–û–î –û–°–¢–ê–ï–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô
    // ============================================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä–æ–∫–∞
    function showPlayerProfile(playerName) {
        if (!players[playerName]) {
            showNotification('–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        const playerData = players[playerName];
        
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–≥—Ä–æ–∫–∞
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('playerProfileContainer').style.display = 'block';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('playerProfileName').textContent = playerName;
        document.getElementById('playerProfileAvatar').src = playerData.avatar;
        document.getElementById('playerProfileRating').textContent = `–†–µ–π—Ç–∏–Ω–≥: ${playerData.rating} –æ—á–∫–æ–≤`;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        const emojisContainer = document.getElementById('playerProfileEmojis');
        emojisContainer.innerHTML = getAchievementEmojis(playerData.rating);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updatePlayerStats(playerName);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        updatePlayerAchievements(playerName);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—É—Ä–Ω–∏—Ä–Ω—ã—Ö –ø–æ–±–µ–¥–∞—Ö
        updatePlayerTournamentWins(playerName);
        
        // –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ —Ñ–æ—Ä–º—ã
        renderPlayerFormChart(playerName);
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.scrollTo(0, 0);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—É—Ä–Ω–∏—Ä–Ω—ã—Ö –ø–æ–±–µ–¥–∞—Ö –∏–≥—Ä–æ–∫–∞
    function updatePlayerTournamentWins(playerName) {
        const playerData = players[playerName];
        if (!playerData) return;
        
        // –ù–∞—Ö–æ–¥–∏–º —Ç—É—Ä–Ω–∏—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∏–≥—Ä–∞–ª –∏–≥—Ä–æ–∫
        const wonTournaments = tournaments.filter(t => t.winner === playerName);
        
        // –ù–∞—Ö–æ–¥–∏–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤ —Å —É—á–∞—Å—Ç–∏–µ–º –∏–≥—Ä–æ–∫–∞
        const participatedTournaments = tournaments.filter(t => 
            t.players.includes(playerName)
        );
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø—Ä–æ—Ñ–∏–ª—å
        const statsContainer = document.getElementById('playerProfileStats');
        if (statsContainer) {
            let html = `<div style="margin-top: 10px;">`;
            
            if (wonTournaments.length > 0) {
                html += `
                    <div style="background: #fff9c4; padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #FFD700;">
                        <div style="font-weight: bold; color: #333;">üèÜ –¢—É—Ä–Ω–∏—Ä–Ω—ã–µ –ø–æ–±–µ–¥—ã:</div>
                        <div style="margin-top: 5px;">
                `;
                
                wonTournaments.forEach(tournament => {
                    html += `
                        <div style="padding: 5px; background: rgba(255, 215, 0, 0.2); border-radius: 4px; margin-top: 3px;">
                            ${tournament.name} (${new Date(tournament.created_at).getFullYear()})
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            }
            
            html += `
                <div style="margin-top: 10px; color: #666;">
                    <div>üìä –£—á–∞—Å—Ç–∏–µ –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö: ${participatedTournaments.length}</div>
                    <div>üèÜ –ü–æ–±–µ–¥ –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö: ${wonTournaments.length}</div>
                </div>
            `;
            
            statsContainer.innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö
        const achievementsContainer = document.getElementById('playerAllAchievements');
        if (achievementsContainer) {
            const existingContent = achievementsContainer.innerHTML;
            
            if (wonTournaments.length > 0) {
                achievementsContainer.innerHTML = `
                    ${existingContent}
                    <div class="achievement-item">
                        <div class="achievement-icon">üèÜ</div>
                        <div class="achievement-details">
                            <div class="achievement-title">–¢—É—Ä–Ω–∏—Ä–Ω—ã–µ –ø–æ–±–µ–¥—ã</div>
                            <div class="achievement-description">
                                –ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä–∞–ª ${wonTournaments.length} —Ç—É—Ä–Ω–∏—Ä${getPluralForm(wonTournaments.length)}:
                                ${wonTournaments.map(t => t.name).join(', ')}
                            </div>
                        </div>
                    </div>
                `;
            }
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    function returnToMain() {
        document.getElementById('appContainer').style.display = 'block';
        document.getElementById('playerProfileContainer').style.display = 'none';
        document.getElementById('tournamentPageContainer').style.display = 'none';
        
        window.scrollTo(0, 0);
        return false;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
    function getAchievementEmojis(rating) {
        const achievements = [
            { threshold: 1100, emoji: 'ü•â' },
            { threshold: 1300, emoji: 'ü•à' },
            { threshold: 1500, emoji: 'ü•á' },
            { threshold: 2000, emoji: 'üëë' }
        ];
        
        let emojis = '';
        achievements.forEach(achievement => {
            if (rating >= achievement.threshold) {
                emojis += `<span class="achievement-emoji">${achievement.emoji}</span>`;
            }
        });
        
        return emojis;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–∞
    function updatePlayerStats(playerName) {
        const playerData = players[playerName];
        if (!playerData) return;
        
        const now = new Date();
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const weekMatches = matches.filter(m => 
            (m.player1 === playerName || m.player2 === playerName) && 
            m.date >= weekAgo
        );
        const weekWins = weekMatches.filter(m => m.winner === playerName).length;
        const weekRatingChange = weekMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        document.getElementById('playerWeekStats').innerHTML = `
            <p>–ú–∞—Ç—á–µ–π: <span class="stat-value">${weekMatches.length}</span></p>
            <p>–ü–æ–±–µ–¥: <span class="stat-value">${weekWins}</span> (${weekMatches.length ? Math.round(weekWins/weekMatches.length*100) : 0}%)</p>
            <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${weekRatingChange > 0 ? '#4CAF50' : '#f44336'}">${weekRatingChange > 0 ? '+' : ''}${weekRatingChange}</span></p>
        `;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü
        const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
        const monthMatches = matches.filter(m => 
            (m.player1 === playerName || m.player2 === playerName) && 
            m.date >= monthAgo
        );
        const monthWins = monthMatches.filter(m => m.winner === playerName).length;
        const monthRatingChange = monthMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        document.getElementById('playerMonthStats').innerHTML = `
            <p>–ú–∞—Ç—á–µ–π: <span class="stat-value">${monthMatches.length}</span></p>
            <p>–ü–æ–±–µ–¥: <span class="stat-value">${monthWins}</span> (${monthMatches.length ? Math.round(monthWins/monthMatches.length*100) : 0}%)</p>
            <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${monthRatingChange > 0 ? '#4CAF50' : '#f44336'}">${monthRatingChange > 0 ? '+' : ''}${monthRatingChange}</span></p>
        `;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≥–æ–¥
        const yearStart = new Date(now.getFullYear(), 0, 1);
        const yearMatches = matches.filter(m => 
            (m.player1 === playerName || m.player2 === playerName) && 
            m.date >= yearStart
        );
        const yearWins = yearMatches.filter(m => m.winner === playerName).length;
        const yearRatingChange = yearMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        document.getElementById('playerYearStats').innerHTML = `
            <p>–ú–∞—Ç—á–µ–π: <span class="stat-value">${yearMatches.length}</span></p>
            <p>–ü–æ–±–µ–¥: <span class="stat-value">${yearWins}</span> (${yearMatches.length ? Math.round(yearWins/yearMatches.length*100) : 0}%)</p>
            <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${yearRatingChange > 0 ? '#4CAF50' : '#f44336'}">${yearRatingChange > 0 ? '+' : ''}${yearRatingChange}</span></p>
        `;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
        const allTimeMatches = matches.filter(m => 
            m.player1 === playerName || m.player2 === playerName
        );
        const allTimeWins = allTimeMatches.filter(m => m.winner === playerName).length;
        const totalRatingChange = allTimeMatches.reduce((sum, match) => {
            if (match.player1 === playerName) return sum + match.change1;
            if (match.player2 === playerName) return sum + match.change2;
            return sum;
        }, 0);
        
        document.getElementById('playerAllTimeStats').innerHTML = `
            <p>–í—Å–µ–≥–æ –º–∞—Ç—á–µ–π: <span class="stat-value">${allTimeMatches.length}</span></p>
            <p>–í—Å–µ–≥–æ –ø–æ–±–µ–¥: <span class="stat-value">${allTimeWins}</span> (${allTimeMatches.length ? Math.round(allTimeWins/allTimeMatches.length*100) : 0}%)</p>
            <p>–û–±—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: <span class="stat-value" style="color: ${totalRatingChange > 0 ? '#4CAF50' : '#f44336'}">${totalRatingChange > 0 ? '+' : ''}${totalRatingChange}</span></p>
            <p>–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è: <span class="stat-value">${playerData.joinDate ? playerData.joinDate.toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</span></p>
        `;
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è
    function getPluralForm(number) {
        if (number % 10 === 1 && number % 100 !== 11) {
            return '';
        } else if (number % 10 >= 2 && number % 10 <= 4 && (number % 100 < 10 || number % 100 >= 20)) {
            return '–∞';
        } else {
            return '–µ–π';
        }
    }
    
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤ –≤–∞—à–µ–º –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ...
    // –í–ê–ñ–ù–û: –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞:
    // updatePlayerAchievements, renderPlayerFormChart, initSupabase, loadAllData,
    // savePlayerToSupabase, saveMatchToSupabase, savePenaltyToSupabase,
    // deleteMatchFromSupabase, updateSupabaseStatus, updateSupabaseTime,
    // updateRatingTable, updateMatchesTable, updatePlayersTable, updatePenaltiesHistory,
    // updatePlayerSelects, updateAllDisplays, addMatch, saveManualRatings,
    // applyManualPenalty, checkAndApplyPenalties, addPlayer, removePlayer,
    // deleteMatch, changeAvatar, updatePeriodStats, updateYearProgressChart,
    // comparePlayers, showNotification, setMatchDateToToday, openTab
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    // ============================================
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        checkAutoLogin();
        
        setMatchDateToToday();
        
        await initSupabase();
        
        updatePlayerSelects();
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    </script>
</body>
</html>
