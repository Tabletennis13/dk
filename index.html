<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ —Ç–µ–Ω–Ω–∏—Å–∞ - –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏</title>
    <style>
        /* –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å—Ç–∞–≤–æ–∫ */
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ —Å—Ç–∞–≤–æ–∫ */
        .bet-match-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .bet-match-card.live {
            border-color: #ff5722;
            border-left: 5px solid #ff5722;
            background: #fff8f6;
        }
        
        .bet-match-card.finished {
            border-color: #4CAF50;
            background: #f8fff8;
        }
        
        .live-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff5722;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .bet-match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .bet-match-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            flex: 1;
        }
        
        .bet-match-date {
            color: #666;
            font-size: 0.9em;
        }
        
        .bet-players {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .bet-player {
            text-align: center;
            flex: 1;
        }
        
        .bet-player-favorite {
            background: #fff9c4;
            border: 2px solid #FFD700;
        }
        
        .bet-player-odds {
            font-size: 1.8em;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
        }
        
        .bet-vs {
            font-size: 1.5em;
            font-weight: bold;
            color: #666;
            margin: 0 20px;
        }
        
        .bet-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .bet-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
        }
        
        .bet-btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bet-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .bet-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .bet-max-btn {
            padding: 10px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ */
        .player-cabinet-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .tokens-display {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        .tokens-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .token-stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .token-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ */
        .shop-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .shop-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .shop-item-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .shop-item-price {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 15px 0;
            display: inline-block;
        }
        
        .buy-btn {
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .buy-btn:hover:not(:disabled) {
            background: #0b7dda;
        }
        
        .buy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫ */
        .bet-history-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .bet-history-item.won {
            border-left-color: #4CAF50;
            background: #f8fff8;
        }
        
        .bet-history-item.lost {
            border-left-color: #f44336;
            background: #fff8f8;
        }
        
        .bet-history-item.pending {
            border-left-color: #ff9800;
            background: #fff9f0;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å—Ç–∞–≤–æ–∫ */
        .bet-admin-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }
        
        .tokens-control {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .tokens-control input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª */
        .rules-container {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .rules-container h4 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .rules-container ul {
            margin-left: 20px;
            color: #856404;
        }
        
        .rules-container li {
            margin-bottom: 8px;
        }
        
        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ */
        @media (max-width: 768px) {
            .bet-players {
                flex-direction: column;
                gap: 15px;
            }
            
            .bet-vs {
                margin: 10px 0;
            }
            
            .bet-actions {
                flex-direction: column;
            }
            
            .tokens-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä–æ–∫–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    <div class="container" id="playerProfileContainer" style="display: none;">
        <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    <div class="container" id="tournamentPageContainer" style="display: none;">
        <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container" id="appContainer">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üèì –†–µ–π—Ç–∏–Ω–≥ –õ–õ–ù–¢ üí∞</h1>
            <div class="header-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –õ–∏–≥–∏ –õ—é–±–∏—Ç–µ–ª–µ–π –ù–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ –¢–µ–Ω–Ω–∏—Å–∞ | –°–∏—Å—Ç–µ–º–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫</div>
        </header>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ - –î–û–ë–ê–í–õ–Ø–ï–ú –í–ö–õ–ê–î–ö–£ –°–¢–ê–í–û–ö -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-btn" onclick="openTab('matches')">üéÆ –ú–∞—Ç—á–∏</button>
            <button class="tab-btn" onclick="openTab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
            <button class="tab-btn" onclick="openTab('tournaments')">üèÖ –¢—É—Ä–Ω–∏—Ä—ã</button>
            <button class="tab-btn" onclick="openTab('betting')">üí∞ –°—Ç–∞–≤–∫–∏</button>
            <button class="tab-btn" onclick="openTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="openTab('penalties')">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content active" id="rating">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
        
        <div class="tab-content" id="matches">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
        
        <div class="tab-content" id="players">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
        
        <div class="tab-content" id="tournaments">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
        
        <!-- –ù–û–í–ê–Ø –í–ö–õ–ê–î–ö–ê: –°–¢–ê–í–ö–ò -->
        <div class="tab-content" id="betting">
            <h2>üí∞ –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏</h2>
            
            <!-- –ü—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
            <div class="rules-container">
                <h4>‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
                <ul>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ("–∂–µ—Ç–æ–Ω—ã –ª–∏–≥–∏")</li>
                    <li>–ñ–µ—Ç–æ–Ω—ã –Ω–µ –∏–º–µ—é—Ç –¥–µ–Ω–µ–∂–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏</li>
                    <li>–°—Ç–∞–≤–∫–∏ –¥–µ–ª–∞—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö</li>
                    <li>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 50% –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞</li>
                    <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –∏–∑–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Å–∏—Å—Ç–µ–º—ã</li>
                </ul>
            </div>
            
            <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞ -->
            <div class="player-cabinet-container" id="playerCabinetSection" style="display: none;">
                <h3>üë§ –í–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h3>
                <div class="tokens-display" id="playerTokens">0 –∂–µ—Ç–æ–Ω–æ–≤</div>
                <div class="tokens-stats">
                    <div class="token-stat">
                        <div>–°—Ç–∞–≤–æ–∫ —Å–¥–µ–ª–∞–Ω–æ</div>
                        <div class="token-stat-value" id="betsMade">0</div>
                    </div>
                    <div class="token-stat">
                        <div>–°—Ç–∞–≤–æ–∫ –≤—ã–∏–≥—Ä–∞–Ω–æ</div>
                        <div class="token-stat-value" id="betsWon">0</div>
                    </div>
                    <div class="token-stat">
                        <div>–û–±—â–∏–π –≤—ã–∏–≥—Ä—ã—à</div>
                        <div class="token-stat-value" id="totalWon">0</div>
                    </div>
                </div>
            </div>
            
            <!-- –ú–∞–≥–∞–∑–∏–Ω -->
            <div id="shopSection" style="display: none;">
                <h3>üõí –ú–∞–≥–∞–∑–∏–Ω –ª–∏–≥–∏</h3>
                <p>–ü–æ—Ç—Ä–∞—Ç—å—Ç–µ –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –∂–µ—Ç–æ–Ω—ã –Ω–∞ –ø–æ–ª–µ–∑–Ω—ã–µ –±–æ–Ω—É—Å—ã:</p>
                <div class="shop-container">
                    <div class="shop-item">
                        <div class="shop-item-icon">‚ö†Ô∏è</div>
                        <h4>–û—Ç–º–µ–Ω–∞ —à—Ç—Ä–∞—Ñ–∞</h4>
                        <p>–û—Ç–º–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ —à—Ç—Ä–∞—Ñ–∞ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                        <div class="shop-item-price">100 –∂–µ—Ç–æ–Ω–æ–≤</div>
                        <button class="buy-btn" onclick="buyItem('penalty_removal')" id="buyPenaltyRemoval">
                            –ö—É–ø–∏—Ç—å
                        </button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-icon">üìà</div>
                        <h4>–ë–æ–Ω—É—Å –∫ —Ä–µ–π—Ç–∏–Ω–≥—É</h4>
                        <p>+10 –æ—á–∫–æ–≤ –∫ –≤–∞—à–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É</p>
                        <div class="shop-item-price">100 –∂–µ—Ç–æ–Ω–æ–≤</div>
                        <button class="buy-btn" onclick="buyItem('rating_bonus')" id="buyRatingBonus">
                            –ö—É–ø–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫ -->
            <h3>üé≤ –ê–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫</h3>
            <div id="activeBetMatches">
                <!-- –ú–∞—Ç—á–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                <p style="text-align: center; padding: 40px; color: #666;">
                    –ê–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç
                </p>
            </div>
            
            <!-- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏ -->
            <h3>üìä –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏</h3>
            <div id="finishedBetMatches">
                <!-- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ -->
            <div id="betHistorySection" style="display: none;">
                <h3>üìã –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö —Å—Ç–∞–≤–æ–∫</h3>
                <div id="playerBetHistory">
                    <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∞–º–∏ -->
            <div class="bet-admin-panel" id="betAdminPanel" style="display: none;">
                <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∞–º–∏ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</h3>
                
                <h4>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞ –¥–ª—è —Å—Ç–∞–≤–æ–∫</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 1:</label>
                            <select id="betPlayer1"></select>
                        </div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫ 2:</label>
                            <select id="betPlayer2"></select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –º–∞—Ç—á–∞:</label>
                            <input type="datetime-local" id="betMatchDate">
                        </div>
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="betMatchDescription" placeholder="–¢–æ–≤–∞—Ä–∏—â–µ—Å–∫–∏–π –º–∞—Ç—á, –§–∏–Ω–∞–ª —Ç—É—Ä–Ω–∏—Ä–∞ –∏ —Ç.–¥.">
                        </div>
                    </div>
                </div>
                <button class="add-btn action-btn" onclick="createBetMatch()" style="width: 100%; margin-top: 10px;">
                    üé≤ –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫
                </button>
                
                <h4 style="margin-top: 20px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–µ—Ç–æ–Ω–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–ò–≥—Ä–æ–∫:</label>
                            <select id="tokensPlayerSelect"></select>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ—Ç–æ–Ω–æ–≤:</label>
                            <div class="tokens-control">
                                <input type="number" id="tokensAmount" value="100" min="1" max="10000">
                                <button class="add-btn action-btn" onclick="addTokensToPlayer()">
                                    –î–æ–±–∞–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:</label>
                            <div id="playerCurrentTokens" style="padding: 10px; background: white; border-radius: 8px; font-weight: bold;">
                                –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞
                            </div>
                        </div>
                        <button class="penalty-btn action-btn" onclick="resetPlayerTokens()">
                            –°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å
                        </button>
                    </div>
                </div>
                
                <h4 style="margin-top: 20px;">–ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞—Ç—á–∞</h4>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>–ú–∞—Ç—á:</label>
                            <select id="resultMatchSelect" onchange="loadMatchResultInfo()"></select>
                        </div>
                        <div class="form-group">
                            <label>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</label>
                            <select id="matchWinner">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</option>
                                <option value="player1">–ò–≥—Ä–æ–∫ 1</option>
                                <option value="player2">–ò–≥—Ä–æ–∫ 2</option>
                                <option value="draw">–ù–∏—á—å—è</option>
                                <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>–°—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞:</label>
                            <div id="matchStatusInfo" style="padding: 10px; background: white; border-radius: 8px;">
                                –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á
                            </div>
                        </div>
                        <button class="add-btn action-btn" onclick="submitMatchResult()" style="width: 100%;">
                            ‚úÖ –ü–æ–¥–≤–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="stats">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
        
        <div class="tab-content" id="penalties">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
        
        <!-- –ü–∞–Ω–µ–ª–∏ –≤–Ω–∏–∑—É —Å–∞–π—Ç–∞ -->
        <div class="bottom-panels">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->
        </div>
    </div>

    <script>
    // ============================================
    // –î–û–ë–ê–í–õ–Ø–ï–ú –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –°–¢–ê–í–û–ö
    // ============================================
    let playerCabinet = null;
    let betMatches = [];
    let playerBetHistory = [];
    
    // ============================================
    // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–¢–ê–í–û–ö
    // ============================================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
    function calculateOdds(player1Rating, player2Rating) {
        const ratingDiff = Math.abs(player1Rating - player2Rating);
        const favoriteRating = Math.max(player1Rating, player2Rating);
        const underdogRating = Math.min(player1Rating, player2Rating);
        
        // –ë–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
        let favoriteOdds, underdogOdds;
        
        if (ratingDiff >= 400) {
            // –ë–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
            favoriteOdds = 1.1;
            underdogOdds = 10.0;
        } else if (ratingDiff >= 200) {
            // –°—Ä–µ–¥–Ω—è—è —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
            favoriteOdds = 1.3;
            underdogOdds = 3.5;
        } else if (ratingDiff >= 100) {
            // –ù–µ–±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
            favoriteOdds = 1.5;
            underdogOdds = 2.5;
        } else {
            // –†–µ–π—Ç–∏–Ω–≥–∏ –±–ª–∏–∑–∫–∏
            favoriteOdds = 1.8;
            underdogOdds = 2.0;
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—Ç–æ —Ñ–∞–≤–æ—Ä–∏—Ç
        const isPlayer1Favorite = player1Rating > player2Rating;
        
        return {
            player1: isPlayer1Favorite ? favoriteOdds : underdogOdds,
            player2: isPlayer1Favorite ? underdogOdds : favoriteOdds,
            favorite: isPlayer1Favorite ? 'player1' : 'player2'
        };
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
    async function loadPlayerCabinet() {
        if (!supabaseClient) return;
        
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫
            const currentPlayerName = getCurrentPlayerName();
            if (!currentPlayerName) {
                hidePlayerCabinet();
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç–∞
            const { data, error } = await supabaseClient
                .from('player_cabinets')
                .select('*')
                .eq('player_name', currentPlayerName)
                .single();
            
            if (error) {
                // –ï—Å–ª–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
                if (error.code === 'PGRST116') {
                    await createPlayerCabinet(currentPlayerName);
                    await loadPlayerCabinet();
                    return;
                }
                throw error;
            }
            
            playerCabinet = data;
            updatePlayerCabinetDisplay();
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    function getCurrentPlayerName() {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π prompt –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        return localStorage.getItem('currentPlayer') || null;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
    async function createPlayerCabinet(playerName) {
        if (!supabaseClient) return;
        
        try {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å
            const login = playerName.toLowerCase().replace(/\s+/g, '_') + '_' + Date.now().toString().slice(-6);
            const password = Math.random().toString(36).slice(-8);
            
            const { error } = await supabaseClient
                .from('player_cabinets')
                .insert({
                    player_name: playerName,
                    login: login,
                    password: password,
                    tokens: 100, // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª
                    bets_made: 0,
                    bets_won: 0,
                    total_won: 0,
                    bet_history: [],
                    shop_purchases: [],
                    join_date: new Date().toISOString(),
                    last_login: new Date().toISOString()
                });
            
            if (error) throw error;
            
            console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –∏–≥—Ä–æ–∫–∞ ${playerName}`);
            showNotification(`üéâ –°–æ–∑–¥–∞–Ω –≤–∞—à –∏–≥—Ä–æ–≤–æ–π –∫–∞–±–∏–Ω–µ—Ç! –õ–æ–≥–∏–Ω: ${login}`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞
    function updatePlayerCabinetDisplay() {
        if (!playerCabinet) {
            hidePlayerCabinet();
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∫–∞–±–∏–Ω–µ—Ç–∞
        document.getElementById('playerCabinetSection').style.display = 'block';
        document.getElementById('shopSection').style.display = 'block';
        document.getElementById('betHistorySection').style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        document.getElementById('playerTokens').textContent = playerCabinet.tokens + ' –∂–µ—Ç–æ–Ω–æ–≤';
        document.getElementById('betsMade').textContent = playerCabinet.bets_made;
        document.getElementById('betsWon').textContent = playerCabinet.bets_won;
        document.getElementById('totalWon').textContent = playerCabinet.total_won;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞–≤–æ–∫
        updateBetHistoryDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        updateShopItems();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞
    function hidePlayerCabinet() {
        document.getElementById('playerCabinetSection').style.display = 'none';
        document.getElementById('shopSection').style.display = 'none';
        document.getElementById('betHistorySection').style.display = 'none';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫
    function updateBetHistoryDisplay() {
        if (!playerCabinet) return;
        
        const container = document.getElementById('playerBetHistory');
        const history = playerCabinet.bet_history || [];
        
        if (history.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 30px; color: #666;">
                    üì≠ –í—ã –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–æ–∫
                </div>
            `;
            return;
        }
        
        let html = '';
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
        history.sort((a, b) => new Date(b.placed_at) - new Date(a.placed_at));
        
        history.forEach(bet => {
            const statusClass = bet.status === 'won' ? 'won' : 
                               bet.status === 'lost' ? 'lost' : 'pending';
            
            const statusText = bet.status === 'won' ? '–í—ã–∏–≥—Ä–∞–Ω–æ' :
                              bet.status === 'lost' ? '–ü—Ä–æ–∏–≥—Ä–∞–Ω–æ' :
                              bet.status === 'pending' ? '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' :
                              bet.status === 'draw' ? '–ù–∏—á—å—è' : '–û—Ç–º–µ–Ω–µ–Ω–æ';
            
            const winAmount = bet.status === 'won' ? `+${bet.win_amount}` : '';
            
            html += `
                <div class="bet-history-item ${statusClass}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <strong>${bet.match_description || '–ú–∞—Ç—á'}</strong>
                        <span style="color: ${bet.status === 'won' ? '#4CAF50' : 
                                       bet.status === 'lost' ? '#f44336' : '#ff9800'}; 
                              font-weight: bold;">
                            ${statusText} ${winAmount}
                        </span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        –°—Ç–∞–≤–∫–∞: ${bet.bet_on} (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: ${bet.odds}) √ó ${bet.amount} –∂–µ—Ç–æ–Ω–æ–≤
                    </div>
                    <div style="color: #999; font-size: 0.8em; margin-top: 5px;">
                        ${new Date(bet.placed_at).toLocaleDateString('ru-RU')}
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ–∫—É–ø–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
    function updateShopItems() {
        if (!playerCabinet) return;
        
        const canBuyPenalty = playerCabinet.tokens >= 100;
        const canBuyRating = playerCabinet.tokens >= 100;
        
        document.getElementById('buyPenaltyRemoval').disabled = !canBuyPenalty;
        document.getElementById('buyRatingBonus').disabled = !canBuyRating;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
    async function buyItem(itemType) {
        if (!playerCabinet || !supabaseClient) return;
        
        const itemPrice = 100;
        
        if (playerCabinet.tokens < itemPrice) {
            showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∂–µ—Ç–æ–Ω–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!', 'error');
            return;
        }
        
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            playerCabinet.tokens -= itemPrice;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∫—É–ø–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é
            const purchase = {
                item: itemType,
                price: itemPrice,
                date: new Date().toISOString()
            };
            
            const purchases = playerCabinet.shop_purchases || [];
            purchases.push(purchase);
            playerCabinet.shop_purchases = purchases;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            const { error } = await supabaseClient
                .from('player_cabinets')
                .update({
                    tokens: playerCabinet.tokens,
                    shop_purchases: purchases
                })
                .eq('id', playerCabinet.id);
            
            if (error) throw error;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–∫—É–ø–∫–∏
            if (itemType === 'penalty_removal') {
                await applyPenaltyRemoval();
            } else if (itemType === 'rating_bonus') {
                await applyRatingBonus();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updatePlayerCabinetDisplay();
            
            showNotification('‚úÖ –ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–≤–µ—Ä—à–µ–Ω–∞!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ–∫—É–ø–∫–∏', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω—ã —à—Ç—Ä–∞—Ñ–∞
    async function applyPenaltyRemoval() {
        const playerName = playerCabinet.player_name;
        
        if (players[playerName] && players[playerName].penalties > 0) {
            players[playerName].penalties -= 60;
            players[playerName].rating += 60;
            
            await savePlayerToSupabase(playerName, players[playerName]);
            updateAllDisplays();
            
            showNotification('‚úÖ –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω–µ–Ω! +60 –æ—á–∫–æ–≤ –∫ —Ä–µ–π—Ç–∏–Ω–≥—É', 'success');
        } else {
            showNotification('‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ –¥–ª—è –æ—Ç–º–µ–Ω—ã', 'info');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–æ–Ω—É—Å–∞ –∫ —Ä–µ–π—Ç–∏–Ω–≥—É
    async function applyRatingBonus() {
        const playerName = playerCabinet.player_name;
        
        if (players[playerName]) {
            players[playerName].rating += 10;
            
            await savePlayerToSupabase(playerName, players[playerName]);
            updateAllDisplays();
            
            showNotification('‚úÖ +10 –æ—á–∫–æ–≤ –∫ –≤–∞—à–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É!', 'success');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫
    async function loadBetMatches() {
        if (!supabaseClient) return;
        
        try {
            const { data, error } = await supabaseClient
                .from('bet_matches')
                .select('*')
                .order('date', { ascending: true });
            
            if (error) throw error;
            
            betMatches = data || [];
            updateBetMatchesDisplay();
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫
    function updateBetMatchesDisplay() {
        const activeContainer = document.getElementById('activeBetMatches');
        const finishedContainer = document.getElementById('finishedBetMatches');
        
        const activeMatches = betMatches.filter(m => m.status === 'pending' || m.status === 'live');
        const finishedMatches = betMatches.filter(m => m.status === 'finished' || m.status === 'cancelled');
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç—á–∏
        if (activeMatches.length === 0) {
            activeContainer.innerHTML = `
                <p style="text-align: center; padding: 40px; color: #666;">
                    –ê–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è —Å—Ç–∞–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç
                </p>
            `;
        } else {
            let html = '';
            
            activeMatches.forEach(match => {
                const odds = match.odds || calculateOdds(match.player1_rating, match.player2_rating);
                const isLive = match.status === 'live';
                const matchDate = new Date(match.date);
                
                html += `
                    <div class="bet-match-card ${isLive ? 'live' : ''}">
                        ${isLive ? '<div class="live-badge">LIVE</div>' : ''}
                        
                        <div class="bet-match-header">
                            <div class="bet-match-title">
                                ${match.description || '–ú–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫'}
                            </div>
                            <div class="bet-match-date">
                                ${matchDate.toLocaleDateString('ru-RU')} ${matchDate.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                        
                        <div class="bet-players">
                            <div class="bet-player ${odds.favorite === 'player1' ? 'bet-player-favorite' : ''}">
                                <div style="font-weight: bold; margin-bottom: 5px;">${match.player1}</div>
                                <div style="font-size: 0.9em; color: #666;">
                                    –†–µ–π—Ç–∏–Ω–≥: ${match.player1_rating}
                                </div>
                                <div class="bet-player-odds">
                                    ${odds.player1.toFixed(2)}
                                </div>
                            </div>
                            
                            <div class="bet-vs">VS</div>
                            
                            <div class="bet-player ${odds.favorite === 'player2' ? 'bet-player-favorite' : ''}">
                                <div style="font-weight: bold; margin-bottom: 5px;">${match.player2}</div>
                                <div style="font-size: 0.9em; color: #666;">
                                    –†–µ–π—Ç–∏–Ω–≥: ${match.player2_rating}
                                </div>
                                <div class="bet-player-odds">
                                    ${odds.player2.toFixed(2)}
                                </div>
                            </div>
                        </div>
                        
                        ${playerCabinet ? `
                            <div class="bet-actions">
                                <input type="number" 
                                       class="bet-input" 
                                       id="bet_amount_${match.id}"
                                       placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ—Ç–æ–Ω–æ–≤"
                                       min="1"
                                       max="${Math.floor(playerCabinet.tokens / 2)}">
                                <button class="bet-max-btn" onclick="setMaxBet('${match.id}')">
                                    MAX (${Math.floor(playerCabinet.tokens / 2)})
                                </button>
                            </div>
                            
                            <div class="bet-actions">
                                <button class="bet-btn" onclick="placeBet('${match.id}', 'player1')">
                                    –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ ${match.player1}
                                </button>
                                <button class="bet-btn" onclick="placeBet('${match.id}', 'player2')">
                                    –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ ${match.player2}
                                </button>
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                                üîí –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏
                            </div>
                        `}
                    </div>
                `;
            });
            
            activeContainer.innerHTML = html;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏
        if (finishedMatches.length === 0) {
            finishedContainer.innerHTML = `
                <p style="text-align: center; padding: 20px; color: #666;">
                    –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π –ø–æ–∫–∞ –Ω–µ—Ç
                </p>
            `;
        } else {
            let html = '';
            
            finishedMatches.slice(0, 10).forEach(match => { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∞—Ç—á–µ–π
                const isFinished = match.status === 'finished';
                const matchDate = new Date(match.date);
                
                html += `
                    <div class="bet-match-card finished">
                        <div class="bet-match-header">
                            <div class="bet-match-title">
                                ${match.description || '–ú–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫'}
                            </div>
                            <div class="bet-match-date">
                                ${matchDate.toLocaleDateString('ru-RU')}
                            </div>
                        </div>
                        
                        <div style="padding: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <div>
                                    <strong>${match.player1}</strong> (${match.player1_rating})
                                    ${match.result === 'player1' ? 'üèÜ' : ''}
                                </div>
                                <div>
                                    <strong>${match.player2}</strong> (${match.player2_rating})
                                    ${match.result === 'player2' ? 'üèÜ' : ''}
                                </div>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> 
                                ${match.result === 'player1' ? `–ü–æ–±–µ–¥–∏–ª ${match.player1}` :
                                  match.result === 'player2' ? `–ü–æ–±–µ–¥–∏–ª ${match.player2}` :
                                  match.result === 'draw' ? '–ù–∏—á—å—è' :
                                  match.result === 'cancelled' ? '–ú–∞—Ç—á –æ—Ç–º–µ–Ω–µ–Ω' : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}
                                
                                ${match.total_bets ? `<br>–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: ${match.total_bets} –Ω–∞ —Å—É–º–º—É ${match.total_amount} –∂–µ—Ç–æ–Ω–æ–≤` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            finishedContainer.innerHTML = html;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–∏
    function setMaxBet(matchId) {
        if (!playerCabinet) return;
        
        const maxBet = Math.floor(playerCabinet.tokens / 2);
        const input = document.getElementById(`bet_amount_${matchId}`);
        if (input) {
            input.value = maxBet;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
    async function placeBet(matchId, betOn) {
        if (!playerCabinet || !supabaseClient) return;
        
        const match = betMatches.find(m => m.id === matchId);
        if (!match) {
            showNotification('‚ùå –ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        if (match.status !== 'pending' && match.status !== 'live') {
            showNotification('‚ùå –°—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á —É–∂–µ –∑–∞–∫—Ä—ã—Ç—ã!', 'error');
            return;
        }
        
        const input = document.getElementById(`bet_amount_${matchId}`);
        const amount = parseInt(input?.value);
        
        if (!amount || amount < 1) {
            showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏!', 'error');
            return;
        }
        
        if (amount > Math.floor(playerCabinet.tokens / 2)) {
            showNotification(`‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: ${Math.floor(playerCabinet.tokens / 2)} –∂–µ—Ç–æ–Ω–æ–≤ (50% –æ—Ç –±–∞–ª–∞–Ω—Å–∞)`, 'error');
            return;
        }
        
        if (amount > playerCabinet.tokens) {
            showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∂–µ—Ç–æ–Ω–æ–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!', 'error');
            return;
        }
        
        try {
            // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–∞–≤–∫—É –∏–∑ –±–∞–ª–∞–Ω—Å–∞
            playerCabinet.tokens -= amount;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            playerCabinet.bets_made += 1;
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ —Å—Ç–∞–≤–∫–µ
            const odds = match.odds || calculateOdds(match.player1_rating, match.player2_rating);
            const betOdds = betOn === 'player1' ? odds.player1 : odds.player2;
            const potentialWin = Math.floor(amount * betOdds);
            
            const betRecord = {
                id: Date.now().toString(),
                match_id: matchId,
                player_login: playerCabinet.login,
                player_name: playerCabinet.player_name,
                bet_on: betOn,
                amount: amount,
                odds: betOdds,
                potential_win: potentialWin,
                status: 'pending',
                placed_at: new Date().toISOString(),
                result: null,
                win_amount: 0
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–≤–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é
            const betHistory = playerCabinet.bet_history || [];
            betHistory.push(betRecord);
            playerCabinet.bet_history = betHistory;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–∞–±–∏–Ω–µ—Ç–µ
            await supabaseClient
                .from('player_cabinets')
                .update({
                    tokens: playerCabinet.tokens,
                    bets_made: playerCabinet.bets_made,
                    bet_history: betHistory
                })
                .eq('id', playerCabinet.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Ç—á–µ
            const bets = match.bets || [];
            bets.push({
                player_login: playerCabinet.login,
                player_name: playerCabinet.player_name,
                bet_on: betOn,
                amount: amount,
                placed_at: new Date().toISOString()
            });
            
            await supabaseClient
                .from('bet_matches')
                .update({
                    bets: bets,
                    total_bets: (match.total_bets || 0) + 1,
                    total_amount: (match.total_amount || 0) + amount
                })
                .eq('id', matchId);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞–≤–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
            await supabaseClient
                .from('bet_history')
                .insert({
                    id: betRecord.id,
                    match_id: betRecord.match_id,
                    player_login: betRecord.player_login,
                    player_name: betRecord.player_name,
                    bet_on: betRecord.bet_on,
                    amount: betRecord.amount,
                    odds: betRecord.odds,
                    potential_win: betRecord.potential_win,
                    status: betRecord.status,
                    placed_at: betRecord.placed_at
                });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updatePlayerCabinetDisplay();
            await loadBetMatches(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç—á–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            
            showNotification(`‚úÖ –°—Ç–∞–≤–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞! –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–æ ${amount} –∂–µ—Ç–æ–Ω–æ–≤ –Ω–∞ ${betOn === 'player1' ? match.player1 : match.player2}`, 'success');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            if (input) input.value = '';
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏', 'error');
        }
    }
    
    // ============================================
    // –ê–î–ú–ò–ù-–§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–¢–ê–í–ö–ê–ú–ò
    // ============================================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞ –¥–ª—è —Å—Ç–∞–≤–æ–∫ (–∞–¥–º–∏–Ω)
    async function createBetMatch() {
        if (!isAdmin || !supabaseClient) {
            showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∞—Ç—á–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫!', 'error');
            return;
        }
        
        const player1 = document.getElementById('betPlayer1').value;
        const player2 = document.getElementById('betPlayer2').value;
        const dateStr = document.getElementById('betMatchDate').value;
        const description = document.getElementById('betMatchDescription').value;
        
        if (!player1 || !player2) {
            showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤!', 'error');
            return;
        }
        
        if (player1 === player2) {
            showNotification('‚ùå –ò–≥—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏!', 'error');
            return;
        }
        
        if (!dateStr) {
            showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –º–∞—Ç—á–∞!', 'error');
            return;
        }
        
        const matchDate = new Date(dateStr);
        const now = new Date();
        
        if (matchDate < now) {
            if (!confirm('–î–∞—Ç–∞ –º–∞—Ç—á–∞ –≤ –ø—Ä–æ—à–ª–æ–º. –í—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—Ç—å?')) {
                return;
            }
        }
        
        const player1Data = players[player1];
        const player2Data = players[player2];
        
        if (!player1Data || !player2Data) {
            showNotification('‚ùå –û–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        try {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
            const odds = calculateOdds(player1Data.rating, player2Data.rating);
            
            const newMatch = {
                id: 'bet_' + Date.now().toString(),
                player1: player1,
                player2: player2,
                player1_rating: player1Data.rating,
                player2_rating: player2Data.rating,
                description: description,
                date: matchDate.toISOString(),
                status: 'pending',
                odds: odds,
                result: null,
                total_bets: 0,
                total_amount: 0,
                bets: []
            };
            
            const { error } = await supabaseClient
                .from('bet_matches')
                .insert(newMatch);
            
            if (error) throw error;
            
            betMatches.push(newMatch);
            updateBetMatchesDisplay();
            updateBetAdminSelects();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('betMatchDescription').value = '';
            document.getElementById('betMatchDate').value = '';
            
            showNotification(`‚úÖ –ú–∞—Ç—á –¥–ª—è —Å—Ç–∞–≤–æ–∫ —Å–æ–∑–¥–∞–Ω! ${player1} vs ${player2}`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞ –¥–ª—è —Å—Ç–∞–≤–æ–∫:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤ –∏–≥—Ä–æ–∫—É (–∞–¥–º–∏–Ω)
    async function addTokensToPlayer() {
        if (!isAdmin || !supabaseClient) return;
        
        const playerName = document.getElementById('tokensPlayerSelect').value;
        const amount = parseInt(document.getElementById('tokensAmount').value);
        
        if (!playerName || !amount || amount < 1) {
            showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!', 'error');
            return;
        }
        
        try {
            // –ù–∞—Ö–æ–¥–∏–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
            const { data: cabinet, error: cabinetError } = await supabaseClient
                .from('player_cabinets')
                .select('*')
                .eq('player_name', playerName)
                .single();
            
            if (cabinetError) {
                // –ï—Å–ª–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
                await createPlayerCabinet(playerName);
                await addTokensToPlayer(); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            const newTokens = (cabinet.tokens || 0) + amount;
            
            await supabaseClient
                .from('player_cabinets')
                .update({ tokens: newTokens })
                .eq('id', cabinet.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
            if (playerCabinet && playerCabinet.player_name === playerName) {
                playerCabinet.tokens = newTokens;
                updatePlayerCabinetDisplay();
            }
            
            showNotification(`‚úÖ –ò–≥—Ä–æ–∫—É ${playerName} –¥–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –∂–µ—Ç–æ–Ω–æ–≤!`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–æ–≤', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–∞ –∏–≥—Ä–æ–∫–∞ (–∞–¥–º–∏–Ω)
    async function resetPlayerTokens() {
        if (!isAdmin || !supabaseClient) return;
        
        const playerName = document.getElementById('tokensPlayerSelect').value;
        
        if (!playerName) {
            showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞!', 'error');
            return;
        }
        
        if (!confirm(`–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ ${playerName} –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É (100 –∂–µ—Ç–æ–Ω–æ–≤)?`)) {
            return;
        }
        
        try {
            const { data: cabinet, error: cabinetError } = await supabaseClient
                .from('player_cabinets')
                .select('*')
                .eq('player_name', playerName)
                .single();
            
            if (cabinetError) throw cabinetError;
            
            await supabaseClient
                .from('player_cabinets')
                .update({ tokens: 100 })
                .eq('id', cabinet.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
            if (playerCabinet && playerCabinet.player_name === playerName) {
                playerCabinet.tokens = 100;
                updatePlayerCabinetDisplay();
            }
            
            showNotification(`‚úÖ –ë–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ ${playerName} —Å–±—Ä–æ—à–µ–Ω –¥–æ 100 –∂–µ—Ç–æ–Ω–æ–≤`, 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω)
    async function submitMatchResult() {
        if (!isAdmin || !supabaseClient) return;
        
        const matchId = document.getElementById('resultMatchSelect').value;
        const winner = document.getElementById('matchWinner').value;
        
        if (!matchId || !winner) {
            showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á –∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è!', 'error');
            return;
        }
        
        const match = betMatches.find(m => m.id === matchId);
        if (!match) {
            showNotification('‚ùå –ú–∞—Ç—á –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            return;
        }
        
        if (match.status === 'finished') {
            if (!confirm('–ú–∞—Ç—á —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?')) {
                return;
            }
        }
        
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞
            const resultMap = {
                'player1': match.player1,
                'player2': match.player2,
                'draw': 'draw',
                'cancelled': 'cancelled'
            };
            
            const result = resultMap[winner];
            
            await supabaseClient
                .from('bet_matches')
                .update({
                    status: 'finished',
                    result: result,
                    updated_at: new Date().toISOString()
                })
                .eq('id', matchId);
            
            // –ï—Å–ª–∏ –º–∞—Ç—á –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–≤–∫–∏
            if (winner === 'cancelled') {
                await refundAllBets(matchId);
            } else {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–∏
                await calculateWinnings(matchId, result);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await loadBetMatches();
            updateBetAdminSelects();
            
            showNotification('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', 'error');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ç–∞–≤–æ–∫ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –º–∞—Ç—á–∞
    async function refundAllBets(matchId) {
        try {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á
            const { data: bets, error } = await supabaseClient
                .from('bet_history')
                .select('*')
                .eq('match_id', matchId)
                .eq('status', 'pending');
            
            if (error) throw error;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∂–¥—É—é —Å—Ç–∞–≤–∫—É
            for (const bet of bets) {
                // –ù–∞—Ö–æ–¥–∏–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
                const { data: cabinet, error: cabinetError } = await supabaseClient
                    .from('player_cabinets')
                    .select('*')
                    .eq('login', bet.player_login)
                    .single();
                
                if (cabinetError) continue;
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–≤–∫—É
                const newTokens = (cabinet.tokens || 0) + bet.amount;
                
                await supabaseClient
                    .from('player_cabinets')
                    .update({ tokens: newTokens })
                    .eq('id', cabinet.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏
                await supabaseClient
                    .from('bet_history')
                    .update({
                        status: 'cancelled',
                        result: 'cancelled',
                        win_amount: 0
                    })
                    .eq('id', bet.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                if (playerCabinet && playerCabinet.login === bet.player_login) {
                    playerCabinet.tokens = newTokens;
                }
            }
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ç–∞–≤–æ–∫:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π
    async function calculateWinnings(matchId, result) {
        try {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á
            const { data: bets, error } = await supabaseClient
                .from('bet_history')
                .select('*')
                .eq('match_id', matchId)
                .eq('status', 'pending');
            
            if (error) throw error;
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞—Ç—á
            const match = betMatches.find(m => m.id === matchId);
            if (!match) return;
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —Å—Ç–∞–≤–∫—É
            for (const bet of bets) {
                let status, winAmount = 0;
                
                if (result === 'draw') {
                    // –ü—Ä–∏ –Ω–∏—á—å–µ–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–≤–∫–∏
                    status = 'draw';
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–∏–≥—Ä–∞–ª–∞ –ª–∏ —Å—Ç–∞–≤–∫–∞
                    const betOnPlayer = bet.bet_on === 'player1' ? match.player1 : match.player2;
                    if (betOnPlayer === result) {
                        // –°—Ç–∞–≤–∫–∞ –≤—ã–∏–≥—Ä–∞–ª–∞
                        status = 'won';
                        winAmount = Math.floor(bet.amount * bet.odds);
                        
                        // –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
                        const { data: cabinet, error: cabinetError } = await supabaseClient
                            .from('player_cabinets')
                            .select('*')
                            .eq('login', bet.player_login)
                            .single();
                        
                        if (!cabinetError) {
                            const newTokens = (cabinet.tokens || 0) + winAmount;
                            const newTotalWon = (cabinet.total_won || 0) + winAmount;
                            const newBetsWon = (cabinet.bets_won || 0) + 1;
                            
                            await supabaseClient
                                .from('player_cabinets')
                                .update({
                                    tokens: newTokens,
                                    total_won: newTotalWon,
                                    bets_won: newBetsWon
                                })
                                .eq('id', cabinet.id);
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                            if (playerCabinet && playerCabinet.login === bet.player_login) {
                                playerCabinet.tokens = newTokens;
                                playerCabinet.total_won = newTotalWon;
                                playerCabinet.bets_won = newBetsWon;
                            }
                        }
                    } else {
                        // –°—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞
                        status = 'lost';
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏
                await supabaseClient
                    .from('bet_history')
                    .update({
                        status: status,
                        result: result,
                        win_amount: winAmount
                    })
                    .eq('id', bet.id);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–±–∏–Ω–µ—Ç—ã –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤, —Å–¥–µ–ª–∞–≤—à–∏—Ö —Å—Ç–∞–≤–∫–∏
            if (playerCabinet) {
                updatePlayerCabinetDisplay();
            }
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ç—á–µ (–∞–¥–º–∏–Ω)
    async function loadMatchResultInfo() {
        const matchId = document.getElementById('resultMatchSelect').value;
        if (!matchId) return;
        
        const match = betMatches.find(m => m.id === matchId);
        if (!match) return;
        
        const statusInfo = document.getElementById('matchStatusInfo');
        
        let info = `
            <strong>${match.player1} (${match.player1_rating}) vs ${match.player2} (${match.player2_rating})</strong><br>
            –°—Ç–∞—Ç—É—Å: ${match.status === 'pending' ? '–û–∂–∏–¥–∞–Ω–∏–µ' : 
                      match.status === 'live' ? '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' : 
                      match.status === 'finished' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : '–û—Ç–º–µ–Ω–µ–Ω'}<br>
        `;
        
        if (match.result) {
            info += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${match.result === 'player1' ? `–ü–æ–±–µ–¥–∏–ª ${match.player1}` :
                               match.result === 'player2' ? `–ü–æ–±–µ–¥–∏–ª ${match.player2}` :
                               match.result === 'draw' ? '–ù–∏—á—å—è' : '–û—Ç–º–µ–Ω–µ–Ω'}<br>`;
        }
        
        info += `–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: ${match.total_bets || 0} –Ω–∞ —Å—É–º–º—É ${match.total_amount || 0} –∂–µ—Ç–æ–Ω–æ–≤`;
        
        statusInfo.innerHTML = info;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
    function updateBetAdminSelects() {
        if (!isAdmin) return;
        
        // –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞
        updatePlayerSelectForBetting();
        
        // –°–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–µ—Ç–æ–Ω–∞–º–∏
        const tokensSelect = document.getElementById('tokensPlayerSelect');
        if (tokensSelect) {
            const playerNames = Object.keys(players).sort();
            tokensSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>';
            playerNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                tokensSelect.appendChild(option);
            });
        }
        
        // –°–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –ø–æ–¥–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const resultSelect = document.getElementById('resultMatchSelect');
        if (resultSelect) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏
            const pendingMatches = betMatches.filter(m => m.status !== 'finished');
            resultSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á</option>';
            pendingMatches.forEach(match => {
                const option = document.createElement('option');
                option.value = match.id;
                option.textContent = `${match.player1} vs ${match.player2} (${new Date(match.date).toLocaleDateString('ru-RU')})`;
                resultSelect.appendChild(option);
            });
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Å—Ç–∞–≤–æ–∫
    function updatePlayerSelectForBetting() {
        const selects = ['betPlayer1', 'betPlayer2'];
        const playerNames = Object.keys(players).sort();
        
        selects.forEach(selectId => {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>';
            playerNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        });
    }
    
    // ============================================
    // –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –°–£–©–ï–°–¢–í–£–Æ–©–ò–ú –ö–û–î–û–ú
    // ============================================
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    async function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        checkAutoLogin();
        
        setMatchDateToToday();
        
        await initSupabase();
        
        updatePlayerSelects();
        updatePlayerSelectForBetting();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞–≤–æ–∫
        await loadBetMatches();
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
        await loadPlayerCabinet();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (isAdmin) {
            document.getElementById('betAdminPanel').style.display = 'block';
            updateBetAdminSelects();
        }
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–æ–∫
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const tabElement = document.getElementById(tabName);
        if (tabElement) {
            tabElement.classList.add('active');
        }
        
        const activeButton = document.querySelector(`.tab-btn[onclick*="${tabName}"]`);
        if (activeButton) {
            activeButton.classList.add('active');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∫–ª–∞–¥–∫–∏ —Å—Ç–∞–≤–æ–∫
        if (tabName === 'betting') {
            setTimeout(() => {
                updateBetMatchesDisplay();
                if (isAdmin) {
                    updateBetAdminSelects();
                }
            }, 100);
        }
        
        if (tabName === 'stats') {
            setTimeout(() => {
                updateYearProgressChart();
            }, 100);
        } else if (tabName === 'tournaments') {
            setTimeout(() => {
                updateTournamentsDisplay();
                updateTournamentPlayersList();
            }, 100);
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞
    function checkAutoLogin() {
        const saved = localStorage.getItem('tennisAdmin');
        if (saved === 'true') {
            isAdmin = true;
            document.getElementById('appContainer').classList.add('admin-active');
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('ratingAdminControls').style.display = 'block';
            document.getElementById('matchesAdminControls').style.display = 'block';
            document.getElementById('penaltiesAdminControls').style.display = 'block';
            document.getElementById('playersAdminControls').style.display = 'block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Å—Ç–∞–≤–æ–∫
            document.getElementById('betAdminPanel').style.display = 'block';
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞
    function logoutAdmin() {
        isAdmin = false;
        document.getElementById('appContainer').classList.remove('admin-active');
        document.getElementById('loginPanel').style.display = 'block';
        
        document.getElementById('ratingAdminControls').style.display = 'none';
        document.getElementById('matchesAdminControls').style.display = 'none';
        document.getElementById('penaltiesAdminControls').style.display = 'none';
        document.getElementById('playersAdminControls').style.display = 'none';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Å—Ç–∞–≤–æ–∫
        document.getElementById('betAdminPanel').style.display = 'none';
        
        localStorage.removeItem('tennisAdmin');
        
        updateAllDisplays();
        
        showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'info');
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤
    function loginAsPlayer() {
        const playerName = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞–≤–æ–∫:');
        if (playerName && players[playerName]) {
            localStorage.setItem('currentPlayer', playerName);
            showNotification(`üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${playerName}!`, 'success');
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–±–∏–Ω–µ—Ç –∏–≥—Ä–æ–∫–∞
            loadPlayerCabinet();
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å—Ç–∞–≤–æ–∫
            openTab('betting');
        } else if (playerName) {
            showNotification('‚ùå –ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ —Ä–µ–π—Ç–∏–Ω–≥–∞!', 'error');
        }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞–≤–æ–∫
    window.addEventListener('DOMContentLoaded', function() {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞ –≤ —à–∞–ø–∫—É
        const header = document.querySelector('header');
        if (header) {
            const loginBtn = document.createElement('button');
            loginBtn.textContent = 'üë§ –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞–≤–æ–∫';
            loginBtn.style.cssText = `
                background: #2196F3;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 8px;
                font-weight: bold;
                cursor: pointer;
                margin-top: 10px;
            `;
            loginBtn.onclick = loginAsPlayer;
            header.appendChild(loginBtn);
        }
    });
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    </script>
</body>
</html>
